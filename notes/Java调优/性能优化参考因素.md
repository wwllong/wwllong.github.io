# 性能优化的参考因素以及调优策略概述

面对海量数据或任务时，无论如何都会碰到性能压力，唯一的选择是你会把这个压力放在哪一层或哪一个位置来应对，以及采取什么应对措施。

## 导致系统瓶颈的计算资源
CPU、内存、磁盘I/O、网络传送、数据库、锁竞争、异常。

## 程序性能衡量指标
- 响应时间：系统响应时间越短越好。  
- 启动时间：系统从运行到可以正常处理业务所需要花费的时间，启动地越快越好。  
- 执行时间：一段代码从开始运行到结束运行，所使用的时间。  
- 执行速度：程序的反应是否迅速，响应时间是否够短。  
- 计算资源分配：计算资源，包括CPU、内存、磁盘等，避免资源紧张。    
- 内存分配：合理分配，避免内存溢出或泄漏。  
- 磁盘吞吐量：IOPS(Input/Output Per Second)即每秒的输入输出量，单位时间内能处理I/O请求数量。数据吞吐量（Throughput）指单位时间内可以成功传输的数据数量。一般两个值越大越好。
- 网络吞吐量：没有帧丢失的情况下，设备能够接受的最大速率。  
负载承受能力：当系统压力上升时，系统的执行速度、响应时间的上升曲线是否平缓。

## 性能优化目标-Java程序本身优化目标

`编写更有效率的代码`：Java应用程序最终执行基于字节码，而CPI（指令时钟周期，执行一条CPU指令所消耗的CPU时钟数。）是衡量字节码效率的指标。合理的算法可以生成最短CPU指令序列，编译器生成最高效的代码，减少每条CPU指令上消耗的CPU时钟周期数。如果CPU时钟周期被用来执行操作系统指令或内核代码，那么这部分时间就无法用于执行应用程序。`因此，改善应用程序性能的策略之一是减少消耗在系统或内核CPU上的时钟周期数。注意，该策略不适用于在操作系统或内核态上消耗时间极少的应用程序。`

`使用更高效的算法`：调优所获得的最大收益来自算法效率的提高。`通常情况下，使用恰当的数据结构以及算法，程序拥有更短的执行路径，可以使用更少的指令实现程序功能，使得程序运行更快。
`

`减少锁竞争`：对共享资源的竞争容易限制应用程序的可扩展性。频繁进行锁竞争的应用程序的性能是无法随线程数和CPU数增加而提高的。`因此，减少锁竞争的频率、缩短锁持有的时间都能有效优化应用程序。`

## 性能优化策略

`空间换时间`：属于系统架构层面的优化。例如：缓存机制、CDN、冗余数据、数据景象、负载均衡等通过采用把计算过程一步步地保持或缓存等方式，避免重复计算发发生。

`时间换空间`：属于系统架构层面的优化。例如Huffman编码压缩算法。使用少量的空间，性能可能会更好。

`简化代码`：属于基础技术层面的优化。例如，减少循环层数、减少递归、在循环中少声明变量、少做分配和释放内存的操作等等，大多数情况下可以认为代码越少性能越好。

`并行处理`：属于综合性策略。单核CPU如果采用多进程、多线程方式编写程序，如果计算密集需求的应用反而变慢，因为巨大的操作系统调度和切换开销导致的。该策略需要根据CPU以及实际业务进行选取方案，并不是一定CPU核越多越好。

```
20%的系统设计或程序代码消耗了80%的系统性能。如果找到那个20%的缺陷设计或劣质代码，那么可以较为容易地优化、解决80%的性能问题。
```

## 性能调优分类方法

性能调优一般分为基础技术、架构、层次三个方面。

## 业务方面
- 商业事务：抓取用户与应用交互时用户体验到的实时性能数据。
- 外部服务：与应用系统交互的系统，特点为无法控制。
- 应用布局：应用环境根据用户需求调节大小。

## 基础技术方面
- 前端技术
  - 前端负载均衡
  - 减少前端连接数
  - 减少网页大小增加带宽
  - 前端页面静态化
  - 优化查询
  - 缓存问题
- 服务端技术
  - 数据冗余
  - 数据镜像
  - 数据分区
  - 后端系统负载均衡
  - 异步
  - 节流阀
  - 批量处理
  - 垃圾回收技术

## 组件方面
- 云计算
- 虚拟化
- 多核技术
- 异构计算
- 高速网络技术

## 架构方面
- 安全、健壮、兼容性

## 层次方面
- 自上而下
- 自下而上

