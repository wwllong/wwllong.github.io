(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{851:function(s,a,t){"use strict";t.r(a);var e=t(58),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"调整垃圾回收器提高服务的吞吐量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整垃圾回收器提高服务的吞吐量"}},[s._v("#")]),s._v(" 调整垃圾回收器提高服务的吞吐量")]),s._v(" "),t("p",[s._v("也是使用优化案例1的Tomcat 例子，这次尝试使用不同的垃圾回收器，查看不同垃圾回收器的性能区别。")]),s._v(" "),t("p",[s._v("说明：Linux虚拟机内存都是8G，主要区别是CPU核心数不同。")]),s._v(" "),t("h2",{attrs:{id:"单核场景使用serialgc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单核场景使用serialgc"}},[s._v("#")]),s._v(" 单核场景使用SerialGC")]),s._v(" "),t("p",[s._v("设置Linux虚拟机的CPU核心为单核，Tomcat JVM参数设置（"),t("code",[s._v("setenv.sh")]),s._v("文件）：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+UseSerialGC"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xms30m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xmx30m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+PrintGCDetails"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:MetaspaceSize=64m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+PrintGCDateStamps"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xloggc:/home/wenwl/apache-tomcat-8.5.66/logs/gc.log"')]),s._v("\n")])])]),t("p",[s._v("查看GC情况以及压测吞吐量：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_1.png",alt:"perf_case6_1.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_2.png",alt:"perf_case6_2.png"}})]),s._v(" "),t("p",[t("strong",[s._v("发生一次Full GC，吞吐量为2278.1/sec")]),s._v("。")]),s._v(" "),t("h2",{attrs:{id:"单核场景使用parallelgc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单核场景使用parallelgc"}},[s._v("#")]),s._v(" 单核场景使用ParallelGC")]),s._v(" "),t("p",[s._v("在CPU核心为单核的基础上，使用并行垃圾收集器ParallelGC，JVM参数设置（"),t("code",[s._v("setenv.sh")]),s._v("文件）：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+UseSerialGC"')]),s._v("\n")])])]),t("p",[s._v("查看GC情况以及压测吞吐量：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_3.png",alt:"perf_case6_3.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_4.png",alt:"perf_case6_4.png"}})]),s._v(" "),t("p",[s._v("同样"),t("strong",[s._v("发生一次Full GC，吞吐量为2303.6/sec")]),s._v("，吞吐量并没有明显变化。在单核使用并发垃圾收集器ParallelGC意义不大。")]),s._v(" "),t("h2",{attrs:{id:"多核场景使用parallelgc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多核场景使用parallelgc"}},[s._v("#")]),s._v(" 多核场景使用ParallelGC")]),s._v(" "),t("p",[s._v("将CPU核心该为4核，使用并行垃圾收集器Parallel GC。查看GC情况以及压测吞吐量：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_5.png",alt:"perf_case6_5.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_6.png",alt:"perf_case6_6.png"}})]),s._v(" "),t("p",[s._v("同样发生一次Full GC，"),t("strong",[s._v("吞吐量为6814.8/sec。吞吐量大幅提升，直接翻了近3倍")]),s._v("！！说明我们在多核机器上面采用并行收集器对于系统的吞吐量有一个显著的效果。")]),s._v(" "),t("h2",{attrs:{id:"多核场景使用parnew-cms"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多核场景使用parnew-cms"}},[s._v("#")]),s._v(" 多核场景使用ParNew + CMS")]),s._v(" "),t("p",[s._v("在多核心情况下使用CMS GC：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+UseConcMarkSweepGC"')]),s._v("\n")])])]),t("p",[s._v("查看GC情况以及压测吞吐量：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_8.png",alt:"perf_case6_8.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_7.png",alt:"perf_case6_7.png"}})]),s._v(" "),t("p",[t("strong",[s._v("发生两次Full GC，吞吐量为6765.9/sec")]),s._v("。吞吐量较ParallelGC没有明显变化，但是各个百分比的平均的响应比ParallelGC较优。")]),s._v(" "),t("h2",{attrs:{id:"多核场景使用g1"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多核场景使用g1"}},[s._v("#")]),s._v(" 多核场景使用G1")]),s._v(" "),t("p",[s._v("在多核心情况下使用G1：")]),s._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[s._v("export CATALINA_OPTS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CATALINA_OPTS -XX:+UseG1GC"')]),s._v("\n")])])]),t("p",[s._v("查看GC情况以及压测吞吐量：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_9.png",alt:"perf_case6_9.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case6_10.png",alt:"perf_case6_10.png"}})]),s._v(" "),t("p",[t("strong",[s._v("没有发生Full GC，吞吐量为6546.2/sec")]),s._v("。吞吐量较ParallelGC、CMS也没有明显变化，而在百分比的平均的响应比前两者优。")])])}),[],!1,null,null,null);a.default=r.exports}}]);