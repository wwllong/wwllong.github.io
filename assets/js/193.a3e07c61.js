(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{841:function(t,s,n){"use strict";n.r(s);var a=n(58),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"tomcat堆溢出分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tomcat堆溢出分析"}},[t._v("#")]),t._v(" Tomcat堆溢出分析")]),t._v(" "),n("p",[t._v("Tomcat是最常用的Java Servlet容器之一，同时也可以当做单独的Web服务器使用。")]),t._v(" "),n("p",[t._v("Tomcat本身使用Java实现，并运行于Java虚拟机之上。在大规模请求时，Tomcat有可能会因为无法承受压力而发生内存溢出错误。这里根据一个被压垮的Tomcat的堆快照文件，来分析Tomcat在崩溃时的内部情况。")]),t._v(" "),n("p",[t._v("图1：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_1.png",alt:"1"}})]),t._v(" "),n("p",[t._v("￼￼￼图2：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_2.png",alt:"2"}})]),t._v(" "),n("p",[t._v("图3：sessions对象，它占用了约17MB空间")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_3.png",alt:"3"}})]),t._v(" "),n("p",[t._v("图4：可以看到sessions对象为ConcurrentHashMap，其内部分为16个Segment。从深堆大小看，每个Segment都比较平均，大约为1MB，合计17MB。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_4.png",alt:"4"}})]),t._v(" "),n("p",[t._v("图5：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_5.png",alt:"5"}})]),t._v(" "),n("p",[t._v("图6：当前堆中含有9941个session，并且每一个session的深堆为1592字节，合计约15MB，达到当前堆大小的50%。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_6.png",alt:"6"}})]),t._v(" "),n("p",[t._v("图7：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_7.png",alt:"7"}})]),t._v(" "),n("p",[t._v("图8：")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/%EF%BF%BCtomcat_oom_8.png",alt:"8"}})]),t._v(" "),n("p",[t._v("根据当前的session总数，可以计算每秒的平均压力为：9941 / (1403324677648 - 1403324645728) * 1000 = 311次/秒。")]),t._v(" "),n("p",[t._v("由此推断，在发生Tomcat堆溢出时，Tomcat在连续30秒的时间内，平均每秒接收了约311次不同客户端的请求，创建了合计9941个session。")])])}),[],!1,null,null,null);s.default=e.exports}}]);