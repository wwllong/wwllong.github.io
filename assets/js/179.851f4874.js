(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{827:function(a,s,t){"use strict";t.r(s);var n=t(58),e=Object(n.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"jvm基石-class文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jvm基石-class文件"}},[a._v("#")]),a._v(" JVM基石：class文件")]),a._v(" "),t("p",[t("RouterLink",{attrs:{to:"/java-vm/0_2_java_jvm_introd.html"}},[a._v("Java是夸平台的语言，JVM是夸语言的平台")]),a._v("。JVM能够成为夸语言的平台与字节码是息息相关的。")],1),a._v(" "),t("h2",{attrs:{id:"字节码文件的跨平台性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字节码文件的跨平台性"}},[a._v("#")]),a._v(" 字节码文件的跨平台性")]),a._v(" "),t("p",[t("strong",[a._v("Java虚拟机不和包括Java在内的任何语言绑定，它只与“class”文件这种特定的二进制文件格式所关联")]),a._v("。无论是使用哪种语言进行开发，只要能将源文件编译为正确的class文件，那么这种语言就可以在Java虚拟机上执行。可以说，统一而强大的Class文件结构就是Java虚拟机的基石、桥梁。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/class_sys_introd_1.jpg",alt:"class_sys_introd_1"}})]),a._v(" "),t("p",[a._v("虽然"),t("RouterLink",{attrs:{to:"/java-vm/0_6_jvm_family.html"}},[a._v("JVM的家族庞大")]),a._v("，但是所有的JVM全部遵循"),t("a",{attrs:{href:"https://docs.oracle.com/javase/specs/index.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java虚拟机规范"),t("OutboundLink")],1),a._v("，也就是说所有的JVM都可以加载符合JVM规范的字节码文件。而我们知道要想让一个Java程序正确地运行在JVM中，Java源码就必须被编译为符合JVM规范的字节码。")],1),a._v(" "),t("p",[a._v("一般Java源码的编译过程如下：")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("前端编译器")]),a._v("将符合Java语法规范的Java代码转换为符合JVM规范的字节码文件。")]),a._v(" "),t("li",[t("code",[a._v("javac")]),a._v("是一种能够将Java源码编译为字节码的前端编译器。编译过程主要包含了四个步骤：词法解析、语法解析、语义解析以及生成字节码。")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/class_sys_introd_2.jpg",alt:"class_sys_introd_2"}})]),a._v(" "),t("h2",{attrs:{id:"java的前端编译器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java的前端编译器"}},[a._v("#")]),a._v(" Java的前端编译器")]),a._v(" "),t("p",[a._v("在学习了JVM的解释引擎之后，就知道我们通常说的“编译代码”，其实指的是前端编译器，也就是编译源代码生成字节码的阶段。而解释引擎的JIT编译器我们通常称为后端编译器，我们所指的编译期优化一般是指JIT运行时所做的优化。")]),a._v(" "),t("p",[a._v("HotSpot VM并没有强制要求前端编译器只能用"),t("code",[a._v("javac")]),a._v("来编译字节码，其实只要编译结果符合JVM规范都可以被JVM所识别。在Java的前端编译器领域，除了"),t("code",[a._v("javac")]),a._v("之外，还有一种经常被大家用到的前端编译器，那就是内置代Eclipse的"),t("code",[a._v("ECJ（Eclipse Complier for Java）")]),a._v("编译器，和"),t("code",[a._v("javac")]),a._v("全量编译方式不同，"),t("strong",[t("code",[a._v("ECJ")]),a._v("是一种增量式编译器")]),a._v("。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("在Eclipse中，当开发人员编写完代码后，用“Ctrl + S” 快捷键时，"),t("code",[a._v("ECJ")]),a._v("编译器采取的编译方案是把未编译部分的源码逐行进行编译，而非每次都全量编译。因此"),t("code",[a._v("ECJ")]),a._v("编译器效率会比"),t("code",[a._v("javac")]),a._v("编译更加迅速和高效，当然编译质量和"),t("code",[a._v("javac")]),a._v("相比大致是一样的。")]),a._v(" "),t("p",[t("code",[a._v("ECJ")]),a._v("编译器不仅是Eclipse的默认内置前端编译器，在Tomcat中同样也是使用"),t("code",[a._v("ECJ")]),a._v("编译器来编译JSP文件。由于"),t("code",[a._v("ECJ")]),a._v("编译器是采用GPLv2的开源协议进行源代码公开，所以，大家可以登录Eclipse官方下载"),t("code",[a._v("ECJ")]),a._v("编译器的源码进行二次开发。")])]),a._v(" "),t("li",[t("p",[a._v("默认情况下，IntelliJ IDEA使用的是"),t("code",[a._v("javac")]),a._v("编译器。（可以自己设置为AspectJ编译器，ajc）")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/class_sys_introd_3.jpg",alt:"class_sys_introd_3"}})]),a._v(" "),t("h2",{attrs:{id:"代码细节-字节码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代码细节-字节码"}},[a._v("#")]),a._v(" 代码细节-字节码")]),a._v(" "),t("p",[a._v("字节码有时候也是面试可能会问到的，因为很多时候可以通过对字节码的阅读，了解Java代码底层的执行操作，例如自动装箱拆箱、字符串细节、类加载变量初始化等等细节。")]),a._v(" "),t("blockquote",[t("p",[a._v("BAT面试题")]),a._v(" "),t("p",[a._v("类文件结构有哪几个部分")]),a._v(" "),t("p",[a._v("知道字节码吗？字节码有哪些？Integer x = 5； int y = 5； 比较x == y都经过那些步骤？")])]),a._v(" "),t("h3",{attrs:{id:"自动装箱拆箱"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自动装箱拆箱"}},[a._v("#")]),a._v(" 自动装箱拆箱")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),a._v(" x "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" y "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("x "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" y"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("字节码：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" iconst_5\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" invokestatic "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#2 <java/lang/Integer.valueOf : (I)Ljava/lang/Integer;>")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" astore_1\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" iconst_5\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),a._v(" istore_2\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(" getstatic "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#3 <java/lang/System.out : Ljava/io/PrintStream;>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" aload_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#4 <java/lang/Integer.intValue : ()I> ")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),a._v(" iload_2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(" if_icmpne "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("+7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),a._v(" iconst_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" goto "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("+4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" iconst_0\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#5 <java/io/PrintStream.println : (Z)V>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("26")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("return")]),a._v("\n")])])]),t("h3",{attrs:{id:"字符串细节"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符串细节"}},[a._v("#")]),a._v(" 字符串细节")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" str "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hello"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" str1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"helloworld"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("out"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("str "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" str1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("字节码，执行原因可阅读"),t("a",{attrs:{href:"./1_12_string_table"}},[a._v("StringTable")]),a._v("：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" new "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#2 <java/lang/StringBuilder>")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" dup\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" invokespecial "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#3 <java/lang/StringBuilder.<init> : ()V>")]),a._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),a._v(" new "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#4 <java/lang/String>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" dup\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),a._v(" ldc "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#5 <hello>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("13")]),a._v(" invokespecial "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#6 <java/lang/String.<init> : (Ljava/lang/String;)V>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#7 <java/lang/StringBuilder.append : (Ljava/lang/String;)Ljava/lang/StringBuilder;>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),a._v(" new "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#4 <java/lang/String>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" dup\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" ldc "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#8 <world>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("25")]),a._v(" invokespecial "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#6 <java/lang/String.<init> : (Ljava/lang/String;)V>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("28")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#7 <java/lang/StringBuilder.append : (Ljava/lang/String;)Ljava/lang/StringBuilder;>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("31")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#9 <java/lang/StringBuilder.toString : ()Ljava/lang/String;>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("34")]),a._v(" astore_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("35")]),a._v(" ldc "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#10 <helloworld>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("37")]),a._v(" astore_2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("38")]),a._v(" getstatic "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#11 <java/lang/System.out : Ljava/io/PrintStream;>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("41")]),a._v(" aload_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("42")]),a._v(" aload_2\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("43")]),a._v(" if_acmpne "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("+7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("46")]),a._v(" iconst_1\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("47")]),a._v(" goto "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("51")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("+4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),a._v(" iconst_0\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("51")]),a._v(" invokevirtual "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#12 <java/io/PrintStream.println : (Z)V>")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("54")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("return")]),a._v("\n")])])]),t("h2",{attrs:{id:"反解析class文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反解析class文件"}},[a._v("#")]),a._v(" 反解析class文件")]),a._v(" "),t("p",[a._v("Java源代码经过前端编译器后生成的字节码文件是一种"),t("strong",[a._v("二进制的类文件")]),a._v("，它的内容是JVM指令（又称字节码指令，例如上面的例子），而不像C、C++经由编译器直接生成机器码。")]),a._v(" "),t("ul",[t("li",[a._v("字节码指令（byte code）：Java虚拟机的指令由一个字节长度的、代表某种特定操作含义的"),t("strong",[a._v("操作码")]),a._v("（opcode）以及跟随其后的零个或多个代表此操作所需的"),t("strong",[a._v("操作数")]),a._v("（operand）所构成。虚拟机中许多指令并不包含操作数，只有一个操作码。")]),a._v(" "),t("li",[a._v("简单来说，字节码指令 = 操作码 [操作数]")])]),a._v(" "),t("p",[a._v("通常有三种方式放解析class文件二进制字节码：")]),a._v(" "),t("ul",[t("li",[a._v("人工解析：使用文本编辑器打开，或者工具打开，根据一个个二进制去看，例如，Notepad++安装HEX-Editor插件、Binary Viewer。")]),a._v(" "),t("li",[a._v("使用"),t("code",[a._v("javap")]),a._v("指令：JDK自带的反解析工具。")]),a._v(" "),t("li",[a._v("IDEA插件 jclasslib 或 jclasslib bytecode viewer客户端工具。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);