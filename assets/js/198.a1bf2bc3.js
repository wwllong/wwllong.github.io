(window.webpackJsonp=window.webpackJsonp||[]).push([[198],{846:function(s,a,t){"use strict";t.r(a);var e=t(58),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"调整堆大小提高服务的吞吐量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调整堆大小提高服务的吞吐量"}},[s._v("#")]),s._v(" 调整堆大小提高服务的吞吐量")]),s._v(" "),t("p",[s._v("使用Tomcat 8.5.66 测试调整堆大小提高服务的吞吐量。")]),s._v(" "),t("p",[s._v("Jemeter配置：线程数50，Ramp-Up时间1秒，循环次数1000")]),s._v(" "),t("h2",{attrs:{id:"修改tomcat-jvm配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改tomcat-jvm配置"}},[s._v("#")]),s._v(" 修改Tomcat JVM配置")]),s._v(" "),t("p",[s._v("生产环境下，Tomcat并不建议直接在"),t("code",[s._v("catalina.sh")]),s._v("里配置变量，而是写在与"),t("code",[s._v("catalina")]),s._v("同级目录（bin目录）下的"),t("code",[s._v("setenv.sh")]),s._v("里。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case1_1.png",alt:"perf_case1_1.png"}})]),s._v(" "),t("p",[s._v("所以如果我们想要修改jvm的内存配置，那么我们就需要修改"),t("code",[s._v("setenv.sh")]),s._v("文件。（默认没有，需新建一个"),t("code",[s._v("setenv.sh")]),s._v("）")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" setenv.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +7 setenv.sh\n")])])]),t("h2",{attrs:{id:"初始配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始配置"}},[s._v("#")]),s._v(" 初始配置")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("setenv.sh")]),s._v("文件中写入（大小根据自己情况修改）：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xms20m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:SurvivorRatio=8"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xmx20m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+UseParallelGC"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+PrintGCDetails"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:MetaspaceSize=64m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -XX:+PrintGCDateStamps"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xloggc:/home/wenwl/apache-tomcat-8.5.66/logs/gc.log"')]),s._v("\n")])])]),t("p",[s._v("分别进行了三次压测，通过"),t("code",[s._v("jstat")]),s._v("指令或"),t("code",[s._v("gc.log")]),s._v("发现每次存在大量的Full GC，吞吐量是(1909.8/sec)，查看一下我们Jmeter汇总报告：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case1_2.png",alt:"perf_case1_2.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case1_3.png",alt:"perf_case1_3.png"}})]),s._v(" "),t("h2",{attrs:{id:"优化配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化配置"}},[s._v("#")]),s._v(" 优化配置")]),s._v(" "),t("p",[s._v("修改堆空间初始化大小和最大内存：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xms80m"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CATALINA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CATALINA_OPTS")]),s._v(' -Xmx80m"')]),s._v("\n")])])]),t("p",[s._v("分别再进行了三次压测，通过"),t("code",[s._v("jstat")]),s._v("指令或"),t("code",[s._v("gc.log")]),s._v("发现Full GC明显减少，吞吐量明显上升（2957.6/sec)，查看一下我们Jmeter汇总报告：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case1_4.png",alt:"perf_case1_4.png"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://qiniu.wenwl.site/notes/jvm/tuning_case/perf_case1_5.png",alt:"perf_case1_5.png"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);