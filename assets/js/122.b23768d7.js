(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{757:function(t,s,a){"use strict";a.r(s);var e=a(58),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose-的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-的使用"}},[t._v("#")]),t._v(" Docker Compose 的使用")]),t._v(" "),a("h2",{attrs:{id:"两个重要概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两个重要概念"}},[t._v("#")]),t._v(" 两个重要概念")]),t._v(" "),a("p",[a("code",[t._v("Compose")]),t._v(" 中有两个重要的概念：")]),t._v(" "),a("ul",[a("li",[t._v("服务 ("),a("code",[t._v("service")]),t._v(")：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。")]),t._v(" "),a("li",[t._v("项目 ("),a("code",[t._v("project")]),t._v(")：由一组关联的应用容器组成的一个完整业务单元，在 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件中定义。")])]),t._v(" "),a("p",[t._v("可见，一个项目可以由多个服务（容器）关联而成，"),a("code",[t._v("Compose")]),t._v(" 面向项目进行管理。")]),t._v(" "),a("h2",{attrs:{id:"场景举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景举例"}},[t._v("#")]),t._v(" 场景举例")]),t._v(" "),a("p",[t._v("最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。下面我们用 "),a("code",[t._v("Python")]),t._v(" 来建立一个能够记录页面访问次数的 web 网站。")]),t._v(" "),a("ol",[a("li",[t._v("新建文件夹，在该目录中编写 "),a("code",[t._v("app.py")]),t._v(" 文件")])]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Flask\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" redis "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Redis\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nredis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("incr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World! 该页面已被访问 {} 次。\\n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__main__"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" debug"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("编写 "),a("code",[t._v("Dockerfile")]),t._v(" 文件，内容为")])]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" python:3.6-alpine")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" . /code")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /code")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" pip install redis flask")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.py"')]),t._v("]")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("编写 "),a("code",[t._v("docker-compose.yml")]),t._v(" 文件，这个是 Compose 使用的主模板文件。")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("web")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5000:5000"')]),t._v("\n     \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:alpine"')]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("运行 compose 项目")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("wenwl@ubuntu:/usr/local/docker/py-web$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up\nStarting py-web_redis_1_108631571fa0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nStarting py-web_web_1_91d20ee66296   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nAttaching to py-web_redis_1_108631571fa0, py-web_web_1_91d20ee66296\nredis_1_108631571fa0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":C "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),t._v(" Jun "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(":14:09.600 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 篇幅有限省略")]),t._v("\nweb_1_91d20ee66296 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("  * Debugger is active"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\nweb_1_91d20ee66296 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("  * Debugger PIN: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("688")]),t._v("-411-012\n")])])]),a("p",[t._v("此时访问本地 "),a("code",[t._v("5000")]),t._v(" 端口，每次刷新页面，计数就会加 1。")]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/qq_41954384/article/details/100524436",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用docker-compose搭建flask和redis环境"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);