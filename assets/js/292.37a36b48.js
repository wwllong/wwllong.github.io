(window.webpackJsonp=window.webpackJsonp||[]).push([[292],{954:function(t,s,n){"use strict";n.r(s);var e=n(58),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"redis-sentinel-集群部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-sentinel-集群部署"}},[t._v("#")]),t._v(" Redis Sentinel 集群部署")]),t._v(" "),n("h2",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),n("p",[t._v("Redis 集群可以在一组 redis 节点之间实现高可用性和 sharding。在集群中会有 1 个 master 和多个 slave 节点。当 master 节点失效时，应选举出一个 slave 节点作为新的 master。然而 Redis 本身（包括它的很多客户端）没有实现自动故障发现并进行主备切换的能力，需要外部的监控方案来实现自动故障恢复，实现 Redis HA 的方案有很多，其中Sentinel是官方推荐的方案。")]),t._v(" "),n("h2",{attrs:{id:"redis-ha-方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-ha-方案"}},[t._v("#")]),t._v(" Redis HA 方案")]),t._v(" "),n("p",[t._v("HA（High Available），高可用性群集系统简称，是保证业务连续性的有效解决方案，一般有两个或两个以上的节点，且分为"),n("strong",[t._v("活动节点")]),t._v("及"),n("strong",[t._v("备用节点")]),t._v("。通常把正在执行业务的称为活动节点，而作为活动节点的一个备份的则称为备用节点。当活动节点出现问题，导致正在运行的业务不能正常运行时，备用节点此时就会侦测到，并立即接续活动节点来执行业务。从而实现业务的不中断或短暂中断。")]),t._v(" "),n("p",[t._v("Redis 一般以"),n("strong",[t._v("主-从")]),t._v("方式部署（主实例提供读写，从实例主要用于备份），要实现 该方式的 HA 主要有如下几种方案：")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("keepalived：")]),t._v(" 通过 keepalived 的虚拟 IP，提供主从的统一访问，在主出现问题时， 通过 keepalived 运行脚本将从提升为主，待主恢复后，先同步后自动变为主，该方案的好处是主从切换后，客户端是无感知的（因为访问的虚拟 IP 不变），坏处是引入 keepalived 增加部署复杂性，在有些情况下会导致数据丢失。")]),t._v(" "),n("li",[n("strong",[t._v("zookeeper：")]),t._v(" 通过 zookeeper 来监控主从实例， 维护最新有效的 IP， 应用通过 zookeeper 取得 IP，对 Redis 进行访问，该方案需要编写大量的监控代码。")]),t._v(" "),n("li",[n("strong",[t._v("sentinel：")]),t._v(" 通过 Sentinel 监控主从实例，自动进行故障恢复，该方案有个缺陷：因为主从实例地址( IP & PORT )是不同的，当故障发生进行主从切换后，应用程序无法知道新地址，故在 Jedis 2.2.2 中新增了对 Sentinel 的支持，应用通过 "),n("code",[t._v("redis.clients.jedis.JedisSentinelPool.getResource()")]),t._v(" 取得的 Jedis 实例会及时更新到新的主实例地址。")])]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/redis-ha-sentinel.jpg",alt:"redis-ha-sentinel"}})]),t._v(" "),n("p",[t._v("PS：")]),t._v(" "),n("ul",[n("li",[t._v("sentinel 是解决 HA 问题的，cluster 是解决主从复制问题的，本身不具备主/从切换问题。")]),t._v(" "),n("li",[t._v("从Spring Boot 2.x 以后Redis客户端已经默认使用Lettuce，而不是Jedis。")])]),t._v(" "),n("h2",{attrs:{id:"sentinel-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sentinel-概述"}},[t._v("#")]),t._v(" Sentinel 概述")]),t._v(" "),n("p",[t._v("Redis Sentinel 是官方推荐的高可用性解决方案（Redis HA方案）。它是 Redis 集群的监控管理工具，可以提供节点监控、通知、自动故障恢复和客户端配置发现服务。")]),t._v(" "),n("p",[n("img",{attrs:{src:"https://qiniu.wenwl.site/notes/redis-sentinel.jpg",alt:"redis-sentinel"}})]),t._v(" "),n("p",[t._v("简单来说，Redis Sentinel提供的主要功能有：")]),t._v(" "),n("ul",[n("li",[t._v("当主节点发生故障时，它将自动选择一个备用节点并将其升级为主节点。")]),t._v(" "),n("li",[t._v("充当客户端发现的中心授权来源，客户端连接到Sentinel以获取主节点的地址。")])]),t._v(" "),n("p",[t._v("此次搭建使用"),n("code",[t._v("docker-compose")]),t._v("实现，搭建简单的Sentinel 模型（1-master; 2-slave; 3-sentinel）。"),n("code",[t._v("Redis")]),t._v("版本为"),n("code",[t._v("lasted-(6.2.6)")])]),t._v(" "),n("h2",{attrs:{id:"搭建redis集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建redis集群"}},[t._v("#")]),t._v(" 搭建Redis集群")]),t._v(" "),n("p",[t._v("搭建Redis一主两从环境，创建"),n("code",[t._v("redis")]),t._v("文件夹，"),n("code",[t._v("docker-compose.yml")]),t._v("配置如下：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data  \n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n    \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6381 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n\nwenwl@ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("saas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/docker/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel/redis$ cat docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("compose.yml \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data  \n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n    \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6381 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n\nwenwl@ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("saas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/docker/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel/redis$ sudo vi docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("compose.yml \nwenwl@ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("saas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/docker/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel/redis$ cat docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("compose.yml \n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./master"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data  \n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6380 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n    \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("slave2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slave2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("slaveof redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master 6379 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("requirepass 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ip 192.168.0.111 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("replica"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("announce"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port 6381 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("masterauth 123456 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("appendonly yes\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 6381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./slave2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/data\n")])])]),n("p",[t._v("注意：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("--requirepass")]),t._v(":  redis密码。如果主从服务器设置密码，需主从服务器密码保持一致，否则哨兵机制会失败！")]),t._v(" "),n("li",[n("code",[t._v("masterauth")]),t._v("：主服务的授权密码。注意，由于哨兵模式能够完成主从切换，现有的 Master 可能会变成 Slave，故在当前 Master 容器中也要携带"),n("code",[t._v("masterauth")]),t._v("参数。")]),t._v(" "),n("li",[n("code",[t._v("replica-announce-ip")]),t._v("：该指令用于指定当在端口转发或NAT网络环境中，当redis有多个ip地址，可以使用该选项指定redis的ip地址。上面的"),n("code",[t._v("192.168.0.111")]),t._v("为本人虚拟机的地址，请根据实际情况填写自己机器的IP。如果单纯使用容器内的IP，会导致一些不必要的麻烦：例如处理"),n("code",[t._v("sentinel")]),t._v("容器的访问、"),n("code",[t._v("sentinel")]),t._v("故障转移失败等等。")]),t._v(" "),n("li",[n("code",[t._v("replica-announce-port")]),t._v("：该指令用于指定当在端口转发或NAT网络环境中，指定redis的端口。这里应该是映射到宿主机的端口，而不是容器默认端口。")])]),t._v(" "),n("p",[t._v("可执行以下命令，查看主从是否生效：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" redis-master redis-cli -a "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v(" info replication\nWarning: Using a password with "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-a'")]),t._v(" or "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-u'")]),t._v(" option on the "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" line interface may not be safe.\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Replication")]),t._v("\nrole:master\nconnected_slaves:2\nslave0:ip"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111,port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v(",state"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("online,offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1055")]),t._v(",lag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nslave1:ip"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111,port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v(",state"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("online,offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1055")]),t._v(",lag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nmaster_failover_state:no-failover\nmaster_replid:81fc0e8be130cbd11fb9236fe86c0dc43f326f8d\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:1055\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:1055\n")])])]),n("h2",{attrs:{id:"搭建-sentinel-集群"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#搭建-sentinel-集群"}},[t._v("#")]),t._v(" 搭建 Sentinel 集群")]),t._v(" "),n("p",[t._v("创建三个 Sentinel 服务，"),n("code",[t._v("docker-compose.yml")]),t._v(" 配置如下：")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.1'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel1\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /usr/local/etc/redis/conf/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26379"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./s1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/conf\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /usr/local/etc/redis/conf/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26380"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/conf\n\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" TZ=Asia/Shanghai\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel3\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sentinel /usr/local/etc/redis/conf/sentinel.conf\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 26381"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n    volumes\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./s3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/usr/local/etc/redis/conf\n")])])]),n("p",[t._v("注意：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("如果直接使用文件映射指定"),n("code",[t._v("sentinel.conf")]),t._v("到容器内，这么做有可能导致哨兵没有写入配置文件的权限，logs表现为"),n("code",[t._v("WARNING: Sentinel was not able to save the new configuration on disk!!!: Device or resource busy")]),t._v("。解决方案：使用文件夹映射。")])]),t._v(" "),n("li",[n("p",[t._v("提示，"),n("code",[t._v("Sentinel")]),t._v("容器如果想要能访问到自分配IP的Redis主从模式的容器，可以使用该命令可查看Redis主的IP，后面Sentinel配置可以用到，这里我们固定了IP（192.168.0.111），所以直接配置即可。")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect redis-master "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" Networks -A "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v("\n")])])])])]),t._v(" "),n("h2",{attrs:{id:"sentinel-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sentinel-配置文件"}},[t._v("#")]),t._v(" Sentinel 配置文件")]),t._v(" "),n("p",[t._v("在启动容器前需要编写一份通用的 "),n("code",[t._v("sentinel.conf")]),t._v(" 配置文件，然后分别创建目录 "),n("code",[t._v("s1")]),t._v("，"),n("code",[t._v("s2")]),t._v("，"),n("code",[t._v("s3")]),t._v("，并且分别复制一份到这三个目录下：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("port "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#sentinel announce-ip 192.168.0.111（可选）")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#sentinel announce-port 26379 （可选）如果加此配置，需要将起改为对容器映射到宿主机的端口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" /tmp\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义集群名为mymaster，其中 192.168.0.111 为 redis-master 的 ip，6379 为 redis-master 的端口，2 为最小投票数（因为官方建议取值为哨兵数量的一半加1，我们有 3 台 Sentinel，所以可以设置成 2）")]),t._v("\nsentinel monitor mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\nsentinel auth-pass mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#requirepass 123456 redis5.x之后才支持Sentinel配置密码，可以不设置，否则在使用lettuce会遇到Error： NOAUTH Authentication required，个人水平有限，发现处理起来比较麻烦。")]),t._v("\nsentinel down-after-milliseconds mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\nsentinel parallel-syncs mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nsentinel failover-timeout mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("180000")]),t._v("\nsentinel deny-scripts-reconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n")])])]),n("p",[t._v("更详细的配置说明，见下文的附录。创建完成后就可以启动容器了。")]),t._v(" "),n("h2",{attrs:{id:"查看sentinel集群是否生效"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看sentinel集群是否生效"}},[t._v("#")]),t._v(" 查看Sentinel集群是否生效")]),t._v(" "),n("p",[t._v("进入 Sentinel 容器，使用 Sentinel API 查看监控情况：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -it redis-sentinel1 /bin/bash\nredis-cli -p "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\nsentinel master mymaster "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看redis主信息")]),t._v("\nsentinel slaves mymaster "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看从redis信息")]),t._v("\n")])])]),n("p",[t._v("执行上述指令，当看到以下的信息，即集群已经生效：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num-slaves"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("33")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"num-other-sentinels"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("34")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"quorum"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("36")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),n("p",[t._v("注意尝试证明使用哨兵模式能够完成故障转移，网上很多教程是有问题的（主要是无法访问到Redis主从模式的容器），即建议尝试手动停掉Redis主服务，通过查看"),n("code",[t._v("redis-sentinel")]),t._v("日志，看其将哪个redis选为主，然后这个升为主的redis此时是具备写的能力的。")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" logs -f redis-sentinel1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":29:22.329 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# +monitor master mymaster 192.168.0.111 6379 quorum 2")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":29:22.331 * +slave slave "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111:6380 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":29:22.333 * +slave slave "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111:6381 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":29:24.211 * +sentinel sentinel bf68f0c1d648053a5db608ae56b2d6adb879fbc4 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.21")]),t._v(".0.2 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":29:24.277 * +sentinel sentinel 4dc7e383eb36346c880bc42536b2ebfd19b7caaf "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.21")]),t._v(".0.3 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ===此处我down掉了redis-master，sentinel将redis-slave1作为了主")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.835 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -odown master mymaster 192.168.0.111 6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.836 * +slave-reconf-inprog slave "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111:6381 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.836 * +slave-reconf-done slave "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111:6381 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.912 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# +failover-end master mymaster 192.168.0.111 6379")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.912 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# +switch-master mymaster 192.168.0.111 6379 192.168.0.111 6380")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":X "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v(" Dec "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(":33:07.913 * +slave slave "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111:6381 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6381")]),t._v(" @ mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])])]),n("h2",{attrs:{id:"spring-boot-2-x-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-2-x-配置"}},[t._v("#")]),t._v(" Spring Boot 2.x 配置")]),t._v(" "),n("h3",{attrs:{id:"yml-参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#yml-参考"}},[t._v("#")]),t._v(" yml 参考")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  \n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lettuce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-active")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接池最大连接数（使用负值表示没有限制）")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接池中的最大空闲连接")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接池中的最小空闲连接")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-wait")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("1ms\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sentinel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("master")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mymaster\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.0.111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("192.168.0.111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26380")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("192.168.0.111"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26381")]),t._v("\n")])])]),n("h2",{attrs:{id:"附-redis-sentinel-核心配置说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附-redis-sentinel-核心配置说明"}},[t._v("#")]),t._v(" 附：Redis Sentinel 核心配置说明")]),t._v(" "),n("p",[t._v("以下为官方Redis Sentinel的"),n("a",{attrs:{href:"https://github.com/redis/redis/blob/6.0/sentinel.conf",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置模版文件-sentinel.conf"),n("OutboundLink")],1),t._v("，更多的说明可以参考"),n("a",{attrs:{href:"https://github.com/redis/redis-doc/blob/master/topics/sentinel.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),n("OutboundLink")],1),t._v("：")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example sentinel.conf")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# *** IMPORTANT ***")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default Sentinel will not be reachable from interfaces different than")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# localhost, either use the 'bind' directive to bind to a list of network")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# interfaces, or disable protected mode with "protected-mode no" by')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# adding it to this configuration file.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Before doing that MAKE SURE the instance is protected from the outside")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# world via firewalling or other means.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For example you may use one of the following:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定可以连接的ip")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bind 127.0.0.1 192.168.1.1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启保护模式")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# protected-mode no")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# port <sentinel-port>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The port that this sentinel instance will run on")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 哨兵sentinel实例运行的端口 默认26379  ")]),t._v("\nport "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("26379")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default Redis Sentinel does not run as a daemon. Use 'yes' if you need it.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note that Redis will write a pid file in /var/run/redis-sentinel.pid when")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# daemonized.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否已守护进程模式运行")]),t._v("\ndaemonize no\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# When running daemonized, Redis Sentinel writes a pid file in")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /var/run/redis-sentinel.pid by default. You can specify a custom pid file")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# location here.")]),t._v("\npidfile /var/run/redis-sentinel.pid\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Specify the log file name. Also the empty string can be used to force")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sentinel to log on the standard output. Note that if you use standard")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# output for logging but daemonize, logs will be sent to /dev/null")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定日志文件")]),t._v("\nlogfile "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel announce-ip <ip>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel announce-port <port>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The above two configuration directives are useful in environments where,")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# because of NAT, Sentinel is reachable from outside via a non-local address.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# When announce-ip is provided, the Sentinel will claim the specified IP address")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# in HELLO messages used to gossip its presence, instead of auto-detecting the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# local address as it usually does.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Similarly when announce-port is provided and is valid and non-zero, Sentinel")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# will announce the specified TCP port.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The two options don't need to be used together, if only announce-ip is")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# provided, the Sentinel will announce the specified IP and the server port")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# as specified by the "port" option. If only announce-port is provided, the')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sentinel will announce the auto-detected local IP and the specified port.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel announce-ip 1.2.3.4")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dir <working-directory>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Every long running process should have a well-defined working directory.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# For Redis Sentinel to chdir to /tmp at startup is the simplest thing")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for the process to don't interfere with administrative tasks such as")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# unmounting filesystems.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 哨兵sentinel的工作目录  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dir")]),t._v(" /tmp\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel monitor <master-name> <ip> <redis-port> <quorum>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Tells Sentinel to monitor this master, and to consider it in O_DOWN")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# (Objectively Down) state only if at least <quorum> sentinels agree.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note that whatever is the ODOWN quorum, a Sentinel will require to")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# be elected by the majority of the known Sentinels in order to")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# start a failover, so no failover can be performed in minority.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Replicas are auto-discovered, so you don't need to specify replicas in")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# any way. Sentinel itself will rewrite this configuration file adding")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the replicas using additional configuration options.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Also note that the configuration file is rewritten when a")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# replica is promoted to master.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note: master name should not include special characters or spaces.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# The valid charset is A-z 0-9 and the three characters ".-_".')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel monitor是哨兵最核心的配置，其中：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# masterName指定了主节点名称，")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# masterIp和masterPort指定了主节点地址，")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# quorum是判断主节点客观下线的哨兵数量阈值：当判定主节点下线的哨兵数量达到quorum时，对主节点进行客观下线。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 建议取值为哨兵数量的一半加1。")]),t._v("\nsentinel monitor mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel auth-pass <master-name> <password>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set the password to use to authenticate with the master and replicas.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Useful if there is a password set in the Redis instances to monitor.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note that the master password is also used for replicas, so it is not")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# possible to set a different password in masters and replicas instances")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if you want to be able to monitor these instances with Sentinel.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# However you can have Redis instances without the authentication enabled")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mixed with Redis instances requiring the authentication (as long as the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# password set is the same for all the instances requiring the password) as")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the AUTH command will have no effect in Redis instances with authentication")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# switched off.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码 ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel auth-pass mymaster MySUPER--secret-0123passw0rd")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel auth-user <master-name> <username>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is useful in order to authenticate to instances having ACL capabilities,")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# that is, running Redis 6.0 or greater. When just auth-pass is provided the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# Sentinel instance will authenticate to Redis using the old "AUTH <pass>"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# method. When also an username is provided, it will use "AUTH <user> <pass>".')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In the Redis servers side, the ACL to provide just minimal access to")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sentinel instances, should be configured along the following lines:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     user sentinel-user >somepassword +client +subscribe +publish \\")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                        +ping +info +multi +slaveof +config +client +exec on")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel down-after-milliseconds <master-name> <milliseconds>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Number of milliseconds the master (or any attached replica or sentinel) should")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# be unreachable (as in, not acceptable reply to PING, continuously, for the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# specified period) in order to consider it in S_DOWN state (Subjectively")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Down).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default is 30 seconds.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主观下线的判断配置：哨兵使用ping命令对其他节点进行心跳检测，如果其他节点超过down-after-milliseconds配置的时间没有回复，哨兵就会将其进行主观下线。该配置对主节点、从节点和哨兵节点的主观下线判定都有效。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# down-after-milliseconds的默认值是30000，即30s；")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以根据不同的网络环境和应用要求来调整：值越大，对主观下线的判定会越宽松，好处是误判的可能性小，坏处是故障发现和故障转移的时间变长，客户端等待的时间也会变长。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如，如果应用对可用性要求较高，则可以将值适当调小，当故障发生时尽快完成转移；如果网络环境相对较差，可以适当提高该阈值，避免频繁误判")]),t._v("\nsentinel down-after-milliseconds mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30000")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requirepass <password>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# You can configure Sentinel itself to require a password, however when doing")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# so Sentinel will try to authenticate with the same password to all the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other Sentinels. So you need to configure all your Sentinels in a given")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# group with the same "requirepass" password. Check the following documentation')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for more info: https://redis.io/topics/sentinel")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel parallel-syncs <master-name> <numreplicas>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# How many replicas we can reconfigure to point to the new replica simultaneously")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# during the failover. Use a low number if you use the replicas to serve query")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to avoid that all the replicas will be unreachable at about the same")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# time while performing the synchronization with the master.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 故障转移之后从节点的复制有关配置：它规定了每次向新的主节点发起复制操作的从节点个数。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如，假设主节点切换完成之后，有3个从节点要向新的主节点发起复制；")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  如果parallel-syncs=1，则从节点会一个一个开始复制；")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  如果parallel-syncs=3，则3个从节点会一起开始复制。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# parallel-syncs取值越大，从节点完成复制的时间越快，但是对主节点的网络负载、硬盘负载造成的压力也越大；应根据实际情况设置。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如，如果主节点的负载较低，而从节点对服务可用的要求较高，可以适量增加parallel-syncs取值。parallel-syncs的默认值是1")]),t._v("\nsentinel parallel-syncs mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel failover-timeout <master-name> <milliseconds>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Specifies the failover timeout in milliseconds. It is used in many ways:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - The time needed to re-start a failover after a previous failover was")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   already tried against the same master by a given Sentinel, is two")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   times the failover timeout.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - The time needed for a replica replicating to a wrong master according")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   to a Sentinel current configuration, to be forced to replicate")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   with the right master, is exactly the failover timeout (counting since")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   the moment a Sentinel detected the misconfiguration).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - The time needed to cancel a failover that is already in progress but")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   did not produced any configuration change (SLAVEOF NO ONE yet not")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   acknowledged by the promoted replica).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - The maximum time a failover in progress waits for all the replicas to be")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   reconfigured as replicas of the new master. However even after this time")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   the replicas will be reconfigured by the Sentinels anyway, but not with")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   the exact parallel-syncs progression as specified.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default is 3 minutes.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 故障转移超时的判断有关配置，但是该参数不是用来判断整个故障转移阶段的超时，而是其几个子阶段的超时。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如如果主节点晋升从节点时间超过timeout，或从节点向新的主节点发起复制操作的时间（不包括复制数据的时间）超过timeout，都会导致故障转移超时失败。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# failover-timeout的默认值是180000，即180s；如果超时，则下一次该值会变为原来的2倍。")]),t._v("\nsentinel failover-timeout mymaster "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("180000")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SCRIPTS EXECUTION")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel notification-script and sentinel reconfig-script are used in order")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to configure scripts that are called to notify the system administrator")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or to reconfigure clients after a failover. The scripts are executed")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# with the following rules for error handling:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# If script exits with "1" the execution is retried later (up to a maximum')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# number of times currently set to 10).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# If script exits with "2" (or an higher value) the script execution is')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# not retried.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# If script terminates because it receives a signal the behavior is the same")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# as exit code 1.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# A script has a maximum running time of 60 seconds. After this limit is")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# reached the script is terminated with a SIGKILL and the execution retried.")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# NOTIFICATION SCRIPT")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel notification-script <master-name> <script-path>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Call the specified notification script for any sentinel event that is")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# generated in the WARNING level (for instance -sdown, -odown, and so forth).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This script should notify the system administrator via email, SMS, or any")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other messaging system, that there is something wrong with the monitored")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Redis systems.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The script is called with just two arguments: the first is the event type")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# and the second the event description.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The script must exist and be executable in order for sentinel to start if")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# this option is provided.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel notification-script mymaster /var/redis/notify.sh")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数：第一个是事件的类型，第二个是事件的描述。  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对于脚本的运行结果有以下规则：  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。  ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。  ")]),t._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CLIENTS RECONFIGURATION SCRIPT")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel client-reconfig-script <master-name> <script-path>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# When the master changed because of a failover a script can be called in")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# order to perform application-specific tasks to notify the clients that the")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# configuration has changed and the master is at a different address.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The following arguments are passed to the script:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# <master-name> <role> <state> <from-ip> <from-port> <to-ip> <to-port>")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# <state> is currently always "failover"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# <role> is either "leader" or "observer"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The arguments from-ip, from-port, to-ip, to-port are used to communicate")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the old address of the master and the new address of the elected replica")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# (now a master).")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This script should be resistant to multiple invocations.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Example:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sentinel client-reconfig-script mymaster /var/redis/reconfig.sh")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SECURITY")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default SENTINEL SET will not be able to change the notification-script")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# and client-reconfig-script at runtime. This avoids a trivial security issue")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# where clients can set the script to anything and trigger a failover in order")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to get the program executed.")]),t._v("\n\nsentinel deny-scripts-reconfig "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# REDIS COMMANDS RENAMING")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sometimes the Redis server has certain commands, that are needed for Sentinel")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# to work correctly, renamed to unguessable strings. This is often the case")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# of CONFIG and SLAVEOF in the context of providers that provide Redis as")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# a service, and don't want the customers to reconfigure the instances outside")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# of the administration console.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In such case it is possible to tell Sentinel to use different command names")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# instead of the normal ones. For example if the master "mymaster", and the')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# associated replicas, have "CONFIG" all renamed to "GUESSME", I could use:')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SENTINEL rename-command mymaster CONFIG GUESSME")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# After such configuration is set, every time Sentinel would use CONFIG it will")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# use GUESSME instead. Note that there is no actual need to respect the command")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# case, so writing "config guessme" is the same in the example above.')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SENTINEL SET can also be used in order to perform this configuration at runtime.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# In order to set a command back to its original name (undo the renaming), it")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# is possible to just rename a command to itsef:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# SENTINEL rename-command mymaster CONFIG CONFIG")]),t._v("\n")])])]),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/gaobinzhan/article/details/106866813",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose搭建redis-sentinel"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/JulianHuang/p/12650721.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker-compose搭建redis哨兵集群"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cxyzjd.com/article/lushuaiyin/105516690",target:"_blank",rel:"noopener noreferrer"}},[t._v("springboot使用Lettuce配置多数据源（单实例-集群-哨兵）"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=a.exports}}]);