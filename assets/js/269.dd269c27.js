(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{928:function(t,s,e){"use strict";e.r(s);var n=e(58),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"nginx-虚拟主机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-虚拟主机"}},[t._v("#")]),t._v(" Nginx 虚拟主机")]),t._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),e("p",[t._v("虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供 www 服务，这样就可以实现一台主机对外提供多个 web 服务，每个虚拟主机之间是独立的，互不影响的。")]),t._v(" "),e("p",[t._v("通过 Nginx 可以实现虚拟主机的配置，Nginx 支持三种类型的虚拟主机配置")]),t._v(" "),e("ul",[e("li",[t._v("基于 IP 的虚拟主机")]),t._v(" "),e("li",[t._v("基于域名的虚拟主机")]),t._v(" "),e("li",[t._v("基于端口的虚拟主机")])]),t._v(" "),e("p",[t._v("下面是一些简单示例，看看这几种配置的方式，其中基于IP的虚拟主机与基与域名的虚拟主机配置大同小异，这里仅以域名虚拟主机来示例。")]),t._v(" "),e("h2",{attrs:{id:"基于域名的虚拟主机配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于域名的虚拟主机配置"}},[t._v("#")]),t._v(" 基于域名的虚拟主机配置")]),t._v(" "),e("h3",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),e("ul",[e("li",[t._v("两个域名指向同一台 Nginx 服务器(虚拟机，IP地址为 192.168.0.111 )，用户访问不同的域名显示不同的网页内容")]),t._v(" "),e("li",[t._v("两个域名是 service.example.wenwl.com 和 web.example.wenwl.com")])]),t._v(" "),e("h3",{attrs:{id:"配置-hosts"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-hosts"}},[t._v("#")]),t._v(" 配置 Hosts")]),t._v(" "),e("p",[t._v("修改 hosts 文件：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("Windows")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追加 C:\\Windows\\System32\\drivers\\etc下的 hosts 文件")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 service.example.wenwl.com\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 web.example.wenwl.com\n")])])])]),t._v(" "),e("li",[e("p",[t._v("MacOS")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/hosts\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 service.example.wenwl.com\n"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.111 web.example.wenwl.com\n")])])])])]),t._v(" "),e("h3",{attrs:{id:"配置-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx"}},[t._v("#")]),t._v(" 配置 Nginx")]),t._v(" "),e("p",[t._v("用Docker安装Nginx（参考"),e("RouterLink",{attrs:{to:"/nginx/nginx-introduce.html#安装-nginx"}},[t._v("nginx简介")]),t._v("），在 "),e("code",[t._v("/usr/local/docker/nginx/wwwroot")]),t._v(" 目录下创建 "),e("code",[t._v("html-service")]),t._v(" 和 "),e("code",[t._v("html-web")]),t._v(" 两个目录，并分辨创建两个 index.html 文件。")],1),t._v(" "),e("p",[t._v("Nginx虚拟主机配置参考如下：")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("user")]),t._v("  nginx")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工作核心 默认为auto")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_processes")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("       mime.types")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v("  application/octet-stream")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v("        "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("on")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一个虚拟主机的配置")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听的 端口 和 域名/ip")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  service.example.wenwl.com")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 所有的请求都以 / 开始，所有的请求都可以匹配此 location")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 root 指令指定虚拟主机目录即网页存放目录")]),t._v("\n    \t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 比如访问 http://ip/index.html 将找到 /usr/local/docker/nginx/wwwroot/html-service/index.html")]),t._v("\n    \t\t\t\t"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 比如访问 http://ip/item/index.html 将找到 /usr/local/docker/nginx/wwwroot/html-service/item/index.html")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   /usr/share/nginx/wwwroot/html-service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定欢迎页面，按从左到右顺序查找")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 另一个虚拟主机的配置")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  web.example.wenwl.com")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   /usr/share/nginx/wwwroot/html-web")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("建议将  "),e("code",[t._v("server {.......}")]),t._v(" 抽取成 *.conf 文件，独立放在"),e("code",[t._v("conf.d")]),t._v("目录，最后通过浏览器访问两个域名（根据实际情况带上端口号），看是否能够成功访问到对应的页面。")]),t._v(" "),e("h2",{attrs:{id:"基于端口的虚拟主机配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于端口的虚拟主机配置"}},[t._v("#")]),t._v(" 基于端口的虚拟主机配置")]),t._v(" "),e("h3",{attrs:{id:"背景-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景-2"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),e("ul",[e("li",[t._v("Nginx 对外提供 80 和 8080 两个端口监听服务")]),t._v(" "),e("li",[t._v("请求 80 端口则请求 html-80 目录下的 html")]),t._v(" "),e("li",[t._v("请求 8080 端口则请求 html-8080 目录下的 html")])]),t._v(" "),e("h3",{attrs:{id:"配置-nginx-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-2"}},[t._v("#")]),t._v(" 配置 Nginx")]),t._v(" "),e("p",[t._v("在 "),e("code",[t._v("/usr/local/docker/nginx/wwwroot")]),t._v(" 目录下创建 "),e("code",[t._v("html-80")]),t._v(" 和 "),e("code",[t._v("html-8080")]),t._v(" 两个目录，并分别创建两个 index.html 文件")]),t._v(" "),e("p",[t._v("Nginx配置   "),e("code",[t._v("server {.......}")]),t._v(" 部分 参考如下：")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  192.168.0.111")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   /usr/share/nginx/wwwroot/html-80")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  192.168.0.111")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   /usr/share/nginx/wwwroot/html-8080")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token directive"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  index.html index.htm")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);