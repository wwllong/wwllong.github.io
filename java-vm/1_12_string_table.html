<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>String Table | 万隆的笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <script>var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?d8c4de0636e24ecd74e706a345ab8cc9";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();</script>
    <meta name="description" content="小小码农">
    
    <link rel="preload" href="/assets/css/0.styles.e68661c4.css" as="style"><link rel="preload" href="/assets/js/app.bc037eca.js" as="script"><link rel="preload" href="/assets/js/3.a3373ef9.js" as="script"><link rel="preload" href="/assets/js/162.261c214f.js" as="script"><link rel="prefetch" href="/assets/js/10.4df5c055.js"><link rel="prefetch" href="/assets/js/100.0d629d95.js"><link rel="prefetch" href="/assets/js/101.2db02bf9.js"><link rel="prefetch" href="/assets/js/102.d68c24bb.js"><link rel="prefetch" href="/assets/js/103.600018bb.js"><link rel="prefetch" href="/assets/js/104.c413414c.js"><link rel="prefetch" href="/assets/js/105.8c15211b.js"><link rel="prefetch" href="/assets/js/106.84e8ee9b.js"><link rel="prefetch" href="/assets/js/107.a9e7f4b2.js"><link rel="prefetch" href="/assets/js/108.f3285402.js"><link rel="prefetch" href="/assets/js/109.8cf78ec2.js"><link rel="prefetch" href="/assets/js/11.5acc5c3a.js"><link rel="prefetch" href="/assets/js/110.1822bed3.js"><link rel="prefetch" href="/assets/js/111.a9157b2f.js"><link rel="prefetch" href="/assets/js/112.f9617caf.js"><link rel="prefetch" href="/assets/js/113.2cf20d85.js"><link rel="prefetch" href="/assets/js/114.690001dc.js"><link rel="prefetch" href="/assets/js/115.01270cf8.js"><link rel="prefetch" href="/assets/js/116.f58bd27d.js"><link rel="prefetch" href="/assets/js/117.a7d22187.js"><link rel="prefetch" href="/assets/js/118.9b13fb7e.js"><link rel="prefetch" href="/assets/js/119.e56d4413.js"><link rel="prefetch" href="/assets/js/12.944e78c3.js"><link rel="prefetch" href="/assets/js/120.6a373e09.js"><link rel="prefetch" href="/assets/js/121.f05c8ac8.js"><link rel="prefetch" href="/assets/js/122.b23768d7.js"><link rel="prefetch" href="/assets/js/123.274a1455.js"><link rel="prefetch" href="/assets/js/124.1672408d.js"><link rel="prefetch" href="/assets/js/125.7fb88ab5.js"><link rel="prefetch" href="/assets/js/126.5db859c8.js"><link rel="prefetch" href="/assets/js/127.a34ecf8a.js"><link rel="prefetch" href="/assets/js/128.54e15d3c.js"><link rel="prefetch" href="/assets/js/129.6e2cae17.js"><link rel="prefetch" href="/assets/js/13.1d4ba2e8.js"><link rel="prefetch" href="/assets/js/130.6ad457a8.js"><link rel="prefetch" href="/assets/js/131.aeedef23.js"><link rel="prefetch" href="/assets/js/132.443d76bf.js"><link rel="prefetch" href="/assets/js/133.641d77af.js"><link rel="prefetch" href="/assets/js/134.1824a48c.js"><link rel="prefetch" href="/assets/js/135.bf659059.js"><link rel="prefetch" href="/assets/js/136.185d1de5.js"><link rel="prefetch" href="/assets/js/137.5bcb50d7.js"><link rel="prefetch" href="/assets/js/138.5b56d765.js"><link rel="prefetch" href="/assets/js/139.4f07d83f.js"><link rel="prefetch" href="/assets/js/14.78c03a65.js"><link rel="prefetch" href="/assets/js/140.b14458e8.js"><link rel="prefetch" href="/assets/js/141.16eba01d.js"><link rel="prefetch" href="/assets/js/142.67697a4e.js"><link rel="prefetch" href="/assets/js/143.b1ee0e16.js"><link rel="prefetch" href="/assets/js/144.9800e31a.js"><link rel="prefetch" href="/assets/js/145.cdd7e47e.js"><link rel="prefetch" href="/assets/js/146.4d8b9cf6.js"><link rel="prefetch" href="/assets/js/147.1ce23cab.js"><link rel="prefetch" href="/assets/js/148.854fb1e4.js"><link rel="prefetch" href="/assets/js/149.da169cf3.js"><link rel="prefetch" href="/assets/js/15.a60df2b4.js"><link rel="prefetch" href="/assets/js/150.b3d06f97.js"><link rel="prefetch" href="/assets/js/151.16f22697.js"><link rel="prefetch" href="/assets/js/152.e39ae535.js"><link rel="prefetch" href="/assets/js/153.81ecd116.js"><link rel="prefetch" href="/assets/js/154.cbc5938f.js"><link rel="prefetch" href="/assets/js/155.00385d0c.js"><link rel="prefetch" href="/assets/js/156.4517568a.js"><link rel="prefetch" href="/assets/js/157.f1433c46.js"><link rel="prefetch" href="/assets/js/158.5352cd07.js"><link rel="prefetch" href="/assets/js/159.c4f81687.js"><link rel="prefetch" href="/assets/js/16.da7f7410.js"><link rel="prefetch" href="/assets/js/160.3778e817.js"><link rel="prefetch" href="/assets/js/161.4ecebe00.js"><link rel="prefetch" href="/assets/js/163.e7abb47f.js"><link rel="prefetch" href="/assets/js/164.570dd314.js"><link rel="prefetch" href="/assets/js/165.f904d36e.js"><link rel="prefetch" href="/assets/js/166.be1e5538.js"><link rel="prefetch" href="/assets/js/167.eca75917.js"><link rel="prefetch" href="/assets/js/168.5ede7a24.js"><link rel="prefetch" href="/assets/js/169.8f030b14.js"><link rel="prefetch" href="/assets/js/17.ba9ee66f.js"><link rel="prefetch" href="/assets/js/170.5b3d76ad.js"><link rel="prefetch" href="/assets/js/171.d6534d74.js"><link rel="prefetch" href="/assets/js/172.8cfd94b9.js"><link rel="prefetch" href="/assets/js/173.fb4f0904.js"><link rel="prefetch" href="/assets/js/174.7dba6bb9.js"><link rel="prefetch" href="/assets/js/175.c6c8980d.js"><link rel="prefetch" href="/assets/js/176.5c8bee1e.js"><link rel="prefetch" href="/assets/js/177.7d9b6b50.js"><link rel="prefetch" href="/assets/js/178.9b0f6d6b.js"><link rel="prefetch" href="/assets/js/179.851f4874.js"><link rel="prefetch" href="/assets/js/18.68e82e56.js"><link rel="prefetch" href="/assets/js/180.d4946561.js"><link rel="prefetch" href="/assets/js/181.dddb9217.js"><link rel="prefetch" href="/assets/js/182.179b516a.js"><link rel="prefetch" href="/assets/js/183.f6c78374.js"><link rel="prefetch" href="/assets/js/184.1dde444f.js"><link rel="prefetch" href="/assets/js/185.3db3afc3.js"><link rel="prefetch" href="/assets/js/186.2c0f07eb.js"><link rel="prefetch" href="/assets/js/187.5f6f57ff.js"><link rel="prefetch" href="/assets/js/188.97586f9f.js"><link rel="prefetch" href="/assets/js/189.8a39dde2.js"><link rel="prefetch" href="/assets/js/19.9aa6dcce.js"><link rel="prefetch" href="/assets/js/190.96731259.js"><link rel="prefetch" href="/assets/js/191.d096d222.js"><link rel="prefetch" href="/assets/js/192.a921d348.js"><link rel="prefetch" href="/assets/js/193.a3e07c61.js"><link rel="prefetch" href="/assets/js/194.8934403d.js"><link rel="prefetch" href="/assets/js/195.13b302ff.js"><link rel="prefetch" href="/assets/js/196.4ad81cf9.js"><link rel="prefetch" href="/assets/js/197.8a23e1be.js"><link rel="prefetch" href="/assets/js/198.a1bf2bc3.js"><link rel="prefetch" href="/assets/js/199.c6abf07d.js"><link rel="prefetch" href="/assets/js/2.98bbb7f5.js"><link rel="prefetch" href="/assets/js/20.513c8e9b.js"><link rel="prefetch" href="/assets/js/200.f5a2f491.js"><link rel="prefetch" href="/assets/js/201.03671056.js"><link rel="prefetch" href="/assets/js/202.f94ec544.js"><link rel="prefetch" href="/assets/js/203.2a09fec0.js"><link rel="prefetch" href="/assets/js/204.e56dddcb.js"><link rel="prefetch" href="/assets/js/205.f48c8602.js"><link rel="prefetch" href="/assets/js/206.a8d9bcc4.js"><link rel="prefetch" href="/assets/js/207.e4016538.js"><link rel="prefetch" href="/assets/js/208.be8af315.js"><link rel="prefetch" href="/assets/js/209.4cfde3a6.js"><link rel="prefetch" href="/assets/js/21.1e72e195.js"><link rel="prefetch" href="/assets/js/210.f4936cb6.js"><link rel="prefetch" href="/assets/js/211.063bdacd.js"><link rel="prefetch" href="/assets/js/212.353d50f2.js"><link rel="prefetch" href="/assets/js/213.094a5cfc.js"><link rel="prefetch" href="/assets/js/214.d16aa2d2.js"><link rel="prefetch" href="/assets/js/215.bc88e375.js"><link rel="prefetch" href="/assets/js/216.45511649.js"><link rel="prefetch" href="/assets/js/217.99946f6f.js"><link rel="prefetch" href="/assets/js/218.43a39089.js"><link rel="prefetch" href="/assets/js/219.d14424be.js"><link rel="prefetch" href="/assets/js/22.324c39b4.js"><link rel="prefetch" href="/assets/js/220.882e9a86.js"><link rel="prefetch" href="/assets/js/221.40e3d13e.js"><link rel="prefetch" href="/assets/js/222.23004b98.js"><link rel="prefetch" href="/assets/js/223.5130614a.js"><link rel="prefetch" href="/assets/js/224.2a560c15.js"><link rel="prefetch" href="/assets/js/225.92cc9d19.js"><link rel="prefetch" href="/assets/js/226.38630a69.js"><link rel="prefetch" href="/assets/js/227.ddd1a6d3.js"><link rel="prefetch" href="/assets/js/228.2d4cf247.js"><link rel="prefetch" href="/assets/js/229.458c49c4.js"><link rel="prefetch" href="/assets/js/23.beabd1c9.js"><link rel="prefetch" href="/assets/js/230.1530afe6.js"><link rel="prefetch" href="/assets/js/231.26875105.js"><link rel="prefetch" href="/assets/js/232.3c906b6a.js"><link rel="prefetch" href="/assets/js/233.d633d2c5.js"><link rel="prefetch" href="/assets/js/234.841291f0.js"><link rel="prefetch" href="/assets/js/235.de892702.js"><link rel="prefetch" href="/assets/js/236.a0ff8c56.js"><link rel="prefetch" href="/assets/js/237.bbc7b6ef.js"><link rel="prefetch" href="/assets/js/238.b53d8e52.js"><link rel="prefetch" href="/assets/js/239.ae488c24.js"><link rel="prefetch" href="/assets/js/24.a2f1a1cf.js"><link rel="prefetch" href="/assets/js/240.06d1aa99.js"><link rel="prefetch" href="/assets/js/241.e782f534.js"><link rel="prefetch" href="/assets/js/242.cae48a9d.js"><link rel="prefetch" href="/assets/js/243.4eea58f3.js"><link rel="prefetch" href="/assets/js/244.b3cfbb67.js"><link rel="prefetch" href="/assets/js/245.734f2b40.js"><link rel="prefetch" href="/assets/js/246.83ba6a01.js"><link rel="prefetch" href="/assets/js/247.bee3fa17.js"><link rel="prefetch" href="/assets/js/248.633a3a01.js"><link rel="prefetch" href="/assets/js/249.cbcc1465.js"><link rel="prefetch" href="/assets/js/25.1598a580.js"><link rel="prefetch" href="/assets/js/250.7b21393b.js"><link rel="prefetch" href="/assets/js/251.2fb1b244.js"><link rel="prefetch" href="/assets/js/252.c0e95582.js"><link rel="prefetch" href="/assets/js/253.42d96179.js"><link rel="prefetch" href="/assets/js/254.2f556423.js"><link rel="prefetch" href="/assets/js/255.5c518629.js"><link rel="prefetch" href="/assets/js/256.6c37f138.js"><link rel="prefetch" href="/assets/js/257.bfaf2b90.js"><link rel="prefetch" href="/assets/js/258.501c8dec.js"><link rel="prefetch" href="/assets/js/259.433c5a35.js"><link rel="prefetch" href="/assets/js/26.14532494.js"><link rel="prefetch" href="/assets/js/260.7133674c.js"><link rel="prefetch" href="/assets/js/261.7c497a98.js"><link rel="prefetch" href="/assets/js/262.ef906292.js"><link rel="prefetch" href="/assets/js/263.7b1b901f.js"><link rel="prefetch" href="/assets/js/264.36ebfc79.js"><link rel="prefetch" href="/assets/js/265.33897322.js"><link rel="prefetch" href="/assets/js/266.8670f739.js"><link rel="prefetch" href="/assets/js/267.ec8f4c6a.js"><link rel="prefetch" href="/assets/js/268.487e3ecf.js"><link rel="prefetch" href="/assets/js/269.dd269c27.js"><link rel="prefetch" href="/assets/js/27.182ae611.js"><link rel="prefetch" href="/assets/js/270.bfc37c9e.js"><link rel="prefetch" href="/assets/js/271.b1193de2.js"><link rel="prefetch" href="/assets/js/272.4d22dbda.js"><link rel="prefetch" href="/assets/js/273.f76b57ca.js"><link rel="prefetch" href="/assets/js/274.8aa70460.js"><link rel="prefetch" href="/assets/js/275.f8a4d784.js"><link rel="prefetch" href="/assets/js/276.73193b56.js"><link rel="prefetch" href="/assets/js/277.eb11f3ab.js"><link rel="prefetch" href="/assets/js/278.bbbd0f67.js"><link rel="prefetch" href="/assets/js/279.0d5be41f.js"><link rel="prefetch" href="/assets/js/28.cc74fb69.js"><link rel="prefetch" href="/assets/js/280.e937fced.js"><link rel="prefetch" href="/assets/js/281.3e4a2290.js"><link rel="prefetch" href="/assets/js/282.927224e7.js"><link rel="prefetch" href="/assets/js/283.11981dd7.js"><link rel="prefetch" href="/assets/js/284.f51d8c6d.js"><link rel="prefetch" href="/assets/js/285.36e1d9fd.js"><link rel="prefetch" href="/assets/js/286.6ae62cc1.js"><link rel="prefetch" href="/assets/js/287.83708e55.js"><link rel="prefetch" href="/assets/js/288.bae95807.js"><link rel="prefetch" href="/assets/js/289.96cf6017.js"><link rel="prefetch" href="/assets/js/29.e3df47e0.js"><link rel="prefetch" href="/assets/js/290.c8bbd938.js"><link rel="prefetch" href="/assets/js/291.ee2a4137.js"><link rel="prefetch" href="/assets/js/292.37a36b48.js"><link rel="prefetch" href="/assets/js/293.6589f01f.js"><link rel="prefetch" href="/assets/js/294.9e2c7ac2.js"><link rel="prefetch" href="/assets/js/295.54f91c63.js"><link rel="prefetch" href="/assets/js/296.437948b8.js"><link rel="prefetch" href="/assets/js/297.77b67b30.js"><link rel="prefetch" href="/assets/js/298.847026f8.js"><link rel="prefetch" href="/assets/js/299.f7987fa5.js"><link rel="prefetch" href="/assets/js/30.d956a42b.js"><link rel="prefetch" href="/assets/js/300.fb926d10.js"><link rel="prefetch" href="/assets/js/301.39be1acb.js"><link rel="prefetch" href="/assets/js/302.0d4b2462.js"><link rel="prefetch" href="/assets/js/303.797685f0.js"><link rel="prefetch" href="/assets/js/304.953dd6d8.js"><link rel="prefetch" href="/assets/js/305.45a68780.js"><link rel="prefetch" href="/assets/js/306.9436c9f7.js"><link rel="prefetch" href="/assets/js/307.c8da713f.js"><link rel="prefetch" href="/assets/js/308.42164c3a.js"><link rel="prefetch" href="/assets/js/309.08138204.js"><link rel="prefetch" href="/assets/js/31.b08efb45.js"><link rel="prefetch" href="/assets/js/310.3bdab8a3.js"><link rel="prefetch" href="/assets/js/311.6cb6bc2c.js"><link rel="prefetch" href="/assets/js/312.b2211997.js"><link rel="prefetch" href="/assets/js/313.27e5d88b.js"><link rel="prefetch" href="/assets/js/314.4345463c.js"><link rel="prefetch" href="/assets/js/315.cfd666b9.js"><link rel="prefetch" href="/assets/js/316.744f1ea3.js"><link rel="prefetch" href="/assets/js/317.0a990397.js"><link rel="prefetch" href="/assets/js/318.49bfe4f7.js"><link rel="prefetch" href="/assets/js/319.0e9f0404.js"><link rel="prefetch" href="/assets/js/32.42eb6c80.js"><link rel="prefetch" href="/assets/js/320.95c40fa6.js"><link rel="prefetch" href="/assets/js/321.d3557402.js"><link rel="prefetch" href="/assets/js/322.381f65d0.js"><link rel="prefetch" href="/assets/js/323.883198dc.js"><link rel="prefetch" href="/assets/js/324.cad6119f.js"><link rel="prefetch" href="/assets/js/325.90509c04.js"><link rel="prefetch" href="/assets/js/33.cba29bcc.js"><link rel="prefetch" href="/assets/js/34.60629bfe.js"><link rel="prefetch" href="/assets/js/35.a60b566c.js"><link rel="prefetch" href="/assets/js/36.099489dc.js"><link rel="prefetch" href="/assets/js/37.a40ed816.js"><link rel="prefetch" href="/assets/js/38.7e946531.js"><link rel="prefetch" href="/assets/js/39.1e9449ed.js"><link rel="prefetch" href="/assets/js/4.0893bcb9.js"><link rel="prefetch" href="/assets/js/40.a68e55dd.js"><link rel="prefetch" href="/assets/js/41.c2410ec6.js"><link rel="prefetch" href="/assets/js/42.6059e0a0.js"><link rel="prefetch" href="/assets/js/43.666eab60.js"><link rel="prefetch" href="/assets/js/44.6d2bc28e.js"><link rel="prefetch" href="/assets/js/45.23095742.js"><link rel="prefetch" href="/assets/js/46.2c644d05.js"><link rel="prefetch" href="/assets/js/47.0c53d023.js"><link rel="prefetch" href="/assets/js/48.6763315e.js"><link rel="prefetch" href="/assets/js/49.5df08a8b.js"><link rel="prefetch" href="/assets/js/5.0c8b00ed.js"><link rel="prefetch" href="/assets/js/50.21bed711.js"><link rel="prefetch" href="/assets/js/51.cc283ef4.js"><link rel="prefetch" href="/assets/js/52.448e1e19.js"><link rel="prefetch" href="/assets/js/53.8d139bfe.js"><link rel="prefetch" href="/assets/js/54.ab823596.js"><link rel="prefetch" href="/assets/js/55.28d6b882.js"><link rel="prefetch" href="/assets/js/56.799dfc32.js"><link rel="prefetch" href="/assets/js/57.47844017.js"><link rel="prefetch" href="/assets/js/58.a3636228.js"><link rel="prefetch" href="/assets/js/59.b88e34c1.js"><link rel="prefetch" href="/assets/js/6.a436075e.js"><link rel="prefetch" href="/assets/js/60.08d9b769.js"><link rel="prefetch" href="/assets/js/61.62eaaae6.js"><link rel="prefetch" href="/assets/js/62.2e8a878d.js"><link rel="prefetch" href="/assets/js/63.498c3cfe.js"><link rel="prefetch" href="/assets/js/64.32bf8090.js"><link rel="prefetch" href="/assets/js/65.0f690d46.js"><link rel="prefetch" href="/assets/js/66.90352622.js"><link rel="prefetch" href="/assets/js/67.480bdaa6.js"><link rel="prefetch" href="/assets/js/68.9979d713.js"><link rel="prefetch" href="/assets/js/69.780f4d95.js"><link rel="prefetch" href="/assets/js/7.4d9f4e60.js"><link rel="prefetch" href="/assets/js/70.c2ca172c.js"><link rel="prefetch" href="/assets/js/71.ae3f1c72.js"><link rel="prefetch" href="/assets/js/72.93cde0ad.js"><link rel="prefetch" href="/assets/js/73.8ee7e6cc.js"><link rel="prefetch" href="/assets/js/74.cde76b4d.js"><link rel="prefetch" href="/assets/js/75.1f2c3f1d.js"><link rel="prefetch" href="/assets/js/76.960c7d73.js"><link rel="prefetch" href="/assets/js/77.9d4b9659.js"><link rel="prefetch" href="/assets/js/78.310cf545.js"><link rel="prefetch" href="/assets/js/79.bd667333.js"><link rel="prefetch" href="/assets/js/8.7541ba14.js"><link rel="prefetch" href="/assets/js/80.f42edee8.js"><link rel="prefetch" href="/assets/js/81.dda99508.js"><link rel="prefetch" href="/assets/js/82.ec338e99.js"><link rel="prefetch" href="/assets/js/83.66b1f5b4.js"><link rel="prefetch" href="/assets/js/84.2173e568.js"><link rel="prefetch" href="/assets/js/85.3b5e4e47.js"><link rel="prefetch" href="/assets/js/86.3c179528.js"><link rel="prefetch" href="/assets/js/87.28691828.js"><link rel="prefetch" href="/assets/js/88.5830058a.js"><link rel="prefetch" href="/assets/js/89.2e630253.js"><link rel="prefetch" href="/assets/js/9.038ee2be.js"><link rel="prefetch" href="/assets/js/90.05aa65c3.js"><link rel="prefetch" href="/assets/js/91.99ac4500.js"><link rel="prefetch" href="/assets/js/92.f1bd8f70.js"><link rel="prefetch" href="/assets/js/93.f35f7adf.js"><link rel="prefetch" href="/assets/js/94.f6780083.js"><link rel="prefetch" href="/assets/js/95.be362a29.js"><link rel="prefetch" href="/assets/js/96.f8368d2d.js"><link rel="prefetch" href="/assets/js/97.745204bf.js"><link rel="prefetch" href="/assets/js/98.58c8fcaa.js"><link rel="prefetch" href="/assets/js/99.d4d25887.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e68661c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="万隆的笔记" class="logo"> <span class="site-name can-hide">万隆的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes-guide/" class="nav-link">
  博文索引
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线资源" class="dropdown-title"><span class="title">在线资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线资源" class="mobile-dropdown-title"><span class="title">在线资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线学站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.runoob.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  菜鸟教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.w3cschool.cn/tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  入门教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.coursera.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coursera
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.w3school.com.cn/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3school
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.bootcss.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tool 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bejson 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://smallpdf.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/online/" class="nav-link">
  更多在线资源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/change-logs/" class="nav-link">
  Changlog
</a></li><li class="dropdown-item"><!----> <a href="/more/about-me.html" class="nav-link">
  Aboutme
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wwllong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes-guide/" class="nav-link">
  博文索引
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线资源" class="dropdown-title"><span class="title">在线资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线资源" class="mobile-dropdown-title"><span class="title">在线资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线学站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.runoob.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  菜鸟教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.w3cschool.cn/tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  入门教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.coursera.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coursera
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.w3school.com.cn/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3school
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.bootcss.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tool 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bejson 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://smallpdf.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/online/" class="nav-link">
  更多在线资源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/change-logs/" class="nav-link">
  Changlog
</a></li><li class="dropdown-item"><!----> <a href="/more/about-me.html" class="nav-link">
  Aboutme
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wwllong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java虚拟机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/" aria-current="page" class="sidebar-link">大纲</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>走近Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/0_1_foreword.html" class="sidebar-link">JVM前言</a></li><li><a href="/java-vm/0_2_java_jvm_introd.html" class="sidebar-link">Java与JVM简介</a></li><li><a href="/java-vm/0_3_jvm_framework.html" class="sidebar-link">JVM架构模型</a></li><li><a href="/java-vm/0_4_jvm_life_cycle.html" class="sidebar-link">JVM生命周期</a></li><li><a href="/java-vm/0_5_java_histroy.html" class="sidebar-link">Java的发展重大事件</a></li><li><a href="/java-vm/0_6_jvm_family.html" class="sidebar-link">JVM家族</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>内存与垃圾回收</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/1_1_memory_structure.html" class="sidebar-link">JVM内存结构图</a></li><li><a href="/java-vm/1_2_class_loading_sys.html" class="sidebar-link">类加载器子系统</a></li><li><a href="/java-vm/1_3_runtime_data_area_ov.html" class="sidebar-link">运行时数据区</a></li><li><a href="/java-vm/1_4_pc_register.html" class="sidebar-link">程序计数器（PC寄存器）</a></li><li><a href="/java-vm/1_5_vm_statck.html" class="sidebar-link">虚拟机栈</a></li><li><a href="/java-vm/1_6_native_method_stack.html" class="sidebar-link">本地方法栈</a></li><li><a href="/java-vm/1_7_heap.html" class="sidebar-link">堆</a></li><li><a href="/java-vm/1_8_methods_area.html" class="sidebar-link">方法区</a></li><li><a href="/java-vm/1_8_1_methods_area.html" class="sidebar-link">- 方法区使用举例图解</a></li><li><a href="/java-vm/1_9_new_object.html" class="sidebar-link">对象的实例化</a></li><li><a href="/java-vm/1_10_direct_memory.html" class="sidebar-link">直接内存</a></li><li><a href="/java-vm/1_11_execution_engine.html" class="sidebar-link">执行引擎</a></li><li><a href="/java-vm/1_12_string_table.html" aria-current="page" class="active sidebar-link">String Table</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#string在jdk9中存储结构变更" class="sidebar-link">String在jdk9中存储结构变更</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#string的基本特性" class="sidebar-link">String的基本特性</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#string的内存分配" class="sidebar-link">String的内存分配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#string-table为什么要调整" class="sidebar-link">String Table为什么要调整？</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#string的基本操作" class="sidebar-link">String的基本操作</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#字符串拼接操作" class="sidebar-link">字符串拼接操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#字符拼接的底层原理" class="sidebar-link">字符拼接的底层原理</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#拼接执行效率对比" class="sidebar-link">拼接执行效率对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#intern-的使用" class="sidebar-link">intern()的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#intern与常量池" class="sidebar-link">intern与常量池</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#intern的使用-jdk-6-vs-jdk-7-8" class="sidebar-link">intern的使用：JDK 6 vs JDK 7/8</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#intern的效率测试-空间角度" class="sidebar-link">intern的效率测试：空间角度</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#stringtable的垃圾回收" class="sidebar-link">StringTable的垃圾回收</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#g1中的string去重操作" class="sidebar-link">G1中的String去重操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header"><a href="/java-vm/1_12_string_table.html#命令行选项" class="sidebar-link">命令行选项</a></li></ul></li></ul></li><li><a href="/java-vm/1_13_gc_introd.html" class="sidebar-link">垃圾回收概述</a></li><li><a href="/java-vm/1_14_gc_concept.html" class="sidebar-link">垃圾回收相关概念</a></li><li><a href="/java-vm/1_15_gc_algs.html" class="sidebar-link">垃圾回收算法</a></li><li><a href="/java-vm/1_16_gc_collector.html" class="sidebar-link">垃圾收集器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>字节码与类加载</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/2_1_class_sys_introd.html" class="sidebar-link">JVM基石：class文件</a></li><li><a href="/java-vm/2_2_class_file_struct.html" class="sidebar-link">class文件结构</a></li><li><a href="/java-vm/2_2_1_class_file_javap.html" class="sidebar-link">javap解析class文件</a></li><li><a href="/java-vm/2_3_bytecode_instruction_set.html" class="sidebar-link">字节码指令集</a></li><li><a href="/java-vm/2_4_class_loading_process.html" class="sidebar-link">类加载过程（类生命周期）</a></li><li><a href="/java-vm/2_5_class_loader.html" class="sidebar-link">再谈类的加载器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能监控与调优</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/3_1_tuning_introd.html" class="sidebar-link">概述</a></li><li><a href="/java-vm/3_2_tuning_command.html" class="sidebar-link">JVM监控及诊断工具-命令行篇</a></li><li><a href="/java-vm/3_3_tuning_gui.html" class="sidebar-link">JVM监控及诊断工具-GUI篇</a></li><li><a href="/java-vm/3_4_tuning_vmparam.html" class="sidebar-link">JVM运行时参数</a></li><li><a href="/java-vm/1_17_gc_log.html" class="sidebar-link">GC日志分析</a></li><li><a href="/java-vm/3_6_tuning_heap_shallow_retained.html" class="sidebar-link">浅堆深堆与支配树</a></li><li><a href="/java-vm/3_8_tuning_heap_leak_overflow.html" class="sidebar-link">内存泄漏与内存溢出</a></li><li><a href="/java-vm/3_7_tuning_qql.html" class="sidebar-link">QQL语言查询对象信息</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>监控与性能调优案例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/3_tuning_case0_introd.html" class="sidebar-link">概述</a></li><li><a href="/java-vm/3_tuning_case0_tomcat_hoom.html" class="sidebar-link">Tomcat堆溢出分析</a></li><li><a href="/java-vm/3_tuning_case1_heap_oom.html" class="sidebar-link">堆溢出</a></li><li><a href="/java-vm/3_tuning_case2_method_oom.html" class="sidebar-link">方法区溢出</a></li><li><a href="/java-vm/3_tuning_case3_limit_exceeded.html" class="sidebar-link">GC overhead limit exceeded</a></li><li><a href="/java-vm/3_tuning_case4_thread_oom.html" class="sidebar-link">线程溢出</a></li><li><a href="/java-vm/3_tuning_perf_case1_tps.html" class="sidebar-link">调整堆大小提高服务的吞吐量</a></li><li><a href="/java-vm/3_tuning_perf_case2_jit.html" class="sidebar-link">JVM优化之JIT优化</a></li><li><a href="/java-vm/3_tuning_perf_case3_heapsize.html" class="sidebar-link">合理配置堆内存</a></li><li><a href="/java-vm/3_tuning_perf_case4_cpu_hight.html" class="sidebar-link">CPU占用很高排查方案</a></li><li><a href="/java-vm/3_tuning_perf_case5_g1.html" class="sidebar-link">G1并发执行的线程数对性能的影响</a></li><li><a href="/java-vm/3_tuning_perf_case6_gcc.html" class="sidebar-link">调整垃圾回收器提高服务的吞吐量</a></li><li><a href="/java-vm/3_tuning_perf_case7_millions4orders.html" class="sidebar-link">日均百万级订单交易系统如何设置JVM参数</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="string-table"><a href="#string-table" class="header-anchor">#</a> String Table</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <ul><li>String，字符串。可以用字面量方式使用一对&quot;&quot;引起来表示，还可以以创建对象（new）的方式创建字符串。</li> <li>String类被声明为final的，表示不可被继承。</li> <li>String类实现了Serializable接口，表示字符串是支持序列化的。</li> <li>String类实现了Comparable接口，表示String可以比较大小。</li> <li>注意，String在JDK 8及以前内部定义了<code>final char[] value</code>用于存储字符串数据。JDK 9之后改为<code>final byte[] value</code>。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// JDK 8</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span> <span class="token punctuation">{</span>
    <span class="token comment">/** The value is used for character storage. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="string在jdk9中存储结构变更"><a href="#string在jdk9中存储结构变更" class="header-anchor">#</a> String在jdk9中存储结构变更</h3> <p>官网地址：<a href="http://openjdk.java.net/jeps/254" target="_blank" rel="noopener noreferrer">JEP 254: Compact Strings (java.net)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>动机：目前String类的实现将字符存储在一个char数组中，每个字符使用两个字节（16位）。从许多不同的应用中收集到的数据表明，字符串是堆使用的主要组成部分，此外，大多数字符串对象只包含Latin-1字符（拉丁文字符）。这些字符只需要一个字节的存储空间，因此这些字符串对象的内部字符数组中有一半的空间没有被使用。</p> <p>说明：我们建议将String类的内部表示方法从UTF-16字符数组改为字节数组加编码标志域。新的String类将根据字符串的内容，以ISO-8859-1/Latin-1（每个字符一个字节）或UTF-16（每个字符两个字节）的方式存储字符编码。编码标志将表明使用的是哪种编码。</p> <p>与字符串相关的类，如AbstractStringBuilder、StringBuilder和StringBuffer将被更新以使用相同的表示方法，HotSpot VM的内在字符串操作也是如此。</p> <p>这纯粹是一个实现上的变化，对现有的公共接口没有变化。目前没有计划增加任何新的公共API或其他接口。</p> <p>迄今为止所做的原型设计工作证实了内存占用的预期减少，GC活动的大幅减少，以及在某些角落情况下的轻微性能倒退。</p> <blockquote><p><strong>Motivation</strong></p> <p>The current implementation of the <code>String</code> class stores characters in a <code>char</code> array, using two bytes (sixteen bits) for each character. Data gathered from many different applications indicates that strings are a major component of heap usage and, moreover, that most <code>String</code> objects contain only Latin-1 characters. Such characters require only one byte of storage, hence half of the space in the internal <code>char</code> arrays of such <code>String</code> objects is going unused.</p> <p><strong>Description</strong></p> <p>We propose to change the internal representation of the <code>String</code> class from a UTF-16 <code>char</code> array to a <code>byte</code> array plus an encoding-flag field. The new <code>String</code> class will store characters encoded either as ISO-8859-1/Latin-1 (one byte per character), or as UTF-16 (two bytes per character), based upon the contents of the string. The encoding flag will indicate which encoding is used.</p> <p>String-related classes such as <code>AbstractStringBuilder</code>, <code>StringBuilder</code>, and <code>StringBuffer</code> will be updated to use the same representation, as will the HotSpot VM's intrinsic string operations.</p> <p>This is purely an implementation change, with no changes to existing public interfaces. There are no plans to add any new public APIs or other interfaces.</p> <p>The prototyping work done to date confirms the expected reduction in memory footprint, substantial reductions of GC activity, and minor performance regressions in some corner cases.</p></blockquote> <p>结论：<strong>JDK 9 以后String再也不用<code>char[]</code>来存储了，改成了<code>byte []</code>加上编码标记，节约了一些空间</strong>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Stable</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="string的基本特性"><a href="#string的基本特性" class="header-anchor">#</a> String的基本特性</h2> <ol><li>String，代表不可变的字符序列，简称：<strong>不可变性</strong>。</li></ol> <ul><li>当对字符串重新赋值时，需要重写指定内存区域赋值，不能使用原有的value进行赋值。</li> <li>当对现有的字符串进行连接操作时，也需要重新指定内存区域赋值，不能使用原有的value进行赋值。</li> <li>当调用String的<code>replace()</code>方法修改指定字符或字符串时，也需要重新指定内存区域赋值，不能使用原有的value进行赋值。</li></ul> <ol start="2"><li><p>通过<strong>字面量的方式（区别于new）给一个字符串赋值，此时的字符串值声明在字符串常量池中</strong>。</p> <ul><li><strong>字符串常量池是不会存储相同内容的字符串</strong></li></ul></li> <li><p>String的String Pool是<strong>一个固定大小的HashTable</strong>，（JDK 6）默认值大小长度是<strong>1009</strong>。如果放进String Pool的String非常多，就会造成Hash冲突严重，从而导致链表会很长，而链表长了后直接会造成的影响就是当调用String.intern()时性能会大幅下降。</p> <p>使用<code>-XX:StringTablesize</code>可设置StringTable的长度</p> <ul><li>在JDK 6中StringTable是固定的，就是<strong>1009</strong>的长度，所以如果常量池中的字符串过多就会导致效率下降很快,<code>StringTablesize</code>设置没有要求</li> <li>在JDK 7中，<code>StringTable</code>的长度默认值是<strong>60013</strong>，<code>StringTablesize</code>设置没有要求</li> <li>在JDK 8中，设置<code>StringTable</code>长度的话，1009是可以设置的最小值</li></ul></li></ol> <h2 id="string的内存分配"><a href="#string的内存分配" class="header-anchor">#</a> String的内存分配</h2> <p>在Java语言中有8种基本数据类型和一种比较特殊的类型String。这些类型为了使它们在运行过程中速度更快、更节省内存，都提供了一种<strong>常量池</strong>的概念。</p> <p>常量池就类似一个Java系统级别提供的缓存，8种基本数据类型的常量池都是系统协调的，String类型的常量池比较特殊。它的主要使用方法有两种：</p> <ul><li>直接使用<strong>双引号声明</strong>出来的String对象会直接存储在常量池中。</li> <li>如果不是用双引号声明的String对象，可以使用String提供的**intern()**方法（这个后面重点谈）。</li></ul> <p>字符串常量池存放位置：</p> <ul><li>Java 6及以前，字符串常量池存放在<strong>永久代</strong>。</li> <li>Java 7开始中Oracle的工程师对字符串池的逻辑做了很大的改变，即将字符串常量池的位置调整到<strong>Java堆</strong>内。
<ul><li>所有的字符串都保存在堆（Heap）中，和其他普通对象一样，这样可以让你在进行调优应用时仅需要调整堆大小就可以了。</li> <li>字符串常量池概念原本使用得比较多，但是这个改动使得我们有足够的理由让我们重新考虑在Java 7中使用String.intern()。</li></ul></li> <li>Java 8 引入了元空间，但字符串常量还是在堆中。</li></ul> <p><img src="https://qiniu.wenwl.site/notes/jvm/methods_area_12.png" alt="methods_area_12.png"></p> <p><img src="https://qiniu.wenwl.site/notes/jvm/methods_area_13.png" alt="methods_area_13.png"></p> <p><img src="https://qiniu.wenwl.site/notes/jvm/methods_area_14.png" alt="methods_area_14.png"></p> <h3 id="string-table为什么要调整"><a href="#string-table为什么要调整" class="header-anchor">#</a> String Table为什么要调整？</h3> <p>官网地址：<a href="https://www.oracle.com/java/technologies/javase/jdk7-relnotes.html#jdk7changes" target="_blank" rel="noopener noreferrer">Java SE 7 Features and Enhancements (oracle.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>简介：在JDK 7中，内部字符串不再分配在Java堆的永久代中，而是分配在Java堆的主要部分（称为年轻代和老年代），与应用程序创建的其他对象一起。这种变化将导致更多的数据驻留在主Java堆中，而更少的数据在永久代中，因此可能需要调整堆的大小。大多数应用程序将看到由于这一变化而导致的堆使用的相对较小的差异，但加载许多类或大量使用String.intern()方法的大型应用程序将看到更明显的差异。</p> <blockquote><p>Synopsis: In JDK 7, interned strings are no longer allocated in the permanent generation of the Java heap, but are instead allocated in the main part of the Java heap (known as the young and old generations), along with the other objects created by the application. This change will result in more data residing in the main Java heap, and less data in the permanent generation, and thus may require heap sizes to be adjusted. Most applications will see only relatively small differences in heap usage due to this change, but larger applications that load many classes or make heavy use of the String.intern() method will see more significant differences.</p></blockquote> <p>简单来说，主要是两点：</p> <ul><li>permSize默认比较小</li> <li>永久代回频率低</li></ul> <h2 id="string的基本操作"><a href="#string的基本操作" class="header-anchor">#</a> String的基本操作</h2> <p>实验环境：Mac OS， M1 Pro 32G， OpenJDK 64-Bit Server VM（ARM）, 后面的程序都在这个环境下执行的。</p> <p>证明String常量池的存在：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// java.lang.String count 1176</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 1176</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1185</span>
    <span class="token comment">// 如下的字符串&quot;1&quot; 到 &quot;10&quot;不会再次加载</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1186</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1186</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;9&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1186</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Java语言规范里要求<strong>完全相同的字符串字面量，应该包含同样的Unicode字符序列（包含同一份码点序列的常量），并且必须是指向同一个String类实例</strong>。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Memory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//line 1</span>
        <span class="token keyword">int</span> i<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//line 2</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 3</span>
        <span class="token class-name">Memory</span> mem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Memory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Line 4</span>
        mem<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Line 5</span>
    <span class="token punctuation">}</span><span class="token comment">//Line 9</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> param<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//line 6</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> param<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line 7</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token comment">//Line 8</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_1.png" alt="string_table_1"></p> <h2 id="字符串拼接操作"><a href="#字符串拼接操作" class="header-anchor">#</a> 字符串拼接操作</h2> <ul><li><strong>常量与常量的拼接结果在常量池，原理是编译期进行了优化</strong>。</li> <li><strong>常量池中不会存在相同内容的变量</strong>。</li> <li><strong>拼接操作中只要其中有一个是变量，那么对象结果就在堆中</strong>，变量拼接的原理是<code>StringBuilder</code>。</li> <li><strong>如果拼接的结果调用<code>intern()</code>方法，则主动将常量池中还没有的字符串对象放入池中，并返回此对象地址</strong>。</li></ul> <p>例子1：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;b&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 编译期优化：等同于&quot;abc&quot;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span> <span class="token comment">// &quot;abc&quot;一定是放在字符串常量池中，将此地址赋给s2</span>
    <span class="token comment">/*
     * 最终.java编译成.class,再执行.class
     * String s1 = &quot;abc&quot;;
     * String s2 = &quot;abc&quot;
     */</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>例子2：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;javaEE&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;javaEEhadoop&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 编译期优化</span>
    <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;javaEE&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">;</span> 
    <span class="token comment">// 如果拼接符号的前后出现了变量，则相当于在堆空间中 new String()，具体的内容为拼接的结果：javaEEhadoop</span>
    <span class="token class-name">String</span> s5 <span class="token operator">=</span> s1 <span class="token operator">+</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s6 <span class="token operator">=</span> <span class="token string">&quot;javaEE&quot;</span> <span class="token operator">+</span> s2<span class="token punctuation">;</span>
    <span class="token class-name">String</span> s7 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s6<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s5 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s6 <span class="token operator">==</span> s7<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
    <span class="token comment">// intern(): 判断字符串常量池中是否存在javaEEhadoop值，如果存在，则返回常量池中javaEEhadoop的地址；</span>
    <span class="token comment">// 如果字符串常量池中不存在javaEEhadoop，则在常量池中加载一份javaEEhadoop，并返回此对象的地址。</span>
    <span class="token class-name">String</span> s8 <span class="token operator">=</span> s6<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="字符拼接的底层原理"><a href="#字符拼接的底层原理" class="header-anchor">#</a> 字符拼接的底层原理</h3> <p>接下来以例子3为例，说说字符串拼接的原理：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中<code>String s4 = s1 + s2</code>的执行细节如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>
<span class="token comment">/*
如下的s1 + s2 的执行细节：(变量s是我临时定义的）
① StringBuilder s = new StringBuilder();
② s.append(&quot;a&quot;)
③ s.append(&quot;b&quot;)
④ s.toString()  --&gt; 约等于 new String(&quot;ab&quot;)
*/</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_2.png" alt="string_table_2"></p> <p>也就是说，变量拼接的原理是<code>StringBuilder</code>。补充：在JDK 5.0之后使用的是<code>StringBuilder</code>, 在JDK 5.0之前使用的是<code>StringBuffer</code>。</p> <p>注意：<strong>字符串拼接操作不一定使用的是<code>StringBuilder</code>!</strong></p> <ul><li>如果拼接符号左右两边都是<strong>字符串常量</strong>或<strong>常量引用</strong>，则<strong>仍然使用编译期优化</strong>，即非StringBuilder的方式。</li> <li>针对于final修饰类、方法、基本数据类型、引用数据类型的量的结构时，能使用上final的时候建议使用上。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token string">&quot;ab&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s4 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span> <span class="token comment">// 编译期优化，s4 = &quot;ab&quot;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>练习：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">&quot;javaEEhadoop&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;javaEE&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> s3 <span class="token operator">=</span> s2 <span class="token operator">+</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

    <span class="token keyword">final</span> <span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;javaEE&quot;</span><span class="token punctuation">;</span> <span class="token comment">// s4, 常量</span>
    <span class="token class-name">String</span> s5 <span class="token operator">=</span> s4 <span class="token operator">+</span> <span class="token string">&quot;hadoop&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> s5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="拼接执行效率对比"><a href="#拼接执行效率对比" class="header-anchor">#</a> 拼接执行效率对比</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  method1(100000); // 1786</span>
    <span class="token function">method2</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
    <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;花费的时间为：&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> src <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        src <span class="token operator">=</span> src <span class="token operator">+</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 每次循环都会创建一个StringBuilder、String</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token keyword">int</span> highLevel<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 只需要创建一个StringBuilder</span>
    <span class="token class-name">StringBuilder</span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> highLevel<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        src<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行效率总结：<strong>通过<code>StringBuilder</code>的<code>append()</code>的方式添加字符串的效率要远高于使用<code>String</code>的字符串拼接方式</strong>！那么，在实际开发中，对于需要多次或大量拼接的操作，在不考虑线程安全问题时，我们就应该尽可能使用<code>StringBuilder</code>进行<code>append</code>操作。</p> <p>原因：</p> <ul><li><code>StringBuilder</code>的<code>append()</code>的方式：自始至终中只创建过一个StringBuilder的对象，而使用String的字符串拼接方式：创建过多个<code>StringBuilder</code>和<code>String</code>的对象</li> <li>使用String的字符串拼接方式：内存中由于创建了较多的StringBuilder和String的对象，内存占用更大；如果进行GC，需要花费额外的时间。</li></ul> <p>改进的空间：在实际开发中，如果基本确定前前后后要添加的字符串长度不高于某个限定值highLevel的情况下，使用带参构造器指定<code>capacity</code>，以减少扩容的次数。（<code>StringBuilder</code>空参构造器的初始化大小为16，扩容的逻辑可以自行查看源代码）。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">StringBuilder</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>highLevel<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// new char[highLevel]</span>

<span class="token comment">// String 源码</span>
<span class="token comment">/**
 * Constructs a string builder with no characters in it and an
 * initial capacity of 16 characters.
 */</span>
<span class="token keyword">public</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Constructs a string builder with no characters in it and an
 * initial capacity specified by the {@code capacity} argument.
 *
 * @param      capacity  the initial capacity.
 * @throws     NegativeArraySizeException  if the {@code capacity}
 *               argument is less than {@code 0}.
 */</span>
<span class="token keyword">public</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="intern-的使用"><a href="#intern-的使用" class="header-anchor">#</a> intern()的使用</h2> <p><code>intern()</code> 是一个native方法，调用的是底层C的方法。</p> <p>翻译官方API文档对该方法的描述：<strong>当调用intern方法时，如果池子里已经包含了一个与这个String对象相等的字符串，正如equals(Object)方法所确定的，那么池子里的字符串会被返回。否则，这个String对象被添加到池中，并返回这个String对象的引用</strong>。</p> <p>由此可见，对于任何两个字符串s和t，当且仅当s.equals(t)为真时，s.intern() == t.intern()为真。</p> <p>所有字面字符串和以字符串为值的常量表达式都是interned。</p> <p>intern() 返回一个与此字符串内容相同的字符串，但保证是来自一个唯一的字符串池。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* Returns a canonical representation for the string object.
* A pool of strings, initially empty, is maintained privately by the class String.
* When the intern method is invoked, if the pool already contains a string equal to this String object as determined by the
* equals(Object) method, then the string from the pool is returned. Otherwise, this String object is added to the pool and a 
* reference to this String object is returned.
* It follows that for any two strings s and t, s.intern() == t.intern() is true if and only if s.equals(t) is true.
* All literal strings and string-valued constant expressions are interned. String literals are defined in section 3.10.5 of the 
* The Java™ Language Specification.
* Returns: a string that has the same contents as this string, but is guaranteed to be from a pool of unique strings.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token class-name">String</span> <span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="intern与常量池"><a href="#intern与常量池" class="header-anchor">#</a> intern与常量池</h3> <p>简单来说，如果不是用双引号声明的String对象，可以使用String提供的intern方法，它会从字符串常量池中查询当前字符串是否存在，若不存在就会将当前字符串放入常量池中。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> myInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;I love atguigu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>也就是说，如果在任意字符串上调用String.intern方法，那么其返回结果所指向的那个类实例，必须和直接以常量形式出现的字符串实例完全相同。因此，下列表达式的值必定是true。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token operator">+</span><span class="token string">&quot;b&quot;</span><span class="token operator">+</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;abc&quot;</span>
</code></pre></div><p>通俗点讲，Interned String就是确保字符串在内存里只有一份拷贝，这样可以节约内存空间，加快字符串操作任务的执行速度。而这个值会被存放在字符串内部池（String Intern Pool）。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_3.png" alt="string_table_3"></p> <h3 id="intern的使用-jdk-6-vs-jdk-7-8"><a href="#intern的使用-jdk-6-vs-jdk-7-8" class="header-anchor">#</a> intern的使用：JDK 6 vs JDK 7/8</h3> <p>在看intern在JDK 6、JDK 7/8的详细区别前，我们先看一个经典面试题，了解基本的intern的在内存的操作。</p> <h4 id="经典面试题"><a href="#经典面试题" class="header-anchor">#</a> 经典面试题</h4> <p>题目：<code>new String(&quot;ab&quot;)</code> 会创建几个对象？那么<code>new String(&quot;a&quot;)+ new String(&quot;b&quot;)</code>  又创建几个对象？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringNewTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;ab&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        String str = new String(&quot;a&quot;) + new String(&quot;b&quot;);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>答案：<code>new String(&quot;ab&quot;)</code> 创建两个对象，<code>new String(&quot;a&quot;) + new String(&quot;b&quot;)</code>  创建六个对象。具体原因如下：</p> <p>Q1：<code>new String(&quot;ab&quot;)</code> 会创建两个对象（看字节码）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 *  一个对象是：new关键字在堆空间创建的
 *  另一个对象是：字符串常量池中的对象&quot;ab&quot;。 字节码指令：ldc
 */</span>
 <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">&gt;</span>
 <span class="token number">3</span> dup
 <span class="token number">4</span> ldc #<span class="token number">3</span> <span class="token generics"><span class="token punctuation">&lt;</span>ab<span class="token punctuation">&gt;</span></span>
 <span class="token number">6</span> invokespecial #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
 <span class="token number">9</span> astore_1
<span class="token number">10</span> <span class="token keyword">return</span>
</code></pre></div><p>Q2：<code>new String(&quot;a&quot;) + new String(&quot;b&quot;)</code>  创建六个对象（看字节码）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 *  对象1：new StringBuilder()
 *  对象2：new String(&quot;a&quot;)
 *  对象3：常量池中的&quot;a&quot;
 *  对象4：new String(&quot;b&quot;)
 *  对象5：常量池中的&quot;b&quot;
 *  注意，在最后的时候，会调用StringBuilder的toString()将结果返回给str。
 *  深入剖析： StringBuilder的toString()
 *     对象6 ：new String(&quot;ab&quot;)，
 *     强调，这里发现toString()的调用，并没有在字符串常量池中生成&quot;ab&quot;
 */</span> 
 <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">2</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token operator">&gt;</span>
 <span class="token number">3</span> dup
 <span class="token number">4</span> invokespecial #<span class="token number">3</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
 <span class="token number">7</span> <span class="token keyword">new</span> #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">&gt;</span>
<span class="token number">10</span> dup
<span class="token number">11</span> ldc #<span class="token number">5</span> <span class="token generics"><span class="token punctuation">&lt;</span>a<span class="token punctuation">&gt;</span></span>
<span class="token number">13</span> invokespecial #<span class="token number">6</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">16</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">19</span> <span class="token keyword">new</span> #<span class="token number">4</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">&gt;</span>
<span class="token number">22</span> dup
<span class="token number">23</span> ldc #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>b<span class="token punctuation">&gt;</span></span>
<span class="token number">25</span> invokespecial #<span class="token number">6</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">28</span> invokevirtual #<span class="token number">7</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>append <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">31</span> invokevirtual #<span class="token number">9</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>toString <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
<span class="token number">34</span> astore_1
<span class="token number">35</span> <span class="token keyword">return</span>
</code></pre></div><p>根据分析<code>StringBuilder</code> 的<code>toString()</code> 的源码以及字节码，发现<strong>其并不会在字符串常量池中新的对象</strong>。这也就是为什么在上文说字符串拼接约等于<code>new String(&quot;Xx&quot;)</code> 的原因。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a copy, don't share the array</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 *  深入剖析发现： StringBuilder的toString()，并不会在字符串常量池中新的对象。
 */</span> 
 <span class="token number">0</span> <span class="token keyword">new</span> #<span class="token number">41</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token operator">&gt;</span>
 <span class="token number">3</span> dup
 <span class="token number">4</span> aload_0
 <span class="token number">5</span> getfield #<span class="token number">42</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>value <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">C</span><span class="token operator">&gt;</span>
 <span class="token number">8</span> iconst_0
 <span class="token number">9</span> aload_0
<span class="token number">10</span> getfield #<span class="token number">43</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">StringBuilder</span><span class="token punctuation">.</span>count <span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token number">13</span> invokespecial #<span class="token number">44</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>CII<span class="token punctuation">)</span><span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token number">16</span> areturn
</code></pre></div><h4 id="intern在不同版本jdk的细微差别"><a href="#intern在不同版本jdk的细微差别" class="header-anchor">#</a> intern在不同版本JDK的细微差别</h4> <p>在看完经典面试题后，我们再看看引入了intern局面又会发生什么变化？</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * ① String s = new String(&quot;1&quot;)
 * 创建了两个对象
 * 		堆空间中一个new对象
 * 		字符串常量池中一个字符串常量&quot;1&quot;（注意：此时字符串常量池中已有&quot;1&quot;）
 * ② s.intern() 由于字符串常量池中已存在&quot;1&quot;, 所以返回的是常量池的&quot;1&quot;地址
 * 由此得知
 *   s  指向的是堆空间中的对象地址
 *   s2 指向的是堆空间中常量池中&quot;1&quot;的地址
 * 所以不相等。
 *
 * 【这里由于在执行intern()前，在常量池中已经存在了“1”，所以无论在jdk6还是7/8都是false】
 */</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 执行完上一行代码以后，字符串常量池中存在&quot;1&quot;！！</span>
s<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">==</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// jdk6：false  jdk7/8：false</span>

<span class="token comment">/**
 * ① String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;)
 * 如上面经典面试题所说，创建了6个对象，s3约等价于new String（&quot;11&quot;），
 *     但是，常量池中并不生成字符串&quot;11&quot;；
 * ② s3.intern()
 * 由于此时常量池中并无&quot;11&quot;，
 *    jdk6: 创建了一个新的对象&quot;11&quot;到池中, 也就有新的地址。
 *    jdk7: 此时常量池中并没有创建&quot;11&quot;, 而是创建一个指向堆空间中new String(&quot;11&quot;)的地址。
 * 这个时候，不同版本jdk下s3指向的地址是不同的，
 * 而 s4 记录的地址，使用的是上一行代码代码执行时，在常量池中生成的&quot;11&quot;的地址
 *
 * 【这里由于在执行intern()前，在常量池中不存在“11”，在不同版本下常量池的“11”的地址内容有所不同， 所以结果不同】
 */</span>
<span class="token class-name">String</span> s3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行完上一行代码以后，字符串常量池中不存在&quot;11&quot;！！</span>
s3<span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
<span class="token class-name">String</span> s4 <span class="token operator">=</span> <span class="token string">&quot;11&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s3 <span class="token operator">==</span> s4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// jdk6：false  jdk7/8：true</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_4.png" alt="string_table_4"></p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_5.png" alt="string_table_5"></p> <p><strong>总结<code>String</code>的<code>intern()</code>的使用</strong>：</p> <p>JDK1.6 中，将这个字符串对象尝试放入串池。</p> <ul><li>如果串池中有，则并不会放入，返回已有的串池中的对象的地址。</li> <li>如果没有，<strong>会把此对象复制一份，放入串池</strong>，并返回串池中的对象地址</li></ul> <p>JDK1.7起，将这个字符串对象尝试放入串池。</p> <ul><li>如果串池中有，则并不会放入，返回已有的串池中的对象的地址</li> <li>如果没有，<strong>则会把对象的引用地址复制一份</strong>，放入串池，并返回串池中的引用地址</li></ul> <h4 id="练习题"><a href="#练习题" class="header-anchor">#</a> 练习题</h4> <p>练习1</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_6.png" alt="string_table_6"></p> <p>练习2</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_6.png" alt="string_table_6"></p> <h3 id="intern的效率测试-空间角度"><a href="#intern的效率测试-空间角度" class="header-anchor">#</a> intern的效率测试：空间角度</h3> <p>我们通过测试一下，使用了intern和不使用的时候，其实相差还挺多的。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringIntern2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX_COUNT <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>MAX_COUNT<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//            arr[i] = new String(String.valueOf(data[i % data.length])); // 8713ms</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i <span class="token operator">%</span> data<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1192ms</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;花费的时间为：&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>内存消耗区别，使用intern前</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_9.png" alt="string_table_9"></p> <p>使用intern后</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/string_table_10.png" alt="string_table_10"></p> <p><strong>结论：对于程序中大量使用存在的字符串时，尤其存在很多已经重复的字符串时，使用intern()方法能够节省内存空间</strong>。</p> <p>大的网站平台，需要内存中存储大量的字符串。比如社交网站，很多人都存储：北京市、海淀区等信息。这时候如果字符串都调用<code>intern()</code>方法，就会很明显降低内存的大小。</p> <h2 id="stringtable的垃圾回收"><a href="#stringtable的垃圾回收" class="header-anchor">#</a> StringTable的垃圾回收</h2> <p><code>-XX:+PrintStringTableStatistic</code>：打印StringTable的状态。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * String的垃圾回收:
 * -Xms15m -Xmx15m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringGCTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行结果：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">[</span>GC <span class="token punctuation">(</span><span class="token class-name">Allocation</span> <span class="token class-name">Failure</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">4096</span>K<span class="token operator">-&gt;</span><span class="token function">480K</span><span class="token punctuation">(</span><span class="token number">4608</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">4096</span>K<span class="token operator">-&gt;</span><span class="token function">528K</span><span class="token punctuation">(</span><span class="token number">15872</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0007952</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.00</span> secs<span class="token punctuation">]</span> 
<span class="token class-name">Heap</span>
 <span class="token class-name">PSYoungGen</span>      total <span class="token number">4608</span>K<span class="token punctuation">,</span> used <span class="token number">3526</span>K <span class="token punctuation">[</span><span class="token number">0x00000007bfb00000</span><span class="token punctuation">,</span> <span class="token number">0x00000007c0000000</span><span class="token punctuation">,</span> <span class="token number">0x00000007c0000000</span><span class="token punctuation">)</span>
  eden space <span class="token number">4096</span>K<span class="token punctuation">,</span> <span class="token number">74</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000007bfb00000</span><span class="token punctuation">,</span><span class="token number">0x00000007bfdf9a58</span><span class="token punctuation">,</span><span class="token number">0x00000007bff00000</span><span class="token punctuation">)</span>
  from space <span class="token number">512</span>K<span class="token punctuation">,</span> <span class="token number">93</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000007bff00000</span><span class="token punctuation">,</span><span class="token number">0x00000007bff78020</span><span class="token punctuation">,</span><span class="token number">0x00000007bff80000</span><span class="token punctuation">)</span>
  <span class="token keyword">to</span>   <span class="token namespace">space</span> <span class="token number">512</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000007bff80000</span><span class="token punctuation">,</span><span class="token number">0x00000007bff80000</span><span class="token punctuation">,</span><span class="token number">0x00000007c0000000</span><span class="token punctuation">)</span>
 <span class="token class-name">ParOldGen</span>       total <span class="token number">11264</span>K<span class="token punctuation">,</span> used <span class="token number">48</span>K <span class="token punctuation">[</span><span class="token number">0x00000007bf000000</span><span class="token punctuation">,</span> <span class="token number">0x00000007bfb00000</span><span class="token punctuation">,</span> <span class="token number">0x00000007bfb00000</span><span class="token punctuation">)</span>
  object space <span class="token number">11264</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">%</span> used <span class="token punctuation">[</span><span class="token number">0x00000007bf000000</span><span class="token punctuation">,</span><span class="token number">0x00000007bf00c000</span><span class="token punctuation">,</span><span class="token number">0x00000007bfb00000</span><span class="token punctuation">)</span>
 <span class="token class-name">Metaspace</span>       used <span class="token number">3305</span>K<span class="token punctuation">,</span> capacity <span class="token number">4496</span>K<span class="token punctuation">,</span> committed <span class="token number">4864</span>K<span class="token punctuation">,</span> reserved <span class="token number">1056768</span>K
  <span class="token keyword">class</span> space    used <span class="token number">359</span>K<span class="token punctuation">,</span> capacity <span class="token number">388</span>K<span class="token punctuation">,</span> committed <span class="token number">512</span>K<span class="token punctuation">,</span> reserved <span class="token number">1048576</span>K
<span class="token class-name">SymbolTable</span> statistics<span class="token operator">:</span>
<span class="token class-name">Number</span> of buckets       <span class="token operator">:</span>     <span class="token number">20011</span> <span class="token operator">=</span>    <span class="token number">160088</span> bytes<span class="token punctuation">,</span> avg   <span class="token number">8.000</span>
<span class="token class-name">Number</span> of entries       <span class="token operator">:</span>     <span class="token number">13119</span> <span class="token operator">=</span>    <span class="token number">314856</span> bytes<span class="token punctuation">,</span> avg  <span class="token number">24.000</span>
<span class="token class-name">Number</span> of literals      <span class="token operator">:</span>     <span class="token number">13119</span> <span class="token operator">=</span>    <span class="token number">503320</span> bytes<span class="token punctuation">,</span> avg  <span class="token number">38.366</span>
<span class="token class-name">Total</span> footprint         <span class="token operator">:</span>           <span class="token operator">=</span>    <span class="token number">978264</span> bytes
<span class="token class-name">Average</span> bucket size     <span class="token operator">:</span>     <span class="token number">0.656</span>
<span class="token class-name">Variance</span> of bucket size <span class="token operator">:</span>     <span class="token number">0.658</span>
<span class="token class-name">Std</span><span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of bucket size<span class="token operator">:</span>     <span class="token number">0.811</span>
<span class="token class-name">Maximum</span> bucket size     <span class="token operator">:</span>         <span class="token number">6</span>
<span class="token class-name">StringTable</span> statistics<span class="token operator">:</span>
<span class="token class-name">Number</span> of buckets       <span class="token operator">:</span>     <span class="token number">60013</span> <span class="token operator">=</span>    <span class="token number">480104</span> bytes<span class="token punctuation">,</span> avg   <span class="token number">8.000</span>
<span class="token class-name">Number</span> of entries       <span class="token operator">:</span>     <span class="token number">55564</span> <span class="token operator">=</span>   <span class="token number">1333536</span> bytes<span class="token punctuation">,</span> avg  <span class="token number">24.000</span>
<span class="token class-name">Number</span> of literals      <span class="token operator">:</span>     <span class="token number">55564</span> <span class="token operator">=</span>   <span class="token number">3121016</span> bytes<span class="token punctuation">,</span> avg  <span class="token number">56.170</span>
<span class="token class-name">Total</span> footprint         <span class="token operator">:</span>           <span class="token operator">=</span>   <span class="token number">4934656</span> bytes
<span class="token class-name">Average</span> bucket size     <span class="token operator">:</span>     <span class="token number">0.926</span>
<span class="token class-name">Variance</span> of bucket size <span class="token operator">:</span>     <span class="token number">0.731</span>
<span class="token class-name">Std</span><span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of bucket size<span class="token operator">:</span>     <span class="token number">0.855</span>
<span class="token class-name">Maximum</span> bucket size     <span class="token operator">:</span>         <span class="token number">5</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre></div><h2 id="g1中的string去重操作"><a href="#g1中的string去重操作" class="header-anchor">#</a> G1中的String去重操作</h2> <p>官网地址：<a href="http://openjdk.java.net/jeps/192" target="_blank" rel="noopener noreferrer">JEP 192: String Deduplication in G1 (java.net)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>背景：对许多Java应用（有大的也有小的）做的测试得出以下结果：</p> <ul><li>堆存活数据集合里面string对象占了25%</li> <li>堆存活数据集合里面重复的string对象有13.5%</li> <li>string对象的平均长度是45</li></ul> <p>目前，许多大规模的Java应用程序在内存上遇到了瓶颈。测量表明，在这些类型的应用程序中，大约25%的Java堆实时数据集被<code>String</code>对象所消耗。此外，这些<code>String</code> 对象中大约有一半是重复的，其中重复意味着 <code>string1.equals(string2)</code>是真的。在堆上有重复的<code>String</code>对象，从本质上讲，只是一种内存的浪费。这个项目将在G1垃圾收集器中实现自动和持续的<code>String</code>重复数据删除，以避免浪费内存，减少内存占用。</p> <blockquote><p><strong>Motivation</strong></p> <p>Many large-scale Java applications are currently bottlenecked on memory. Measurements have shown that roughly 25% of the Java heap live data set in these types of applications is consumed by <code>String</code> objects. Further, roughly half of those <code>String</code> objects are duplicates, where duplicates means <code>string1.equals(string2)</code> is true. Having duplicate <code>String</code> objects on the heap is, essentially, just a waste of memory. This project will implement automatic and continuous <code>String</code> deduplication in the G1 garbage collector to avoid wasting memory and reduce the memory footprint.</p></blockquote> <p>注意这里说的重复，<strong>指的是在堆中的数据</strong>，而不是常量池中的，因为常量池中的本身就不会重复。</p> <h3 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h3> <ol><li>当垃圾收集器工作的时候，会访问堆上存活的对象。<strong>对每一个访问的对象都会检查是否是候选的要去重的String对象</strong>。</li> <li>如果是，把这个对象的一个引用插入到队列中等待后续的处理。一个去重的线程在后台运行，处理这个队列。处理队列的一个元素意味着从队列删除这个元素，然后尝试去重它引用的string对象。</li> <li>使用一个hashtable来记录所有的被String对象使用的不重复的char数组。当去重的时候，会查这个hashtable，来看堆上是否已经存在一个一模一样的char数组。</li> <li>如果存在，String对象会被调整引用那个数组，释放对原来的数组的引用，最终会被垃圾收集器回收掉。</li> <li>如果查找失败，char数组会被插入到hashtable，这样以后的时候就可以共享这个数组了。</li></ol> <h3 id="命令行选项"><a href="#命令行选项" class="header-anchor">#</a> <strong>命令行选项</strong></h3> <ul><li><code>UseStringDeduplication(bool)</code> ：开启String去重，<strong>默认是不开启的，需要手动开启</strong>。</li> <li><code>PrintStringDeduplicationStatistics(bool)</code> ：打印详细的去重统计信息。</li> <li><code>StringpeDuplicationAgeThreshold(uintx)</code> ：去重阈值，达到这个年龄的String对象则被认为是去重的候选对象。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/3/2022, 1:01:07 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/java-vm/1_13_gc_introd.html">
        垃圾回收概述
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bc037eca.js" defer></script><script src="/assets/js/3.a3373ef9.js" defer></script><script src="/assets/js/162.261c214f.js" defer></script>
  </body>
</html>
