<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>字节码指令集 | 万隆的笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.png">
    <script>var _hmt = _hmt || [];
            (function() {
              var hm = document.createElement("script");
              hm.src = "https://hm.baidu.com/hm.js?d8c4de0636e24ecd74e706a345ab8cc9";
              var s = document.getElementsByTagName("script")[0]; 
              s.parentNode.insertBefore(hm, s);
            })();</script>
    <meta name="description" content="小小码农">
    
    <link rel="preload" href="/assets/css/0.styles.e68661c4.css" as="style"><link rel="preload" href="/assets/js/app.bc037eca.js" as="script"><link rel="preload" href="/assets/js/3.a3373ef9.js" as="script"><link rel="preload" href="/assets/js/182.179b516a.js" as="script"><link rel="prefetch" href="/assets/js/10.4df5c055.js"><link rel="prefetch" href="/assets/js/100.0d629d95.js"><link rel="prefetch" href="/assets/js/101.2db02bf9.js"><link rel="prefetch" href="/assets/js/102.d68c24bb.js"><link rel="prefetch" href="/assets/js/103.600018bb.js"><link rel="prefetch" href="/assets/js/104.c413414c.js"><link rel="prefetch" href="/assets/js/105.8c15211b.js"><link rel="prefetch" href="/assets/js/106.84e8ee9b.js"><link rel="prefetch" href="/assets/js/107.a9e7f4b2.js"><link rel="prefetch" href="/assets/js/108.f3285402.js"><link rel="prefetch" href="/assets/js/109.8cf78ec2.js"><link rel="prefetch" href="/assets/js/11.5acc5c3a.js"><link rel="prefetch" href="/assets/js/110.1822bed3.js"><link rel="prefetch" href="/assets/js/111.a9157b2f.js"><link rel="prefetch" href="/assets/js/112.f9617caf.js"><link rel="prefetch" href="/assets/js/113.2cf20d85.js"><link rel="prefetch" href="/assets/js/114.690001dc.js"><link rel="prefetch" href="/assets/js/115.01270cf8.js"><link rel="prefetch" href="/assets/js/116.f58bd27d.js"><link rel="prefetch" href="/assets/js/117.a7d22187.js"><link rel="prefetch" href="/assets/js/118.9b13fb7e.js"><link rel="prefetch" href="/assets/js/119.e56d4413.js"><link rel="prefetch" href="/assets/js/12.944e78c3.js"><link rel="prefetch" href="/assets/js/120.6a373e09.js"><link rel="prefetch" href="/assets/js/121.f05c8ac8.js"><link rel="prefetch" href="/assets/js/122.b23768d7.js"><link rel="prefetch" href="/assets/js/123.274a1455.js"><link rel="prefetch" href="/assets/js/124.1672408d.js"><link rel="prefetch" href="/assets/js/125.7fb88ab5.js"><link rel="prefetch" href="/assets/js/126.5db859c8.js"><link rel="prefetch" href="/assets/js/127.a34ecf8a.js"><link rel="prefetch" href="/assets/js/128.54e15d3c.js"><link rel="prefetch" href="/assets/js/129.6e2cae17.js"><link rel="prefetch" href="/assets/js/13.1d4ba2e8.js"><link rel="prefetch" href="/assets/js/130.6ad457a8.js"><link rel="prefetch" href="/assets/js/131.aeedef23.js"><link rel="prefetch" href="/assets/js/132.443d76bf.js"><link rel="prefetch" href="/assets/js/133.641d77af.js"><link rel="prefetch" href="/assets/js/134.1824a48c.js"><link rel="prefetch" href="/assets/js/135.bf659059.js"><link rel="prefetch" href="/assets/js/136.185d1de5.js"><link rel="prefetch" href="/assets/js/137.5bcb50d7.js"><link rel="prefetch" href="/assets/js/138.5b56d765.js"><link rel="prefetch" href="/assets/js/139.4f07d83f.js"><link rel="prefetch" href="/assets/js/14.78c03a65.js"><link rel="prefetch" href="/assets/js/140.b14458e8.js"><link rel="prefetch" href="/assets/js/141.16eba01d.js"><link rel="prefetch" href="/assets/js/142.67697a4e.js"><link rel="prefetch" href="/assets/js/143.b1ee0e16.js"><link rel="prefetch" href="/assets/js/144.9800e31a.js"><link rel="prefetch" href="/assets/js/145.cdd7e47e.js"><link rel="prefetch" href="/assets/js/146.4d8b9cf6.js"><link rel="prefetch" href="/assets/js/147.1ce23cab.js"><link rel="prefetch" href="/assets/js/148.854fb1e4.js"><link rel="prefetch" href="/assets/js/149.da169cf3.js"><link rel="prefetch" href="/assets/js/15.a60df2b4.js"><link rel="prefetch" href="/assets/js/150.b3d06f97.js"><link rel="prefetch" href="/assets/js/151.16f22697.js"><link rel="prefetch" href="/assets/js/152.e39ae535.js"><link rel="prefetch" href="/assets/js/153.81ecd116.js"><link rel="prefetch" href="/assets/js/154.cbc5938f.js"><link rel="prefetch" href="/assets/js/155.00385d0c.js"><link rel="prefetch" href="/assets/js/156.4517568a.js"><link rel="prefetch" href="/assets/js/157.f1433c46.js"><link rel="prefetch" href="/assets/js/158.5352cd07.js"><link rel="prefetch" href="/assets/js/159.c4f81687.js"><link rel="prefetch" href="/assets/js/16.da7f7410.js"><link rel="prefetch" href="/assets/js/160.3778e817.js"><link rel="prefetch" href="/assets/js/161.4ecebe00.js"><link rel="prefetch" href="/assets/js/162.261c214f.js"><link rel="prefetch" href="/assets/js/163.e7abb47f.js"><link rel="prefetch" href="/assets/js/164.570dd314.js"><link rel="prefetch" href="/assets/js/165.f904d36e.js"><link rel="prefetch" href="/assets/js/166.be1e5538.js"><link rel="prefetch" href="/assets/js/167.eca75917.js"><link rel="prefetch" href="/assets/js/168.5ede7a24.js"><link rel="prefetch" href="/assets/js/169.8f030b14.js"><link rel="prefetch" href="/assets/js/17.ba9ee66f.js"><link rel="prefetch" href="/assets/js/170.5b3d76ad.js"><link rel="prefetch" href="/assets/js/171.d6534d74.js"><link rel="prefetch" href="/assets/js/172.8cfd94b9.js"><link rel="prefetch" href="/assets/js/173.fb4f0904.js"><link rel="prefetch" href="/assets/js/174.7dba6bb9.js"><link rel="prefetch" href="/assets/js/175.c6c8980d.js"><link rel="prefetch" href="/assets/js/176.5c8bee1e.js"><link rel="prefetch" href="/assets/js/177.7d9b6b50.js"><link rel="prefetch" href="/assets/js/178.9b0f6d6b.js"><link rel="prefetch" href="/assets/js/179.851f4874.js"><link rel="prefetch" href="/assets/js/18.68e82e56.js"><link rel="prefetch" href="/assets/js/180.d4946561.js"><link rel="prefetch" href="/assets/js/181.dddb9217.js"><link rel="prefetch" href="/assets/js/183.f6c78374.js"><link rel="prefetch" href="/assets/js/184.1dde444f.js"><link rel="prefetch" href="/assets/js/185.3db3afc3.js"><link rel="prefetch" href="/assets/js/186.2c0f07eb.js"><link rel="prefetch" href="/assets/js/187.5f6f57ff.js"><link rel="prefetch" href="/assets/js/188.97586f9f.js"><link rel="prefetch" href="/assets/js/189.8a39dde2.js"><link rel="prefetch" href="/assets/js/19.9aa6dcce.js"><link rel="prefetch" href="/assets/js/190.96731259.js"><link rel="prefetch" href="/assets/js/191.d096d222.js"><link rel="prefetch" href="/assets/js/192.a921d348.js"><link rel="prefetch" href="/assets/js/193.a3e07c61.js"><link rel="prefetch" href="/assets/js/194.8934403d.js"><link rel="prefetch" href="/assets/js/195.13b302ff.js"><link rel="prefetch" href="/assets/js/196.4ad81cf9.js"><link rel="prefetch" href="/assets/js/197.8a23e1be.js"><link rel="prefetch" href="/assets/js/198.a1bf2bc3.js"><link rel="prefetch" href="/assets/js/199.c6abf07d.js"><link rel="prefetch" href="/assets/js/2.98bbb7f5.js"><link rel="prefetch" href="/assets/js/20.513c8e9b.js"><link rel="prefetch" href="/assets/js/200.f5a2f491.js"><link rel="prefetch" href="/assets/js/201.03671056.js"><link rel="prefetch" href="/assets/js/202.f94ec544.js"><link rel="prefetch" href="/assets/js/203.2a09fec0.js"><link rel="prefetch" href="/assets/js/204.e56dddcb.js"><link rel="prefetch" href="/assets/js/205.f48c8602.js"><link rel="prefetch" href="/assets/js/206.a8d9bcc4.js"><link rel="prefetch" href="/assets/js/207.e4016538.js"><link rel="prefetch" href="/assets/js/208.be8af315.js"><link rel="prefetch" href="/assets/js/209.4cfde3a6.js"><link rel="prefetch" href="/assets/js/21.1e72e195.js"><link rel="prefetch" href="/assets/js/210.f4936cb6.js"><link rel="prefetch" href="/assets/js/211.063bdacd.js"><link rel="prefetch" href="/assets/js/212.353d50f2.js"><link rel="prefetch" href="/assets/js/213.094a5cfc.js"><link rel="prefetch" href="/assets/js/214.d16aa2d2.js"><link rel="prefetch" href="/assets/js/215.bc88e375.js"><link rel="prefetch" href="/assets/js/216.45511649.js"><link rel="prefetch" href="/assets/js/217.99946f6f.js"><link rel="prefetch" href="/assets/js/218.43a39089.js"><link rel="prefetch" href="/assets/js/219.d14424be.js"><link rel="prefetch" href="/assets/js/22.324c39b4.js"><link rel="prefetch" href="/assets/js/220.882e9a86.js"><link rel="prefetch" href="/assets/js/221.40e3d13e.js"><link rel="prefetch" href="/assets/js/222.23004b98.js"><link rel="prefetch" href="/assets/js/223.5130614a.js"><link rel="prefetch" href="/assets/js/224.2a560c15.js"><link rel="prefetch" href="/assets/js/225.92cc9d19.js"><link rel="prefetch" href="/assets/js/226.38630a69.js"><link rel="prefetch" href="/assets/js/227.ddd1a6d3.js"><link rel="prefetch" href="/assets/js/228.2d4cf247.js"><link rel="prefetch" href="/assets/js/229.458c49c4.js"><link rel="prefetch" href="/assets/js/23.beabd1c9.js"><link rel="prefetch" href="/assets/js/230.1530afe6.js"><link rel="prefetch" href="/assets/js/231.26875105.js"><link rel="prefetch" href="/assets/js/232.3c906b6a.js"><link rel="prefetch" href="/assets/js/233.d633d2c5.js"><link rel="prefetch" href="/assets/js/234.841291f0.js"><link rel="prefetch" href="/assets/js/235.de892702.js"><link rel="prefetch" href="/assets/js/236.a0ff8c56.js"><link rel="prefetch" href="/assets/js/237.bbc7b6ef.js"><link rel="prefetch" href="/assets/js/238.b53d8e52.js"><link rel="prefetch" href="/assets/js/239.ae488c24.js"><link rel="prefetch" href="/assets/js/24.a2f1a1cf.js"><link rel="prefetch" href="/assets/js/240.06d1aa99.js"><link rel="prefetch" href="/assets/js/241.e782f534.js"><link rel="prefetch" href="/assets/js/242.cae48a9d.js"><link rel="prefetch" href="/assets/js/243.4eea58f3.js"><link rel="prefetch" href="/assets/js/244.b3cfbb67.js"><link rel="prefetch" href="/assets/js/245.734f2b40.js"><link rel="prefetch" href="/assets/js/246.83ba6a01.js"><link rel="prefetch" href="/assets/js/247.bee3fa17.js"><link rel="prefetch" href="/assets/js/248.633a3a01.js"><link rel="prefetch" href="/assets/js/249.cbcc1465.js"><link rel="prefetch" href="/assets/js/25.1598a580.js"><link rel="prefetch" href="/assets/js/250.7b21393b.js"><link rel="prefetch" href="/assets/js/251.2fb1b244.js"><link rel="prefetch" href="/assets/js/252.c0e95582.js"><link rel="prefetch" href="/assets/js/253.42d96179.js"><link rel="prefetch" href="/assets/js/254.2f556423.js"><link rel="prefetch" href="/assets/js/255.5c518629.js"><link rel="prefetch" href="/assets/js/256.6c37f138.js"><link rel="prefetch" href="/assets/js/257.bfaf2b90.js"><link rel="prefetch" href="/assets/js/258.501c8dec.js"><link rel="prefetch" href="/assets/js/259.433c5a35.js"><link rel="prefetch" href="/assets/js/26.14532494.js"><link rel="prefetch" href="/assets/js/260.7133674c.js"><link rel="prefetch" href="/assets/js/261.7c497a98.js"><link rel="prefetch" href="/assets/js/262.ef906292.js"><link rel="prefetch" href="/assets/js/263.7b1b901f.js"><link rel="prefetch" href="/assets/js/264.36ebfc79.js"><link rel="prefetch" href="/assets/js/265.33897322.js"><link rel="prefetch" href="/assets/js/266.8670f739.js"><link rel="prefetch" href="/assets/js/267.ec8f4c6a.js"><link rel="prefetch" href="/assets/js/268.487e3ecf.js"><link rel="prefetch" href="/assets/js/269.dd269c27.js"><link rel="prefetch" href="/assets/js/27.182ae611.js"><link rel="prefetch" href="/assets/js/270.bfc37c9e.js"><link rel="prefetch" href="/assets/js/271.b1193de2.js"><link rel="prefetch" href="/assets/js/272.4d22dbda.js"><link rel="prefetch" href="/assets/js/273.f76b57ca.js"><link rel="prefetch" href="/assets/js/274.8aa70460.js"><link rel="prefetch" href="/assets/js/275.f8a4d784.js"><link rel="prefetch" href="/assets/js/276.73193b56.js"><link rel="prefetch" href="/assets/js/277.eb11f3ab.js"><link rel="prefetch" href="/assets/js/278.bbbd0f67.js"><link rel="prefetch" href="/assets/js/279.0d5be41f.js"><link rel="prefetch" href="/assets/js/28.cc74fb69.js"><link rel="prefetch" href="/assets/js/280.e937fced.js"><link rel="prefetch" href="/assets/js/281.3e4a2290.js"><link rel="prefetch" href="/assets/js/282.927224e7.js"><link rel="prefetch" href="/assets/js/283.11981dd7.js"><link rel="prefetch" href="/assets/js/284.f51d8c6d.js"><link rel="prefetch" href="/assets/js/285.36e1d9fd.js"><link rel="prefetch" href="/assets/js/286.6ae62cc1.js"><link rel="prefetch" href="/assets/js/287.83708e55.js"><link rel="prefetch" href="/assets/js/288.bae95807.js"><link rel="prefetch" href="/assets/js/289.96cf6017.js"><link rel="prefetch" href="/assets/js/29.e3df47e0.js"><link rel="prefetch" href="/assets/js/290.c8bbd938.js"><link rel="prefetch" href="/assets/js/291.ee2a4137.js"><link rel="prefetch" href="/assets/js/292.37a36b48.js"><link rel="prefetch" href="/assets/js/293.6589f01f.js"><link rel="prefetch" href="/assets/js/294.9e2c7ac2.js"><link rel="prefetch" href="/assets/js/295.54f91c63.js"><link rel="prefetch" href="/assets/js/296.437948b8.js"><link rel="prefetch" href="/assets/js/297.77b67b30.js"><link rel="prefetch" href="/assets/js/298.847026f8.js"><link rel="prefetch" href="/assets/js/299.f7987fa5.js"><link rel="prefetch" href="/assets/js/30.d956a42b.js"><link rel="prefetch" href="/assets/js/300.fb926d10.js"><link rel="prefetch" href="/assets/js/301.39be1acb.js"><link rel="prefetch" href="/assets/js/302.0d4b2462.js"><link rel="prefetch" href="/assets/js/303.797685f0.js"><link rel="prefetch" href="/assets/js/304.953dd6d8.js"><link rel="prefetch" href="/assets/js/305.45a68780.js"><link rel="prefetch" href="/assets/js/306.9436c9f7.js"><link rel="prefetch" href="/assets/js/307.c8da713f.js"><link rel="prefetch" href="/assets/js/308.42164c3a.js"><link rel="prefetch" href="/assets/js/309.08138204.js"><link rel="prefetch" href="/assets/js/31.b08efb45.js"><link rel="prefetch" href="/assets/js/310.3bdab8a3.js"><link rel="prefetch" href="/assets/js/311.6cb6bc2c.js"><link rel="prefetch" href="/assets/js/312.b2211997.js"><link rel="prefetch" href="/assets/js/313.27e5d88b.js"><link rel="prefetch" href="/assets/js/314.4345463c.js"><link rel="prefetch" href="/assets/js/315.cfd666b9.js"><link rel="prefetch" href="/assets/js/316.744f1ea3.js"><link rel="prefetch" href="/assets/js/317.0a990397.js"><link rel="prefetch" href="/assets/js/318.49bfe4f7.js"><link rel="prefetch" href="/assets/js/319.0e9f0404.js"><link rel="prefetch" href="/assets/js/32.42eb6c80.js"><link rel="prefetch" href="/assets/js/320.95c40fa6.js"><link rel="prefetch" href="/assets/js/321.d3557402.js"><link rel="prefetch" href="/assets/js/322.381f65d0.js"><link rel="prefetch" href="/assets/js/323.883198dc.js"><link rel="prefetch" href="/assets/js/324.cad6119f.js"><link rel="prefetch" href="/assets/js/325.90509c04.js"><link rel="prefetch" href="/assets/js/33.cba29bcc.js"><link rel="prefetch" href="/assets/js/34.60629bfe.js"><link rel="prefetch" href="/assets/js/35.a60b566c.js"><link rel="prefetch" href="/assets/js/36.099489dc.js"><link rel="prefetch" href="/assets/js/37.a40ed816.js"><link rel="prefetch" href="/assets/js/38.7e946531.js"><link rel="prefetch" href="/assets/js/39.1e9449ed.js"><link rel="prefetch" href="/assets/js/4.0893bcb9.js"><link rel="prefetch" href="/assets/js/40.a68e55dd.js"><link rel="prefetch" href="/assets/js/41.c2410ec6.js"><link rel="prefetch" href="/assets/js/42.6059e0a0.js"><link rel="prefetch" href="/assets/js/43.666eab60.js"><link rel="prefetch" href="/assets/js/44.6d2bc28e.js"><link rel="prefetch" href="/assets/js/45.23095742.js"><link rel="prefetch" href="/assets/js/46.2c644d05.js"><link rel="prefetch" href="/assets/js/47.0c53d023.js"><link rel="prefetch" href="/assets/js/48.6763315e.js"><link rel="prefetch" href="/assets/js/49.5df08a8b.js"><link rel="prefetch" href="/assets/js/5.0c8b00ed.js"><link rel="prefetch" href="/assets/js/50.21bed711.js"><link rel="prefetch" href="/assets/js/51.cc283ef4.js"><link rel="prefetch" href="/assets/js/52.448e1e19.js"><link rel="prefetch" href="/assets/js/53.8d139bfe.js"><link rel="prefetch" href="/assets/js/54.ab823596.js"><link rel="prefetch" href="/assets/js/55.28d6b882.js"><link rel="prefetch" href="/assets/js/56.799dfc32.js"><link rel="prefetch" href="/assets/js/57.47844017.js"><link rel="prefetch" href="/assets/js/58.a3636228.js"><link rel="prefetch" href="/assets/js/59.b88e34c1.js"><link rel="prefetch" href="/assets/js/6.a436075e.js"><link rel="prefetch" href="/assets/js/60.08d9b769.js"><link rel="prefetch" href="/assets/js/61.62eaaae6.js"><link rel="prefetch" href="/assets/js/62.2e8a878d.js"><link rel="prefetch" href="/assets/js/63.498c3cfe.js"><link rel="prefetch" href="/assets/js/64.32bf8090.js"><link rel="prefetch" href="/assets/js/65.0f690d46.js"><link rel="prefetch" href="/assets/js/66.90352622.js"><link rel="prefetch" href="/assets/js/67.480bdaa6.js"><link rel="prefetch" href="/assets/js/68.9979d713.js"><link rel="prefetch" href="/assets/js/69.780f4d95.js"><link rel="prefetch" href="/assets/js/7.4d9f4e60.js"><link rel="prefetch" href="/assets/js/70.c2ca172c.js"><link rel="prefetch" href="/assets/js/71.ae3f1c72.js"><link rel="prefetch" href="/assets/js/72.93cde0ad.js"><link rel="prefetch" href="/assets/js/73.8ee7e6cc.js"><link rel="prefetch" href="/assets/js/74.cde76b4d.js"><link rel="prefetch" href="/assets/js/75.1f2c3f1d.js"><link rel="prefetch" href="/assets/js/76.960c7d73.js"><link rel="prefetch" href="/assets/js/77.9d4b9659.js"><link rel="prefetch" href="/assets/js/78.310cf545.js"><link rel="prefetch" href="/assets/js/79.bd667333.js"><link rel="prefetch" href="/assets/js/8.7541ba14.js"><link rel="prefetch" href="/assets/js/80.f42edee8.js"><link rel="prefetch" href="/assets/js/81.dda99508.js"><link rel="prefetch" href="/assets/js/82.ec338e99.js"><link rel="prefetch" href="/assets/js/83.66b1f5b4.js"><link rel="prefetch" href="/assets/js/84.2173e568.js"><link rel="prefetch" href="/assets/js/85.3b5e4e47.js"><link rel="prefetch" href="/assets/js/86.3c179528.js"><link rel="prefetch" href="/assets/js/87.28691828.js"><link rel="prefetch" href="/assets/js/88.5830058a.js"><link rel="prefetch" href="/assets/js/89.2e630253.js"><link rel="prefetch" href="/assets/js/9.038ee2be.js"><link rel="prefetch" href="/assets/js/90.05aa65c3.js"><link rel="prefetch" href="/assets/js/91.99ac4500.js"><link rel="prefetch" href="/assets/js/92.f1bd8f70.js"><link rel="prefetch" href="/assets/js/93.f35f7adf.js"><link rel="prefetch" href="/assets/js/94.f6780083.js"><link rel="prefetch" href="/assets/js/95.be362a29.js"><link rel="prefetch" href="/assets/js/96.f8368d2d.js"><link rel="prefetch" href="/assets/js/97.745204bf.js"><link rel="prefetch" href="/assets/js/98.58c8fcaa.js"><link rel="prefetch" href="/assets/js/99.d4d25887.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e68661c4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.png" alt="万隆的笔记" class="logo"> <span class="site-name can-hide">万隆的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes-guide/" class="nav-link">
  博文索引
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线资源" class="dropdown-title"><span class="title">在线资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线资源" class="mobile-dropdown-title"><span class="title">在线资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线学站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.runoob.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  菜鸟教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.w3cschool.cn/tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  入门教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.coursera.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coursera
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.w3school.com.cn/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3school
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.bootcss.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tool 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bejson 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://smallpdf.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/online/" class="nav-link">
  更多在线资源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/change-logs/" class="nav-link">
  Changlog
</a></li><li class="dropdown-item"><!----> <a href="/more/about-me.html" class="nav-link">
  Aboutme
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wwllong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes-guide/" class="nav-link">
  博文索引
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线资源" class="dropdown-title"><span class="title">在线资源</span> <span class="arrow down"></span></button> <button type="button" aria-label="在线资源" class="mobile-dropdown-title"><span class="title">在线资源</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线学站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.runoob.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  菜鸟教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.w3cschool.cn/tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  入门教程
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.coursera.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Coursera
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线文档
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.w3school.com.cn/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  w3school
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.bootcss.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bootstrap
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  tool 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bejson.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bejson 工具集
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://smallpdf.com/cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/online/" class="nav-link">
  更多在线资源
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/change-logs/" class="nav-link">
  Changlog
</a></li><li class="dropdown-item"><!----> <a href="/more/about-me.html" class="nav-link">
  Aboutme
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/wwllong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java虚拟机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/" aria-current="page" class="sidebar-link">大纲</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>走近Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/0_1_foreword.html" class="sidebar-link">JVM前言</a></li><li><a href="/java-vm/0_2_java_jvm_introd.html" class="sidebar-link">Java与JVM简介</a></li><li><a href="/java-vm/0_3_jvm_framework.html" class="sidebar-link">JVM架构模型</a></li><li><a href="/java-vm/0_4_jvm_life_cycle.html" class="sidebar-link">JVM生命周期</a></li><li><a href="/java-vm/0_5_java_histroy.html" class="sidebar-link">Java的发展重大事件</a></li><li><a href="/java-vm/0_6_jvm_family.html" class="sidebar-link">JVM家族</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>内存与垃圾回收</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/1_1_memory_structure.html" class="sidebar-link">JVM内存结构图</a></li><li><a href="/java-vm/1_2_class_loading_sys.html" class="sidebar-link">类加载器子系统</a></li><li><a href="/java-vm/1_3_runtime_data_area_ov.html" class="sidebar-link">运行时数据区</a></li><li><a href="/java-vm/1_4_pc_register.html" class="sidebar-link">程序计数器（PC寄存器）</a></li><li><a href="/java-vm/1_5_vm_statck.html" class="sidebar-link">虚拟机栈</a></li><li><a href="/java-vm/1_6_native_method_stack.html" class="sidebar-link">本地方法栈</a></li><li><a href="/java-vm/1_7_heap.html" class="sidebar-link">堆</a></li><li><a href="/java-vm/1_8_methods_area.html" class="sidebar-link">方法区</a></li><li><a href="/java-vm/1_8_1_methods_area.html" class="sidebar-link">- 方法区使用举例图解</a></li><li><a href="/java-vm/1_9_new_object.html" class="sidebar-link">对象的实例化</a></li><li><a href="/java-vm/1_10_direct_memory.html" class="sidebar-link">直接内存</a></li><li><a href="/java-vm/1_11_execution_engine.html" class="sidebar-link">执行引擎</a></li><li><a href="/java-vm/1_12_string_table.html" class="sidebar-link">String Table</a></li><li><a href="/java-vm/1_13_gc_introd.html" class="sidebar-link">垃圾回收概述</a></li><li><a href="/java-vm/1_14_gc_concept.html" class="sidebar-link">垃圾回收相关概念</a></li><li><a href="/java-vm/1_15_gc_algs.html" class="sidebar-link">垃圾回收算法</a></li><li><a href="/java-vm/1_16_gc_collector.html" class="sidebar-link">垃圾收集器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>字节码与类加载</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/2_1_class_sys_introd.html" class="sidebar-link">JVM基石：class文件</a></li><li><a href="/java-vm/2_2_class_file_struct.html" class="sidebar-link">class文件结构</a></li><li><a href="/java-vm/2_2_1_class_file_javap.html" class="sidebar-link">javap解析class文件</a></li><li><a href="/java-vm/2_3_bytecode_instruction_set.html" aria-current="page" class="active sidebar-link">字节码指令集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#执行模型" class="sidebar-link">执行模型</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#字节码与数据类型" class="sidebar-link">字节码与数据类型</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#指令分类" class="sidebar-link">指令分类</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#加载与存储指令" class="sidebar-link">加载与存储指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#常用指令" class="sidebar-link">常用指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#再谈操作数栈与局部变量表" class="sidebar-link">再谈操作数栈与局部变量表</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#局部变量入栈指令" class="sidebar-link">局部变量入栈指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#常量入栈指令" class="sidebar-link">常量入栈指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#出栈装入局部变量表指令" class="sidebar-link">出栈装入局部变量表指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#算术指令" class="sidebar-link">算术指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#byte、short、char和boolean类型说明" class="sidebar-link">byte、short、char和boolean类型说明</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#运算时的溢出" class="sidebar-link">运算时的溢出</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#运算模式" class="sidebar-link">运算模式</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#infinity-nan值使用" class="sidebar-link">Infinity&amp;NaN值使用</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#所有算数指令" class="sidebar-link">所有算数指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#类型转换指令" class="sidebar-link">类型转换指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#宽化类型转换指令" class="sidebar-link">宽化类型转换指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#窄化类型转换指令" class="sidebar-link">窄化类型转换指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#对象创建与访问指令" class="sidebar-link">对象创建与访问指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#创建指令" class="sidebar-link">创建指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#字段访问指令" class="sidebar-link">字段访问指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#数组操作指令" class="sidebar-link">数组操作指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#类型检查指令" class="sidebar-link">类型检查指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#方法指令" class="sidebar-link">方法指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#方法调用指令" class="sidebar-link">方法调用指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#方法返回指令" class="sidebar-link">方法返回指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#操作数栈管理指令" class="sidebar-link">操作数栈管理指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#控制转移指令" class="sidebar-link">控制转移指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#比较指令" class="sidebar-link">比较指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#条件跳转指令" class="sidebar-link">条件跳转指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#比较条件跳转指令" class="sidebar-link">比较条件跳转指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#多条件分支跳转指令" class="sidebar-link">多条件分支跳转指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#无条件跳转指令" class="sidebar-link">无条件跳转指令</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#异常处理指令" class="sidebar-link">异常处理指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#抛出异常指令" class="sidebar-link">抛出异常指令</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#异常处理与异常表" class="sidebar-link">异常处理与异常表</a></li></ul></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#同步控制指令" class="sidebar-link">同步控制指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#方法级同步" class="sidebar-link">方法级同步</a></li><li class="sidebar-sub-header"><a href="/java-vm/2_3_bytecode_instruction_set.html#方法内指定指令序列的同步" class="sidebar-link">方法内指定指令序列的同步</a></li></ul></li></ul></li><li><a href="/java-vm/2_4_class_loading_process.html" class="sidebar-link">类加载过程（类生命周期）</a></li><li><a href="/java-vm/2_5_class_loader.html" class="sidebar-link">再谈类的加载器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能监控与调优</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/3_1_tuning_introd.html" class="sidebar-link">概述</a></li><li><a href="/java-vm/3_2_tuning_command.html" class="sidebar-link">JVM监控及诊断工具-命令行篇</a></li><li><a href="/java-vm/3_3_tuning_gui.html" class="sidebar-link">JVM监控及诊断工具-GUI篇</a></li><li><a href="/java-vm/3_4_tuning_vmparam.html" class="sidebar-link">JVM运行时参数</a></li><li><a href="/java-vm/1_17_gc_log.html" class="sidebar-link">GC日志分析</a></li><li><a href="/java-vm/3_6_tuning_heap_shallow_retained.html" class="sidebar-link">浅堆深堆与支配树</a></li><li><a href="/java-vm/3_8_tuning_heap_leak_overflow.html" class="sidebar-link">内存泄漏与内存溢出</a></li><li><a href="/java-vm/3_7_tuning_qql.html" class="sidebar-link">QQL语言查询对象信息</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>监控与性能调优案例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/java-vm/3_tuning_case0_introd.html" class="sidebar-link">概述</a></li><li><a href="/java-vm/3_tuning_case0_tomcat_hoom.html" class="sidebar-link">Tomcat堆溢出分析</a></li><li><a href="/java-vm/3_tuning_case1_heap_oom.html" class="sidebar-link">堆溢出</a></li><li><a href="/java-vm/3_tuning_case2_method_oom.html" class="sidebar-link">方法区溢出</a></li><li><a href="/java-vm/3_tuning_case3_limit_exceeded.html" class="sidebar-link">GC overhead limit exceeded</a></li><li><a href="/java-vm/3_tuning_case4_thread_oom.html" class="sidebar-link">线程溢出</a></li><li><a href="/java-vm/3_tuning_perf_case1_tps.html" class="sidebar-link">调整堆大小提高服务的吞吐量</a></li><li><a href="/java-vm/3_tuning_perf_case2_jit.html" class="sidebar-link">JVM优化之JIT优化</a></li><li><a href="/java-vm/3_tuning_perf_case3_heapsize.html" class="sidebar-link">合理配置堆内存</a></li><li><a href="/java-vm/3_tuning_perf_case4_cpu_hight.html" class="sidebar-link">CPU占用很高排查方案</a></li><li><a href="/java-vm/3_tuning_perf_case5_g1.html" class="sidebar-link">G1并发执行的线程数对性能的影响</a></li><li><a href="/java-vm/3_tuning_perf_case6_gcc.html" class="sidebar-link">调整垃圾回收器提高服务的吞吐量</a></li><li><a href="/java-vm/3_tuning_perf_case7_millions4orders.html" class="sidebar-link">日均百万级订单交易系统如何设置JVM参数</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="字节码指令集"><a href="#字节码指令集" class="header-anchor">#</a> 字节码指令集</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>Java字节码指令对于虚拟机，就好像汇编语言对于计算机，属于基本执行指令。</p> <p>Java字节码指令，也可以称为Java虚拟机指令，由<strong>一个字节长度</strong>、代表着某种特定操作含义的数字（称为<strong>操作码</strong>，Opcode）以及跟随其后的零至多个代表此操作所需参数（称为<strong>操作数</strong>，Operands）而构成。由于JVM采用面向操作数栈而不是寄存器的结构，所以大多数的指令都不包含操作数，只有一个操作码。</p> <p>由于限制了JVM操作码的长度为一个字节（0～255），这意味着指令集的操作码总数不可能超过256条。可以参考<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，查看每个指令的含义，实际上并不难。</p> <p>熟悉虚拟机的指令对于动态字节码生成、反编译class文件、class文件修补都有着非常重要的价值。因此，阅读字节码作为了解Java虚拟机的基础技能，需要熟练掌握常见指令。</p> <h3 id="执行模型"><a href="#执行模型" class="header-anchor">#</a> 执行模型</h3> <p>如果不考虑异常处理的话，那么Java虚拟机的解释器可以使用下面这个伪代码当做最基本的执行模型来理解：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">do</span><span class="token punctuation">{</span>
    自动计算PC寄存器的值加<span class="token number">1</span><span class="token punctuation">;</span>
    根据PC寄存器的指示位置，从字节码流中取出操作码<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>字节码存在操作数<span class="token punctuation">)</span> 从字节码流中取出操作数<span class="token punctuation">;</span>
    执行操作码所定义的操作<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">while</span><span class="token punctuation">(</span>字节码长度<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>；
</code></pre></div><h3 id="字节码与数据类型"><a href="#字节码与数据类型" class="header-anchor">#</a> 字节码与数据类型</h3> <p>在Java虚拟机的指令集中，<strong>大多数的指令都包含了其操作所对应的数据类型信息</strong>。例如，<code>iload</code>指令用于从局部变量表中加载<code>int</code>型的数据到操作数栈中，而<code>fload</code>指令加载的则是<code>float</code>类型的数据。</p> <p>对于大部分与数据类型相关的字节码指令，它们的操作码助记符中都有特殊的字符来表明专门为哪种数据类型服务：</p> <ul><li>i代表对int类型的数据操作，</li> <li>l代表long</li> <li>s代表short</li> <li>b代表byte</li> <li>c代表char</li> <li>f代表float</li> <li>d代表double</li></ul> <p><strong>也有一些指令的助记符中没有明确地指明操作类型的字母</strong>，如<code>arraylength</code>指令，它没有代表数据类型的特殊字符，但操作数永远只能是一个数组类型的对象。还有另外一些指令，如无条件跳转指令<code>goto</code>则是与<strong>数据类型无关</strong>的。</p> <p>大部分的指令都没有支持整数类型<code>byte</code>、<code>char</code>和<code>short</code>，甚至没有任何指令支持<code>boolean</code>类型。编译器会在编译期或运行期将<code>byte</code>和<code>short</code>类型的数据带符号扩展（Sign-Extend）为相应的<code>int</code>类型数据，将<code>boolean</code>和<code>char</code>类型数据零位扩展（Zero-Extend）为相应的<code>int</code>类型数据。与之类似，在处理<code>boolean</code>、<code>byte</code>、<code>short</code>和<code>char</code>类型的数组时，也会转换为使用对应的<code>int</code>类型的字节码指令来处理。<strong>因此，大多数对于<code>boolean</code>、<code>byte</code>、<code>short</code>和<code>char</code>类型数据的操作，实际上都是使用相应的<code>int</code>类型作为运算类型</strong>。</p> <h3 id="指令分类"><a href="#指令分类" class="header-anchor">#</a> 指令分类</h3> <p>由于完全介绍和学习这些指令需要花费大量时间。为了让大家能够更快地熟悉和了解这些基本指令，这里将JVM中的字节码指令集按用途大致分成9类。</p> <ul><li>加载与存储指令</li> <li>算术指令</li> <li>类型转换指令</li> <li>对象的创建与访问指令</li> <li>方法调用与返回指令</li> <li>操作数栈管理指令</li> <li>比较控制指令</li> <li>异常处理指令</li> <li>同步控制指令</li></ul> <p>（说在前面）在做值相关操作时：</p> <ul><li>一个指令，可以从局部变量表、常量池、堆中对象、方法调用、系统调用中等取得数据，这些数据（可能是值，可能是对象的引用）被压入操作数栈。</li> <li>一个指令，也可以从操作数栈中取出一到多个值（pop多次），完成赋值、加减乘除、方法传参、系统调用等等操作。</li></ul> <h2 id="加载与存储指令"><a href="#加载与存储指令" class="header-anchor">#</a> 加载与存储指令</h2> <p>作用：加载和存储指令用于将数据从栈帧的局部变量表和操作数栈之间来回传递。</p> <h3 id="常用指令"><a href="#常用指令" class="header-anchor">#</a> 常用指令</h3> <table><thead><tr><th>指令分类</th> <th>说明</th></tr></thead> <tbody><tr><td>局部变量压栈指令</td> <td>将一个局部变量加载到操作数栈：<code>xload、xload_&lt;n&gt;</code>（其中x为i、l、f、d、a，n为0到3）</td></tr> <tr><td>常量入栈指令</td> <td>将一个常量加载到操作数栈：<code>bipush、sipush、ldc、ldc_w、ldc2_w、aconst_null、iconst_m1、iconst_&lt;i&gt;、lconst_&lt;l&gt;）、fconst_&lt;f&gt;、dconst_&lt;d&gt;</code></td></tr> <tr><td>出栈装入局部变量表指令</td> <td>将一个数值从操作数栈取出并存储到局部变量表：<code>xstore、xstore_&lt;n&gt;</code>（其中x为i、l、f、d、a，n为0到3）；<code>xastore</code>（其中x为i、l、f、d、a、b、c、s）</td></tr> <tr><td>扩充局部变量表的访问索引指令</td> <td>wide</td></tr></tbody></table> <p>上面所列举的指令助记符中，有一部分是以尖括号结尾的（例如<code>iload_&lt;n&gt;</code>）。这些指令助记符实际上代表了一组指令（例如<code>iload_&lt;n&gt;</code>代表了<code>iload_0、iload_1、iload_2</code>和<code>iload_3</code>这几个指令）。这几组指令都是某个带有一个操作数的通用指令（例如<code>iload</code>）的特殊形式，<strong>对于这若干组特殊指令来说，它们表面上没有操作数，不需要进行取操作数的动作，但操作数都隐含在指令中</strong>。</p> <p>除此之外，它们的语义与原生的通用指令完全一致（例如<code>iload_0</code>的语义与操作数为0时的<code>iload</code>指令语义完全一致）。在尖括号之间的字母指定了指令隐含操作数的数据类型，&lt;n&gt;代表非负的整数，&lt;i&gt;代表是int类型数据，&lt;l&gt;代表long类型，&lt;f&gt;代表float类型，&lt;d&gt;代表<code>double</code>类型。</p> <ul><li>操作<code>byte</code>、<code>char</code>、<code>short</code>和<code>boolean</code>类型数据时，经常用<code>int</code>类型的指令来表示。</li></ul> <h3 id="再谈操作数栈与局部变量表"><a href="#再谈操作数栈与局部变量表" class="header-anchor">#</a> 再谈操作数栈与局部变量表</h3> <p><strong>操作数栈（Operand Stacks）</strong></p> <p>我们知道，Java字节码是Java虚拟机所使用的指令集。因此，它与Java虚拟机基于栈的计算模型是密不可分的。在解释执行过程中，每当为Java方法分配栈桢时，Java虚拟机往往需要开辟一块额外的空间作为<strong>操作数栈，来存放计算的操作数以及返回结果</strong>。</p> <p>具体来说便是：<strong>执行每一条指令之前，Java虚拟机要求该指令的操作数已被压入操作数栈中。在执行指令时，Java虚拟机会将该指令所需的操作数弹出，并且将指令的结果重新压入栈中。</strong></p> <p>以加法指令<code>iadd</code>为例。假设在执行该指令前，栈顶的两个元素分别为<code>int</code>值1和<code>int</code>值2，那么<code>iadd</code>指令将弹出这两个<code>int</code>，并将求得的和<code>int</code>值3压入栈中：</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_1.png" alt="bytecode_instruction_set_1"></p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_2.png" alt="bytecode_instruction_set_2"></p> <p>由于<code>iadd</code>指令只消耗栈顶的两个元素，因此，对于离栈顶距离为2的元素，即图中的问号，<code>iadd</code>指令并不关心它是否存在，更加不会对其进行修改。</p> <p><strong>局部变量表（Local Variables）</strong></p> <p>Java方法栈桢的另外一个重要组成部分则是局部变量区，<strong>字节码程序可以将计算的结果缓存在局部变量区之中</strong>。实际上，Java虚拟机<strong>将局部变量区当成一个数组</strong>，依次存放<strong>this</strong>指针（仅非静态方法），所传入的参数，以及字节码中的局部变量。</p> <p>和操作数栈一样，<code>long</code>类型以及<code>double</code>类型的值将占据两个单元，其余类型仅占据一个单元。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_3.png" alt="bytecode_instruction_set_3"></p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">,</span> <span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;Hello, World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应的图示：</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_4.png" alt="bytecode_instruction_set_4"></p> <p><code>this</code>表示当前类的引用，l和f的类型的值占两个槽位，i和s变量由于分别在各自代码块中，没有共同的生命周期，所以占同一个槽位（即槽位复用）。</p> <p>在栈帧中，与性能调优关系最为密切的部分就是局部变量表。局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收。</p> <h3 id="局部变量入栈指令"><a href="#局部变量入栈指令" class="header-anchor">#</a> 局部变量入栈指令</h3> <p><strong>局部变量压栈指令将给定的局部变量表中的数据压入操作数栈</strong>。</p> <p>这类指令大体可以分为：</p> <ul><li><p><code>xload_&lt;n&gt;</code>（x为i、l、f、d、a，n为0到3）</p></li> <li><p><code>xload</code>（x为i、l、f、d、a）</p></li></ul> <p>说明：在这里，x 的取值表示数据类型。</p> <p>指令<code>xload_n</code>表示<strong>将第n个局部变量压入操作数栈</strong>，比如<code>iload_1、fload_0、aload_0</code>等指令。其中<code>aload_n</code>表示将一个对象引用压栈。</p> <p>指令<code>xload</code>通过指定参数的形式，把局部变量压入操作数栈，当使用这个命令时，表示局部变量的数量可能超过了4个，比如指令<code>iload</code>、<code>fload</code>等。</p> <p><strong>举例</strong>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flag<span class="token punctuation">,</span> <span class="token keyword">short</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction/bytecode_ex_1.png" alt="bytecode_ex_1"></p> <h3 id="常量入栈指令"><a href="#常量入栈指令" class="header-anchor">#</a> 常量入栈指令</h3> <p><strong>常量入栈指令的功能是将常数压入操作数栈，根据数据类型和入栈内容的不同，又可以分为<code>const</code>系列、<code>push</code>系列和<code>ldc</code>指令。</strong></p> <p><strong><code>const</code>指令系列</strong>：用于对特定的常量入栈，入栈的常量隐含在指令本身里。指令有：<code>iconst_&lt;i&gt;、lconst_&lt;l&gt;、fconst_&lt;f&gt;、dconst_&lt;d&gt;、aconst_null</code>，具体如下：</p> <ul><li><code>iconst_n</code>：n从-1到5，将x压入栈，其中n=-1的时候比较特殊，指令为<code>iconst_m1</code>。</li> <li><code>lconst_0</code>、<code>lconst_1</code>分别将长整数0和1压入栈；</li> <li><code>fconst_0</code>、<code>fconst_1</code>、<code>fconst_2</code>分别将浮点数0、1、2压入栈；</li> <li><code>dconst_0</code>和<code>dconst_1</code>分别将double型0和1压入栈；</li> <li><code>aconst_null</code>将<code>null</code>压入操作数栈；</li></ul> <p>从指令的命名上不难找出规律，指令助记符的第一个字符总是喜欢表示数据类型，i表示整数，l表示长整数，f表示浮点数，d表示双精度浮点，<strong>习惯上用a表示对象引用，如果指令隐含操作的参数，会以下划线形式给出</strong>。</p> <p><strong><code>push</code>指令系列</strong>：主要包括<code>bipush</code>和<code>sipush</code>。它们的区别在于接收数据类型的不同，<code>bipush</code>接收<strong>8位</strong>整数作为参数，<code>sipush</code>接收<strong>16位</strong>整数，它们都将参数压入栈。</p> <p><code>ldc</code>指令系列：如果以上指令都不能满足需求，那么可以使用万能的<code>ldc</code>指令。它可以接收一个8位的参数，该参数指向常量池中的<code>int</code>、<code>float</code>或者<code>String</code>的索引，将指定的内容压入栈。</p> <ul><li>类似的还有<code>ldc_w</code>，它接收两个8位参数，能支持的索引范围大于<code>ldc</code>。</li> <li>如果要压入的元素是<code>long</code>或者<code>double</code>类型的，则使用<code>ldc2_w</code>指令，使用方式都是类似的。</li></ul> <p>总结如下：</p> <table><thead><tr><th>类型</th> <th>常数指令</th> <th>范围</th></tr></thead> <tbody><tr><td>int(boolean,byte,char,short)</td> <td>iconst</td> <td>[-1, 5]</td></tr> <tr><td></td> <td>bipush</td> <td>[-128, 127]</td></tr> <tr><td></td> <td>sipush</td> <td>[-32768, 32767]</td></tr> <tr><td></td> <td>ldc</td> <td>any int value</td></tr> <tr><td>long</td> <td>lconst</td> <td>0, 1</td></tr> <tr><td></td> <td>ldc</td> <td>any long value</td></tr> <tr><td>float</td> <td>fconst</td> <td>0, 1, 2</td></tr> <tr><td></td> <td>ldc</td> <td>any float value</td></tr> <tr><td>double</td> <td>dconst</td> <td>0, 1</td></tr> <tr><td></td> <td>ldc</td> <td>any double value</td></tr> <tr><td>reference</td> <td>aconst</td> <td>null</td></tr> <tr><td></td> <td>ldc</td> <td>String literal, Class literal</td></tr></tbody></table> <p><strong>示例1</strong>：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pushConstLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token number">32767</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> f <span class="token operator">=</span> <span class="token number">32768</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>字节码指令如下：</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token number">0</span> iconst_m1 <span class="token comment">// 将-1压入栈, 特殊写法</span>
 <span class="token number">1</span> istore_1
 <span class="token number">2</span> iconst_5
 <span class="token number">3</span> istore_2
 <span class="token number">4</span> bipush <span class="token number">6</span> <span class="token comment">// iconst_n（n=-1~5)，当x&gt;5 就要用bipush n</span>
 <span class="token number">6</span> istore_3
 <span class="token number">7</span> bipush <span class="token number">127</span> 
 <span class="token number">9</span> istore <span class="token number">4</span>
<span class="token number">11</span> sipush <span class="token number">128</span> <span class="token comment">// bipush n（n=-128～127)，当n&gt;127或n&lt;-128，需要使用sipush n</span>
<span class="token number">14</span> istore <span class="token number">5</span>
<span class="token number">16</span> sipush <span class="token number">32767</span>
<span class="token number">19</span> istore <span class="token number">6</span>
<span class="token number">21</span> ldc #<span class="token number">7</span> <span class="token generics"><span class="token punctuation">&lt;</span>32768<span class="token punctuation">&gt;</span></span> <span class="token comment">// sipush n（n=-32768～32767)，当n&gt;32767或n&lt;-32768，需要使用ldc.</span>
                  <span class="token comment">// ldc 加载常量池地址，大小没有限制</span>
<span class="token number">23</span> istore <span class="token number">7</span>
<span class="token number">25</span> <span class="token keyword">return</span>
</code></pre></div><p><strong>示例2</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">constLdc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> a1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> a2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> b1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> b2 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> c1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">double</span> c2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">Date</span> d <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>字节码指令如下：</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token number">0</span> lconst_1
 <span class="token number">1</span> lstore_1
 <span class="token number">2</span> ldc2_w #<span class="token number">8</span> <span class="token generics"><span class="token punctuation">&lt;</span>2<span class="token punctuation">&gt;</span></span>  <span class="token comment">// lconst_n（n=0或1），不在这个范围只能使用ldc2w（long、double两个字节）</span>
 <span class="token number">5</span> lstore_3
 <span class="token number">6</span> fconst_2
 <span class="token number">7</span> fstore <span class="token number">5</span>  <span class="token comment">//  fstore n（n指的是局部变量表的下标），注意long和double占用两个槽位，所以 lstore_3 后面 就 fstore 5 了</span>
 <span class="token number">9</span> ldc #<span class="token number">10</span> <span class="token generics"><span class="token punctuation">&lt;</span>3<span class="token punctuation">.</span>0<span class="token punctuation">&gt;</span></span>  <span class="token comment">// fconst_n（n=0或1或2），不在这个范围使用ldc</span>
<span class="token number">11</span> fstore <span class="token number">6</span>
<span class="token number">13</span> dconst_1
<span class="token number">14</span> dstore <span class="token number">7</span>
<span class="token number">16</span> ldc2_w #<span class="token number">11</span> <span class="token generics"><span class="token punctuation">&lt;</span>2<span class="token punctuation">.</span>0<span class="token punctuation">&gt;</span></span> <span class="token comment">// dconst_n，理由同lconst_n</span>
<span class="token number">19</span> dstore <span class="token number">9</span>
<span class="token number">21</span> aconst_null  <span class="token comment">// 将null压入操作数栈</span>
<span class="token number">22</span> astore <span class="token number">11</span>
<span class="token number">24</span> <span class="token keyword">return</span>  
</code></pre></div><h3 id="出栈装入局部变量表指令"><a href="#出栈装入局部变量表指令" class="header-anchor">#</a> 出栈装入局部变量表指令</h3> <p><strong>出栈装入局部变量表指令用于将操作数栈中栈顶元素弹出后，装入局部变量表的指定位置，用于给局部变量赋值</strong>。</p> <p>这类指令主要以<code>store</code>的形式存在，比如<code>xstore（x为i、l、f、d、a）、xstore_n（x为i、l、f、d、a，n为0至3）</code>。</p> <ul><li><p>其中，指令<code>istore_n</code>将从操作数栈中弹出一个整数，并把它值给局部变量索引<code>n</code>位置。</p></li> <li><p>指令<code>xstore</code>由于没有隐含参数信息，故需要提供一个<code>byte</code>类型的参数(操作数）指定目标局部变量表的位置。</p></li></ul> <p>说明：<strong>一般说来，类似像<code>store</code>这样的命令需要带一个参数，用来指明将弹出的元素放在局部变量表的第几个位置</strong>。但是，为了尽可能压缩指令大小，使用专门的<code>istore_1</code>指令表示将弹出的元素放置在局部变量表第1个位置。类似的还有<code>istore_0</code>、<code>istore_2</code>、<code>istore_3</code>，它们分别表示从操作数栈顶弹出一个元素，存放在局部变量表第0、2、3个位置。由于局部变量表前几个位置总是非常常用，因此<strong>这种做法虽然增加了指令数量，但是可以大大压缩生成的字节码的体积</strong>。如果局部变量表很大，需要存储的槽位大于3，那么可以使用<code>istore</code>指令，外加一个参数，用来表示需要存放的槽位位置。</p> <p><strong>举例1</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">store</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> m <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;atguigu&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">10.0F</span><span class="token punctuation">;</span>
    d <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction/bytecode_ex_2.png" alt="bytecode_ex_2"></p> <p><strong>举例2:槽位复用</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">long</span> l<span class="token punctuation">,</span> <span class="token keyword">float</span> f<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;Hello, World&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>字节码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">0</span> iconst_0
<span class="token number">1</span> istore <span class="token number">4</span> 
<span class="token number">3</span> ldc #<span class="token number">19</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Hello</span><span class="token punctuation">,</span> <span class="token class-name">World</span><span class="token punctuation">&gt;</span></span>
<span class="token number">5</span> astore <span class="token number">4</span>  <span class="token comment">// 槽位复用</span>
<span class="token number">7</span> <span class="token keyword">return</span>
</code></pre></div><p>局部变量表如下：</p> <table><thead><tr><th>索引</th> <th>0</th> <th>1,2</th> <th>3</th> <th>4</th></tr></thead> <tbody><tr><td>变量</td> <td>this</td> <td>l（long类型占用两个槽位，用1表示）</td> <td>f</td> <td>i/s（槽位复用）</td></tr></tbody></table> <h2 id="算术指令"><a href="#算术指令" class="header-anchor">#</a> 算术指令</h2> <p>作用：<strong>算术指令用于对两个操作数栈上的值进行某种特定运算，并把结果重新压入操作数栈</strong>。</p> <p>大体上算术指令可以分为两种：对<strong>整型数据</strong>进行运算的指令与对<strong>浮点类型</strong>数据进行运算的指令。</p> <h3 id="byte、short、char和boolean类型说明"><a href="#byte、short、char和boolean类型说明" class="header-anchor">#</a> byte、short、char和boolean类型说明</h3> <p>在每一大类中，都有针对Java虚拟机具体数据类型的专用算术指令。但没有直接支持<code>byte</code>、<code>short</code>、<code>char</code>和<code>boolean</code>类型的算术指令，对于这些数据的运算，都使用<code>int</code>类型的指令来处理。此外，在处理<code>boolean</code>、<code>byte</code>、<code>short</code>和<code>char</code>类型的数组时，也会<strong>转换为对应的<code>int</code>类型的字节码指令来处理</strong>。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction/bytecode_instruction_set_7.png" alt="bytecode_instruction_set_7"></p> <h3 id="运算时的溢出"><a href="#运算时的溢出" class="header-anchor">#</a> 运算时的溢出</h3> <p>数据运算可能会导致溢出。例如，两个很大的正整数相加，结果可能是一个负数。其实Java虚拟机规范并无明确规定过整型数据溢出的具体结果，仅规定了在处理整型数据时，只有除法指令以及求余指令中当出现除数为0时会导致虚拟机抛出异常<code>ArithmeticException</code>。</p> <h3 id="运算模式"><a href="#运算模式" class="header-anchor">#</a> 运算模式</h3> <ul><li><p><strong>向最接近数舍入模式</strong>：JVM要求在进行浮点数计算时，所有的运算结果都必须舍入到适当的精度，非精确结果必须舍入为可被表示的最接近的精确值，如果有两种可表示的形式与该值一样接近，将优先选择最低有效位为零的；</p></li> <li><p><strong>向零舍入模式</strong>：将浮点数转换为整数时，采用该模式，该模式将在目标数值类型中选择一个最接近但是不大于原值的数字作为最精确的舍入结果；</p></li></ul> <h3 id="infinity-nan值使用"><a href="#infinity-nan值使用" class="header-anchor">#</a> Infinity&amp;NaN值使用</h3> <p>当一个操作产生溢出时，将会使用有符号的无穷大（Infinity）表示，如果某个操作结果没有明确的数学定义的话，将会使用NaN值来表示，而且所有使用NaN值作为操作数的算术操作，结果都会返回NaN；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 无穷大, Infinity</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> j <span class="token operator">=</span> i <span class="token operator">/</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//NaN: not a number</span>
<span class="token keyword">double</span> d1 <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> d2 <span class="token operator">=</span> d1 <span class="token operator">/</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>d2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="所有算数指令"><a href="#所有算数指令" class="header-anchor">#</a> 所有算数指令</h3> <table><thead><tr><th>算数指令</th> <th>int(boolean,byte,char,short)</th> <th>long</th> <th>float</th> <th>double</th></tr></thead> <tbody><tr><td>加法指令</td> <td>iadd</td> <td>ladd</td> <td>fadd</td> <td>dadd</td></tr> <tr><td>减法指令</td> <td>isub</td> <td>lsub</td> <td>fsub</td> <td>dsub</td></tr> <tr><td>乘法指令</td> <td>imul</td> <td>lmul</td> <td>fmul</td> <td>dmul</td></tr> <tr><td>除法指令</td> <td>idiv</td> <td>ldiv</td> <td>fdiv</td> <td>ddiv</td></tr> <tr><td>求余指令(remainder)</td> <td>irem</td> <td>lrem</td> <td>frem</td> <td>drem</td></tr> <tr><td>取反指令(negation)</td> <td>ineg</td> <td>lneg</td> <td>fneg</td> <td>dneg</td></tr> <tr><td>自增指令</td> <td>iinc</td> <td></td> <td></td> <td></td></tr> <tr><td>位移运算指令</td> <td>ishl、ishr、iushr</td> <td>Ishl、lshr、lushr</td> <td></td> <td></td></tr> <tr><td>按位或指令</td> <td>ior</td> <td>lor</td> <td></td> <td></td></tr> <tr><td>按位与指令</td> <td>iand</td> <td>land</td> <td></td> <td></td></tr> <tr><td>按位异或指令</td> <td>ixor</td> <td>lxor</td> <td></td> <td></td></tr> <tr><td>比较指令</td> <td></td> <td>lcmp</td> <td>fcmpg / fcmpl</td> <td>dcmpg / dcmpl</td></tr></tbody></table> <p>比较指令的说明，见控制转移指令部分内容。</p> <p><strong>举例1</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_5.png" alt="bytecode_instruction_set_5"></p> <p><a href="/java-vm/1_5_vm_statck.html#附录-代码追踪示例">举例2</a></p> <h2 id="类型转换指令"><a href="#类型转换指令" class="header-anchor">#</a> 类型转换指令</h2> <p>类型转换指令可以将两种不同的数值类型进行相互转换。</p> <p>这些转换操作一般用于实现用户代码中的<strong>显式类型转换操作</strong>，或者用来<strong>处理字节码指令集中数据类型相关指令无法与数据类型一一对应的问题</strong>。</p> <h3 id="宽化类型转换指令"><a href="#宽化类型转换指令" class="header-anchor">#</a> 宽化类型转换指令</h3> <p>Java虚拟机直接支持以下数值的宽化类型转换（Widening Numeric Conversion, 小范围类型向大范围类型的安全转换）。也就是说，并不需要指令执行，包括：</p> <ul><li>从<code>int</code>类型到<code>long</code>、<code>float</code>或者<code>double</code>类型。对应的指令为：i21、i2f、i2d</li> <li>从<code>long</code>类型到<code>float</code>、<code>double</code>类型。对应的指令为：i2f、i2d</li> <li>从<code>float</code>类型到<code>double</code>类型。对应的指令为：f2d</li></ul> <p><strong>简化为：<code>int</code> --&gt; <code>long</code> --&gt; <code>float</code> -&gt; <code>double</code></strong></p> <p><strong>精度损失问题</strong></p> <ul><li>宽化类型转换是不会因为超过目标类型最大值而丢失信息的，例如，从<code>int</code>转换到<code>long</code>,或者从<code>int</code>转换到<code>double</code>,都不会丢失任何信息，转换前后的值是精确相等的。</li> <li>从<code>int</code>、<code>long</code>类型数值转换到<code>float</code>，或者<code>long</code>类型数值转换到<code>double</code>时，将可能发生精度丢失。可能丢失掉几个最低有效位上的值，转换后的浮点数值是根据IEEE 754最接近含入模式所得到的正确整数值。</li> <li>尽管宽化类型转换实际上是可能发生精度丢失的，但是这种转换永远不会导致Java虚拟机抛出运行时异常。</li></ul> <p><strong>补充说明</strong></p> <p><strong>从<code>byte</code>、<code>char</code>和<code>short</code>类型到<code>int</code>类型的宽化类型转换实际上是不存在的</strong>。对于<code>byte</code>类型转为<code>int</code>，虚拟机并没有做实质性的转化处理，只是简单地通过操作数栈交换了两个数据。而将<code>byte</code>转为<code>long</code>时，使用的是i2l，可以看到在内部，<code>byte</code>在这里已经等同于<code>int</code>类型处理，类似的还有<code>short</code>类型，这种处理方式有两个特点：</p> <ul><li>一方面可以减少实际的数据类型，如果为<code>short</code>和<code>byte</code>都准备一套指令，那么指令的数量就会大増，而虚拟机目前的设计上，只愿意使用一个字节表示指令，因此指令总数不能超过256个，为了节省指令资源，将<code>short</code>和<code>byte</code>当做int处理也在情理之中。</li> <li>另一方面，由于局部变量表中的槽位固定为32位，无论是<code>byte</code>或者<code>short</code>存入局部变量表，都会占用32位空间。从这个角度说，也没有必要特意区分这几种数据类型。</li></ul> <h3 id="窄化类型转换指令"><a href="#窄化类型转换指令" class="header-anchor">#</a> 窄化类型转换指令</h3> <p>Java虚拟机也直接支持以下窄化类型转换(Narrowing Numeric Conversion)：</p> <ul><li>从<code>int</code>类型至<code>byte</code>、 <code>short</code>或者<code>char</code>类型。对应的指令有：i2b、i2c、i2s</li> <li>从<code>long</code>类型到<code>int</code>类型。对应的指令有：l2i</li> <li>从<code>float</code>类型到<code>int</code>或者<code>long</code>类型。对应的指令有：f2i、f2l</li> <li>从<code>double</code>类型到<code>int</code>、<code>long</code>或者<code>float</code>类型。对应的指令有：d2i、d2l、d2f</li></ul> <p><strong>精度损失问题</strong></p> <ul><li>窄化类型转换可能会导致转换结果具备不同的正负号、不同的数量级，因此，转换过程很可能会导致数值丢失精度。</li> <li>尽管数据类型窄化转换可能会发生上限溢出、下限溢出和精度丢失等情况，但是Java虚拟机规范中明确规定数值类型的窄化转换指令永远不可能导致虚拟机抛出运行时异常</li></ul> <p><strong>补充说明</strong></p> <p>当将一个浮点值窄化转换为整数类型T(T限于<code>int</code>或<code>long</code>类型之一)的时候，将遵循以下转换规则：</p> <ul><li>如果浮点值是NaN, 那转换结果就是<code>int</code>或<code>long</code>类型的0。</li> <li>如果浮点值不是无穷大的话，浮点值使用IEEE754的向零含入模式取整，获得整数值v。如果v在目标类型T(<code>int</code>或<code>long</code>)的表示范围之内，那转换结果就是v。否则，将根据v的符号，转换为T所能表示的最大或者最小正数。</li></ul> <p>当将一个<code>double</code>类型窄化转换为<code>float</code>类型时，将遵循以下转换规则，通过向最接近数舍入模式舍入一个可以使用<code>float</code>类型表示的数字。最后结果根据下面这3条规则判断：</p> <ul><li>如果转换结果的绝对值太小而无法使用<code>float</code>来表示，将返回<code>float</code>类型的正负零</li> <li>如果转换结果的绝对值太大而无法使用<code>float</code>来表示，将返回<code>float</code>类型的正负无穷大。</li> <li>对于<code>double</code>类型的<code>NaN</code>值将按规定转换为<code>float</code>类型的NaN值。</li></ul> <h2 id="对象创建与访问指令"><a href="#对象创建与访问指令" class="header-anchor">#</a> 对象创建与访问指令</h2> <p>Java是面向对象的程序设计语言，虚拟机平台从字节码层面就对面向对象做了深层次的支持。有一系列指令专门用于对象操作，可进一步细分为创建指令、字段访问指令、数组操作指令、类型检查指令。</p> <h3 id="创建指令"><a href="#创建指令" class="header-anchor">#</a> 创建指令</h3> <p>虽然类实例和数组都是对象，但Java虚拟机对类实例和数组的创建与操作使用了不同的字节码指令：</p> <ol><li>创建类实例的指令： <code>new</code>。它接收一个操作数，为指向常量池的索引，表示要创建的类型，执行完成后，将对象的引用压入栈。</li> <li>创建数组的指令： <code>newarray、anewarray、multianewarray</code>。(基本类型数组、引用类型数组、多维数组)</li></ol> <p>上述创建指令可以用于创建对象或者数组，由于对象和数组在Java中的广泛使用，这些指令的使用频率也非常高。</p> <h3 id="字段访问指令"><a href="#字段访问指令" class="header-anchor">#</a> 字段访问指令</h3> <p>对象创建后，就可以通过对象访问指令获取对象实例或数组实例中的字段或者数组元素。</p> <ul><li>访问类字段（<code>static</code>字段，或者称为类变量）的指令：<code>getstatic</code>、<code>putstatic</code></li> <li>访问类实例字段（非<code>static</code>字段，或者称为实例变量）的指令：<code>getfield</code>、<code>putfield</code></li></ul> <p>举例：以<code>getstatic</code>指令为例，它含有一个操作数，为指向常量池的<code>Fieldref</code>索引，它的作用就是获取<code>Fieldref</code>指定的对象或者值，并将其压入操作数栈。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hel1o&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>对应字节码指令：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">0</span> getstatic #<span class="token number">8</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">&gt;</span>
<span class="token number">3</span> ldc #<span class="token number">9</span> <span class="token generics"><span class="token punctuation">&lt;</span>hello<span class="token punctuation">&gt;</span></span>
<span class="token number">5</span> invokevirtual #<span class="token number">10</span> <span class="token operator">&lt;</span>java<span class="token operator">/</span>io<span class="token operator">/</span><span class="token class-name">PrintStream</span><span class="token punctuation">.</span>println<span class="token operator">&gt;</span>
<span class="token number">8</span> <span class="token keyword">return</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_6.png" alt="bytecode_instruction_set_6"></p> <p>注意：getXXX是入栈、putXXX是出栈。</p> <h3 id="数组操作指令"><a href="#数组操作指令" class="header-anchor">#</a> 数组操作指令</h3> <p>数组操作指令主要有：<code>xastore</code>和<code>xaload</code>指令。具体为：</p> <ul><li>把一个数组元素加载到操作数栈的指令：<code>baload、caload、saload、iaload、laload、faload、daload、aaload</code></li> <li>将一个操作数栈的值存储到数组元素中的指令：<code>bastore、castore、sastore、iastore、lastore、fastore、dastore、aastore</code></li></ul> <table><thead><tr><th>数组指令</th> <th>byte(boolean)</th> <th>char</th> <th>short</th> <th>long</th> <th>long</th> <th>float</th> <th>double</th> <th>reference</th></tr></thead> <tbody><tr><td><strong>xaload</strong></td> <td>baload</td> <td>caload</td> <td>saload</td> <td>iaload</td> <td>laload</td> <td>faload</td> <td>daload</td> <td>aaload</td></tr> <tr><td><strong>xastore</strong></td> <td>bastore</td> <td>castore</td> <td>sastore</td> <td>iastore</td> <td>lastore</td> <td>fastore</td> <td>dastore</td> <td>aastore</td></tr></tbody></table> <p>取数组长度的指令：<code>arraylength</code>。<strong>该指令弹出栈顶的数组元素，获取数组的长度，将长度压入栈</strong>。</p> <p><strong>补充说明</strong></p> <ul><li>指令<code>xaload</code>表示将数组的元素压栈，比如<code>saload</code>、<code>caload</code>分别表示压入<code>short</code>数组和<code>char</code>数组。指令<code>xaload</code>在执行时，要求操作数中栈顶元素为<strong>数组索引</strong><code>i</code>，栈顶顺位第2个元素为<strong>数组引用</strong><code>a</code>，该指令会弹出栈顶这两个元素，并将<code>a[i]</code>重新压入栈。</li> <li><code>xastore</code>则专门针对数组操作，以<code>iastore</code>为例，它用于给一个<code>int</code>数组的给定索引赋值。在<code>iastore</code>执行前，操作数栈顶需要以此准备3个元素：<strong>值、索引、数组引用</strong>，<code>iastore</code>会弹出这3个值，并将值赋给数组中指定索引的位置。</li></ul> <h3 id="类型检查指令"><a href="#类型检查指令" class="header-anchor">#</a> 类型检查指令</h3> <p>检查类实例或数组类型的指令：<code>instanceof</code>、<code>checkcast</code>。</p> <ul><li>指令<code>instanceof</code>用来判断给定对象是否是某一个类的实例，它会将判断结果压入操作数栈</li> <li>指令<code>checkcast</code>用于检查类型强制转换是否可以进行。如果可以进行，那么<code>checkcast</code>指令不会改变操作数栈，否则它会抛出<code>ClassCastException</code>异常。</li></ul> <h2 id="方法指令"><a href="#方法指令" class="header-anchor">#</a> 方法指令</h2> <h3 id="方法调用指令"><a href="#方法调用指令" class="header-anchor">#</a> 方法调用指令</h3> <p>方法调用指令：<code>invokevirtual、invokeinterface、invokespecial、invokestatic、invokedynamic</code>，具体如下：</p> <ul><li><code>invokevirtual</code>指令用于调用对象的实例方法，根据对象的实际类型进行分派（虚方法分派），支持多态。这也是Java语言中最<strong>常见的方法分派方式</strong>。</li> <li><code>invokeinterface</code>指令用于<strong>调用接口方法</strong>，它会在运行时搜索由特定对象所实现的这个接口方法，并找出适合的方法进行调用。</li> <li><code>invokespecial</code>指令用于调用一些需要特殊处理的实例方法，包括<strong>实例初始化方法（构造器）、私有方法和父类方法</strong>。这些方法都是静态类型绑定的，不会在调用时进行动态派发。</li> <li><code>invokestatic</code>指令用于调用命名<strong>类中的类方法（static方法）</strong>，这是静态绑定的。</li> <li><code>invokedynamic</code>指令用于调用动态绑定的方法，这个是JDK 1.7后新加入的指令。用于在运行时动态解析出调用点限定符所引用的方法，并执行该方法。前面4条调用指令的分派逻辑都固化在Java虚拟机内部而<code>invokedynamic</code>指令的分派逻辑是由用户所设定的引导方法决定的。</li></ul> <h3 id="方法返回指令"><a href="#方法返回指令" class="header-anchor">#</a> 方法返回指令</h3> <p>方法调用结束前，需要进行返回。<strong>方法返回指令是根据返回值的类型区分的</strong>。</p> <ul><li>包括<code>ireturn</code>（当返回值是boolean、byte、char、short和int 类型时使用）、<code>lreturn</code>、<code>freturn、</code>dreturn<code>和</code>areturn`。</li> <li>另外还有一条<code>return</code> 指令供声明为<code>void</code>ß的方法、实例初始化方法以及类和接口的类初始化方法使用。</li></ul> <table><thead><tr><th>方法返回指令</th> <th>void</th> <th>int</th> <th>long</th> <th>float</th> <th>double</th> <th>reference</th></tr></thead> <tbody><tr><td><strong>xreturn</strong></td> <td>return</td> <td>ireturn</td> <td>lreturn</td> <td>freutrn</td> <td>dreturn</td> <td>areturn</td></tr></tbody></table> <p>通过<code>xreturn</code>指令，<strong>将当前函数操作数栈的顶层元素弹出，并将这个元素压入调用者函数的操作数栈中</strong>（因为调用者非常关心函数的返回值），所有在当前函数操作数栈中的其他元素都会被丢弃。</p> <p>如果当前返回的是<code>synchronized</code>方法，那么还会执行一个隐含的<code>monitorexit</code>指令，退出临界区（详细见同步控制指令）。</p> <p>最后，会丢弃当前方法的整个帧，恢复调用者的帧，并将控制权转交给调用者。</p> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">methodReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">/</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_8.png" alt="bytecode_instruction_set_8"></p> <h2 id="操作数栈管理指令"><a href="#操作数栈管理指令" class="header-anchor">#</a> 操作数栈管理指令</h2> <p>如同操作一个普通数据结构中的堆栈那样，JVM提供的操作数栈管理指令，可以用于<strong>直接操作操作数栈的指令</strong>。</p> <p>这类指令包括如下内容：</p> <ul><li>将一个或两个元素从栈顶弹出，并且直接废弃：<code>pop，pop2</code></li> <li>复制栈顶一个或两个数值并将复制值或双份的复制值重新压入栈顶：<code>dup，dup2，dup_x1，dup2_×1，dup_×2，dup2_×2</code></li> <li>将栈最顶端的两个<code>Slot</code>数值位置交换：<code>swap</code>。Java虚拟机没有提供交换两个64位数据类型（long、double）数值的指令。</li> <li>指令<code>nop</code>，是一个非常特殊的指令，它的字节码为0x00。和汇编语言中的nop一样，它表示什么都不做。这条指令一般可用于调试、占位等。</li></ul> <p>这些指令属于通用型，对栈的压入或者弹出无需指明数据类型。</p> <p><strong>补充说明</strong></p> <ul><li><p>不带<code>_x</code>的指令是<strong>复制栈顶数据并压入栈顶</strong>。包括两个指令，<code>dup，dup2</code>。</p> <ul><li><code>dup</code>的系数代表要复制的<code>Slot</code>个数。<code>dup</code>开头的指令用于复制1个<code>Slot</code>的数据，例如1个<code>int</code>或1个<code>reference</code>类型数据。</li> <li><code>dup2</code>开头的指令用于复制2个<code>Slot</code>的数据。例如1个<code>long</code>，或2个<code>int</code>，或1个<code>int</code>+1个<code>float</code>类型数据</li></ul></li> <li><p>带<code>_x</code>的指令是<strong>复制栈顶数据并插入栈顶以下的某个位置</strong>。共有4个指令，<code>dup_×1，dup2_×1，dup_×2，dup2×2</code>。</p> <ul><li>对于带<code>_x</code>的复制插入指令，只要将指令的<code>dup</code>和<code>x</code>的系数相加，结果即为需要插入的位置。因此<code>dup_×1</code>插入位置：1+1=2，即栈顶2个<code>Slot</code>下面；<code>dup_×2</code>插入位置：1+2=3，即栈顶3个<code>Slot</code>下面；<code>dup2×1</code>插入位置：2+1=3，即栈顶3个<code>Slot</code>下面。</li></ul></li> <li><p><code>pop</code>：将栈顶的1个<code>Slot</code>数值出栈。例如1个<code>short</code>类型数值</p></li> <li><p><code>pop2</code>：将栈顶的2个<code>Slot</code>数值出栈。例如1个<code>double</code>类型数值，或者2个<code>int</code>类型数值</p></li></ul> <h2 id="控制转移指令"><a href="#控制转移指令" class="header-anchor">#</a> 控制转移指令</h2> <p>程序流程离不开条件控制，为了支持条件跳转，虚拟机提供了大量字节码指令，大体上可以分为：</p> <ul><li>比较指令</li> <li>条件跳转指令</li> <li>比较条件跳转指令</li> <li>多条件分支跳转指令</li> <li>无条件跳转指令等。</li></ul> <h3 id="比较指令"><a href="#比较指令" class="header-anchor">#</a> 比较指令</h3> <p>比较指令的作用是<strong>比较占栈顶两个元素的大小，并将比较结果入栈</strong>。</p> <p>比较指令有： <code>dcmpg、dcmpl、 fcmpg、fcmpl、lcmp</code>。与前面讲解的指令类似，首字符d表示<code>double</code>类型，f表示<code>float</code>,l表示<code>long</code>。</p> <p>对于<code>double</code>和<code>float</code>类型的数字，由于NaN的存在，各有两个版本的比较指令。以<code>float</code>为例，有<code>fcmpg</code>和<code>fcmpl</code>两个指令，它们的区别在于在数字比较时，若遇到NaN值，处理结果不同。指令<code>dcmpl</code>和<code>dcmpg</code>也是类似的，根据其命名可以推测其含义，在此不再赘述。</p> <p>指令<code>lcmp</code>针对<code>long</code>型整数，由于<code>long</code>型整数没有NaN值，故无需准备两套指令。</p> <p>注意，数值类型的数据才可以谈大小！boolean、引用数据类型不能比较大小。</p> <p><strong>举例</strong></p> <p>指令<code>fcmp</code>和<code>fcmpl</code>都从中弹出两个操作数，并将它们做比较，设<strong>栈顶的元素为v2</strong>，顶顺位<strong>第2位的元素为v1</strong>：</p> <ul><li>若v1=v2，则压入0；</li> <li>若v1&gt;v2，则压入1；</li> <li>若v1&lt;v2，则压入-1。</li></ul> <p>两个指令的不同之处在于，如果遇到NaN值，<code>fcmpg</code>会压入1,而<code>fcmpl</code>会压入-1。</p> <h3 id="条件跳转指令"><a href="#条件跳转指令" class="header-anchor">#</a> 条件跳转指令</h3> <p><strong>条件跳转指令通常和比较指令结合使用</strong>。在条件跳转指令执行前，一般可以先用比较指令进行栈顶元素的准备，然后进行条件跳转。</p> <p>条件跳转指令有：<code>ifeq，iflt，ifle，ifne，ifgt，ifge，ifnull，ifnonnull</code>。这些指令都接收两个字节的操作数，用于计算跳转的位置（16位符号整数作为当前位置的<code>offset</code>）。</p> <p>它们的统一含义为：<strong>弹出栈顶元素，测试它是否满足某一条件，如果满足条件，则跳转到给定位置。</strong></p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_9.png" alt="bytecode_instruction_set_8"></p> <p><strong>补充说明</strong></p> <p>与前面运算规则一致：</p> <ul><li>对于<code>boolean、byte、char、short</code>类型的条件分支比较操作，都是使用<code>int</code>类型的比较指令完成</li> <li>对于<code>long、float、double</code>类型的条件分支比较操作，则会先执行相应类型的比较运算指令，运算指令会返回一个整型值到操作数栈中，随后再执行<code>int</code>类型的条件分支比较操作来完成整个分支跳转。对于输出（System.out.println）比较结果，虽然得到的是<code>int</code>类型的值，但是我们可以在jclasslib中的常量池信息中看到写的是输出的是Z，代表布尔值类型（比较指令+条件跳转指令）</li> <li><code>int</code>类型值（包含byte、char、short）比较和对象类型值比较需要使用比较条件跳转指令。</li></ul> <p>由于各类型的比较最终都会转为<code>int</code>类型的比较操作，所以Java虚拟机提供的<code>int</code>类型的条件分支指令是最为丰富和强大的。</p> <h3 id="比较条件跳转指令"><a href="#比较条件跳转指令" class="header-anchor">#</a> 比较条件跳转指令</h3> <p>比较条件跳转指令类似于<strong>比较指令和条件跳转指令的结合体，它将比较和跳转两个步骤合二为一</strong>。</p> <p>这类指令有：<code>if_icmpeq、if_icmpne、if_icmplt、if_icmpgt、if_icmple、if_icmpge、if_acmpeq和if_acmpne</code>。其中指令助记符加上“if_”后，以字符“i”开头的指令针对<code>int</code>型整数操作（也包括short和byte类型），以字符“a”开头的指令表示对象引用的比较。</p> <p>具体说明：</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_10.png" alt="bytecode_instruction_set_10"></p> <p>这些指令都接收两个字节的操作数作为参数，用于计算跳转的位置。同时在执行指令时，栈顶需要准备两个元素进行比较。指令执行完成后，栈顶的这两个元素被清空，且没有任何数据入栈。<strong>如果预设条件成立，则执行跳转，否则，继续执行下一条语句</strong>（细品，你会发现这部分字节码指令都是跟代码反着来，猜测是为了符合“跳转”远处）。</p> <p><strong>补充说明</strong>：</p> <ul><li>上面所说的后者是栈顶元素，而前者是栈顶下面的元素</li> <li>对于<code>float、double、long</code>类型的比较，它们比较之后生成的是<code>int</code>类型的0、1、-1，这个过程可以使用<strong>比较指令和条件跳转指令</strong> 来完成。而<code>int</code>类型值（包含<code>byte、char、short</code>）比较和对象类型值比较需要使用**比较条件跳转指令，**其中对象类型值不是比较的地址，就是比较对象中的某些字段值，这又归咎到 <code>float、double、long、int</code>类型的比较中了。</li> <li>无论哪种比较，也不管两个比较值的中间是什么符号（&gt;、&lt;、&gt;=、&lt;=等等），始终都是<strong>栈顶下部元素  比较符  栈顶元素</strong>，这是不会改变的，然后结合比较符得出结果，如果是<code>true</code>，那就跳转，否则不跳转继续往下执行。</li></ul> <h3 id="多条件分支跳转指令"><a href="#多条件分支跳转指令" class="header-anchor">#</a> 多条件分支跳转指令</h3> <p>多条件分支跳转指令<strong>是专为<code>switch-case</code>语句设计</strong>的，主要有<code>tableswitch</code>和<code>lookupswitch</code>。</p> <table><thead><tr><th>指令名称</th> <th>描述</th></tr></thead> <tbody><tr><td>tableswitch</td> <td>用于switch条件跳转，case值连续</td></tr> <tr><td>lookupswitch</td> <td>用于switch条件跳转，case值不连续</td></tr></tbody></table> <p>从助记符上看，两者都是switch语句的实现，它们的区别：</p> <ul><li><code>tableswitch</code>要求<strong>多个条件分支值是连续</strong>的，它内部只存放起始值和终止值，以及若干个跳转偏移量，通过给定的操作数index，可以立即定位到跳转偏移量位置，<strong>因此效率比较高</strong>。</li> <li><code>lookupswitch</code>内部<strong>存放着各个离散的<code>case-offset</code>对</strong>，每次执行都要搜索全部的case-offset对，找到匹配的case值，并根据对应的offset计算跳转地址，<strong>因此效率较低</strong>。</li></ul> <p>指令<code>tableswitch</code>的示意图如下图所示。由于<code>tableswitch</code>的<code>case</code>值是连续的，因此只需要记录最低值和最高值，以及每一项对应的<code>offset</code>偏移量，根据给定的<code>index</code>值通过简单的计算即可直接定位到<code>offse</code>t。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_11.png" alt="bytecode_instruction_set_11"></p> <p>指令<code>lookupswitch</code>处理的是离散的<code>case</code>值，但是出于效率考虑，将<code>case-offset</code>对按照<code>case</code>值大小排序，给定<code>index</code>时，需要查找与<code>index</code>相等的<code>case</code>，获得其<code>offset</code>，如果找不到则跳转到<code>default</code>。指令<code>lookupswitch</code>如下图所示。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_12.png" alt="bytecode_instruction_set_12"></p> <h3 id="无条件跳转指令"><a href="#无条件跳转指令" class="header-anchor">#</a> 无条件跳转指令</h3> <p><strong>目前主要的无条件跳转指令为<code>goto</code></strong>。指令<code>goto</code>接收两个字节的操作数，共同组成一个带符号的整数**，用于指定指令的偏移量，指令执行的目的就是跳转到偏移量给定的位置处**。</p> <p>如果指令偏移量太大，超过双字节的带符号整数的范围，则可以使用指令<code>goto_w</code>，它和<code>goto</code>有相同的作用，但是它接收4个字节的操作数，可以表示更大的地址范围。</p> <p>指令<code>jsr、jsr_w、ret</code>虽然也是无条件跳转的，但主要用于<code>try-finally</code>语句，且已经被虚拟机逐渐废弃，故不在这里介绍这两个指令。</p> <table><thead><tr><th>指令名称</th> <th>描述</th></tr></thead> <tbody><tr><td>goto</td> <td>无条件跳转</td></tr> <tr><td>goto_w</td> <td>无条件跳转（宽索引）</td></tr> <tr><td>jsr</td> <td>跳转至指定16位offset位置，并将jsr下一条指令地址压入栈顶</td></tr> <tr><td>jsr_w</td> <td>跳转至指定32位offer位置，并将jsr_w下一条指令地址压入栈顶</td></tr> <tr><td>ret</td> <td>返回至由指定的局部变量所给出的指令位置（一般与jsr、jsr_w联合使用）</td></tr></tbody></table> <h2 id="异常处理指令"><a href="#异常处理指令" class="header-anchor">#</a> 异常处理指令</h2> <h3 id="抛出异常指令"><a href="#抛出异常指令" class="header-anchor">#</a> 抛出异常指令</h3> <p>抛出异常指令：<code>athrow</code></p> <p>在Java程序中显示抛出异常的操作（<code>throw</code>语句）都是由<code>athrow</code>指令来实现。</p> <p>除了使用<code>throw</code>语句显示抛出异常情况之外，<strong>JVM规范还规定了许多运行时异常会在其他Java虚拟机指令检测到异常状况时自动抛出</strong>。例如，在之前介绍的整数运算时，当除数为零时，虚拟机会在<code>idiv</code>或<code>ldiv</code>指令中抛出<code>ArithmeticException</code>异常。</p> <p>注意：正常情况下，操作数栈的压入弹出都是一条条指令完成的。<strong>唯一的例外情况是在抛异常时，Java虚拟机会清除操作数栈上的所有内容，而后将异常实例压入调用者操作数栈上</strong>。</p> <p><strong>补充说明</strong>：如果使用<code>throw new 异常名称()</code> 这种形式来抛出异常，那就会在代码中出现<code>athrow</code>指令，而在方法上面添加<code>throw 异常名称</code> 这种形式来抛出异常，然后使用jclasslib的时候就会出现在方法下面多出现一个属性<code>Exceptions</code>。</p> <h3 id="异常处理与异常表"><a href="#异常处理与异常表" class="header-anchor">#</a> 异常处理与异常表</h3> <p>处理异常：在Java虚拟机中，<strong>处理异常（<code>catch</code>语句）不是由字节码指令来实现的（早期使用jsr、ret指令），而是采用异常表来完成的</strong>。</p> <p><strong>异常表</strong>：如果一个方法定义了一个<code>try-catch</code>或者<code>try-finally</code>的异常处理，就会创建一个异常表。它包含了每个异常处理或者<code>finally</code>块的信息，异常表保存了每个异常处理信息。比如：</p> <ul><li>起始位置</li> <li>结束位置</li> <li>程序计数器记录的代码处理的偏移地址</li> <li>被捕获的异常类在常量池中的索引</li></ul> <p><strong>当一个异常被抛出时，JVM会在当前的方法里寻找一个匹配的处理，如果没有找到，这个方法会强制结束并弹出当前栈帧</strong>，并且异常会重新抛给上层调用的方法（在调用方法栈帧）。如果在所有栈帧弹出前仍然没有找到合适的异常处理，这个线程将终止。如果这个异常在最后一个非守护线程里抛出，将会导致JVM自己终止，比如这个线程是个<code>main</code>线程。</p> <p><strong>不管什么时候抛出异常，如果异常处理最终匹配了所有异常类型，代码就会继续执行</strong>。在这种情况下，如果方法结束后没有抛出异常，仍然执行<code>finally</code>块，在<code>return</code>前，它直接跳到<code>finally</code>块来完成目标。</p> <p><strong>补充说明</strong>:</p> <ul><li>异常表的含义是如果在<code>Start PC</code>和<code>End PC</code>之间（大于等于<code>Start PC</code>，<code>小于End PC</code>）出现对应的<code>Catch Type</code>异常问题（出现异常就匹配对应的异常），将会在<strong>操作数栈中压入相应的异常类对象</strong>，之后跳转到<code>Handler PC</code>的位置去执行对应的字节码指令。</li></ul> <h2 id="同步控制指令"><a href="#同步控制指令" class="header-anchor">#</a> 同步控制指令</h2> <p>Java虚拟机支持两种同步结构：<strong>方法级的同步</strong>和<strong>方法内部一段指令序列的同步</strong>，这两种同步都是使用<code>monitor</code>来支持的。</p> <h3 id="方法级同步"><a href="#方法级同步" class="header-anchor">#</a> 方法级同步</h3> <p>方法级的同步：<strong>是隐式的</strong>，即<strong>无须通过字节码指令来控制，它实现在方法调用和返回操作之中</strong>。虚拟机可以从方法常量池的方法表结构中的<code>ACC_SYNCHRONIZED</code>访问标志得知一个方法是否声明为同步方法；</p> <p>当调用方法时，调用指令将会检查方法的<code>ACC_SYNCHRONIZED</code>访问标志是否设置。</p> <ul><li>如果设置了，执行线程将先持有同步锁，然后执行方法。最后在方法完成（无论是正常完成还是非正常完成）时释放同步锁。</li> <li>在方法执行期间，执行线程持有了同步锁，其他任何线程都无法再获得同一个锁。</li> <li>如果一个同步方法执行期间抛出了异常，并且在方法内部无法处理此异常，那这个同步方法所持有的锁将在异常抛到同步方法之外时自动释放。</li></ul> <p>举例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对应的字节码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token number">0</span>  aload_0
<span class="token number">1</span>  dup
<span class="token number">2</span>  getfield #<span class="token number">2</span> 
<span class="token number">5</span>  iconst_1 
<span class="token number">6</span>  iadd
<span class="token number">7</span>  putfield #<span class="token number">2</span> 
<span class="token number">10</span> <span class="token keyword">return</span>
</code></pre></div><p>这段代码和普通的无同步操作的代码没有什么不同，没有使用<code>monitorenter</code>和<code>monitorexit</code>进行同步区控制。这是因为，对于同步方法而言，<strong>当虚拟机通过方法的访问标示符判断是一个同步方法时，会自动在方法调用前进行加锁</strong>，当同步方法执行完毕后，不管方法是正常结束还是有异常抛出，均会由虚拟机释放这个锁。因此，对于同步方法而言，<code>monitorenter</code>和<code>monitorexit</code>指令是隐式存在的，并未直接出现在字节码中。</p> <h3 id="方法内指定指令序列的同步"><a href="#方法内指定指令序列的同步" class="header-anchor">#</a> 方法内指定指令序列的同步</h3> <p>同步一段指令集序列：指由Java中的<code>synchronized</code>语句块来表示的代码段，对应的JVM的指令集有<code>monitorenter</code>和<code>monitorexit</code> 两条指令来支持<code>synchronized</code>关键字的语义。</p> <p><strong>执行原理</strong></p> <ul><li>当一个线程进入同步代码块时，它使用<code>monitorenter</code>指令请求进入。如果当前对象的监视器计数器为0，则它会被准许进入，若为1，则判断持有当前监视器的线程是否为自己，如果是，则进入，否则进行等待，直到对象的监视器计数器为0，才会被允许进入同步块。</li> <li>当线程退出同步块时，需要使用<code>monitorexit</code>声明退出。在Java虚拟机中，任何对象都有一个监视器与之相关联，用来判断对象是否被锁定，当监视器被持有后，对象处于锁定状态。</li> <li>指令<code>monitorenter</code>和<code>monitorexit</code>在执行时，都需要在操作数栈顶压入对象，之后<code>monitorenter</code>和<code>monitorexit</code>的锁定和释放都是针对这个对象的监视器进行的。</li></ul> <p>下图展示了监视器如何保护临界区代码不同时被多个线程访问，只有当线程4离开临界区后，线程1、2、3才有可能进入。</p> <p><img src="https://qiniu.wenwl.site/notes/jvm/bytecode_instruction_set_13.png" alt="bytecode_instruction_set_13"></p> <p><strong>举例</strong></p> <p>Java代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>字节码：</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token number">0</span> aload_0
 <span class="token number">1</span> getfield #<span class="token number">4</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>atguigu<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>obj <span class="token operator">:</span> <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span><span class="token operator">&gt;</span>
 <span class="token number">4</span> dup
 <span class="token number">5</span> astore_1
 <span class="token number">6</span> monitorenter <span class="token comment">// 操作数栈中的对象和monitorenter结合起来可以让线程获取锁, 让对象的监视器标记从0变成1(上锁)</span>
 <span class="token number">7</span> aload_0
 <span class="token number">8</span> dup
 <span class="token number">9</span> getfield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>atguigu<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i <span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token number">12</span> iconst_1
<span class="token number">13</span> isub
<span class="token number">14</span> putfield #<span class="token number">2</span> <span class="token operator">&lt;</span>com<span class="token operator">/</span>atguigu<span class="token operator">/</span>java1<span class="token operator">/</span><span class="token class-name">SynchronizedTest</span><span class="token punctuation">.</span>i <span class="token operator">:</span> <span class="token class-name">I</span><span class="token operator">&gt;</span>
<span class="token number">17</span> aload_1
<span class="token number">18</span> monitorexit <span class="token comment">// 操作数栈的aload_1和monitorexit结合起来就可以让线程解锁，做法就是让对象的监视器标记从1变成0</span>
               <span class="token comment">// 解锁需要在方法退出之前完成, 出现了任何异常，将会跳到异常处理的字节码处执行相关代码，</span>
               <span class="token comment">// 如果异常处理的字节码部分出现了问题，那就重新执行异常处理的字节码</span>
<span class="token number">19</span> <span class="token keyword">goto</span> <span class="token number">27</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token number">22</span> astore_2
<span class="token number">23</span> aload_1
<span class="token number">24</span> monitorexit
<span class="token number">25</span> aload_2
<span class="token number">26</span> athrow
<span class="token number">27</span> <span class="token keyword">return</span>
</code></pre></div><p>根据例子可知，编译器必须确保无论方法通过何种方式完成，方法中调用过的每条<code>monitorenter</code>指令都必须执行其对应的<code>monitorexit</code>指令，而无论这个方法是正常结束还是异常结束。所以为了保证在方法异常完成时<code>monitorenter</code>和<code>monitorexit</code>指令依然可以正确配对执行，<strong>编译器会自动产生一个异常处理器</strong>，这个异常处理器声明可处理所有的异常，它的目的就是用来执行<code>monitorexit</code>指令</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/12/2022, 5:33:29 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/java-vm/2_4_class_loading_process.html">
        类加载过程（类生命周期）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.bc037eca.js" defer></script><script src="/assets/js/3.a3373ef9.js" defer></script><script src="/assets/js/182.179b516a.js" defer></script>
  </body>
</html>
